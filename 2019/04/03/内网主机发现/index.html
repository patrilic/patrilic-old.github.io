<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>内网主机发现 | Patrilic's blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">内网主机发现</h1><a id="logo" href="/.">Patrilic's blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/2019/04/01/Hello/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">内网主机发现</h1><div class="post-meta">Apr 3, 2019<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a class="disqus-comment-count" data-disqus-identifier="2019/04/03/内网主机发现/" href="/2019/04/03/内网主机发现/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Inhalte</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-发现内网存活主机"><span class="toc-number">1.</span> <span class="toc-text">0x01 发现内网存活主机</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-基于ARP发现内网主机"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 基于ARP发现内网主机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap"><span class="toc-number">1.1.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#powershell"><span class="toc-number">1.1.2.</span> <span class="toc-text">powershell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arp-scan-exe"><span class="toc-number">1.1.3.</span> <span class="toc-text">arp-scan.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arp-ping-exe"><span class="toc-number">1.1.4.</span> <span class="toc-text">arp-ping.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Empire"><span class="toc-number">1.1.5.</span> <span class="toc-text">Empire</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#netdiscover"><span class="toc-number">1.1.6.</span> <span class="toc-text">netdiscover</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#meterpreter"><span class="toc-number">1.1.7.</span> <span class="toc-text">meterpreter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cain等"><span class="toc-number">1.1.8.</span> <span class="toc-text">Cain等</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-基于icmp发现主机"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 基于icmp发现主机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cmd"><span class="toc-number">1.2.1.</span> <span class="toc-text">cmd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#powershell-1"><span class="toc-number">1.2.3.</span> <span class="toc-text">powershell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bash"><span class="toc-number">1.2.4.</span> <span class="toc-text">bash</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-基于netbios协议发现主机"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 基于netbios协议发现主机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cmd-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">cmd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nbtscan"><span class="toc-number">1.3.2.</span> <span class="toc-text">nbtscan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap-2"><span class="toc-number">1.3.3.</span> <span class="toc-text">nmap</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-基于smb协议发现主机"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 基于smb协议发现主机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cmd-2"><span class="toc-number">1.4.2.</span> <span class="toc-text">cmd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#powershell-2"><span class="toc-number">1.4.3.</span> <span class="toc-text">powershell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-基于snmp发现主机"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 基于snmp发现主机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perl"><span class="toc-number">1.5.2.</span> <span class="toc-text">perl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-基于udp发现主机"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 基于udp发现主机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap-5"><span class="toc-number">1.6.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unicornscan"><span class="toc-number">1.6.2.</span> <span class="toc-text">unicornscan</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-基于SqlDataSourceEnumerator"><span class="toc-number">1.7.</span> <span class="toc-text">1.7 基于SqlDataSourceEnumerator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-基于msf发现主机"><span class="toc-number">1.8.</span> <span class="toc-text">1.8 基于msf发现主机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#http服务"><span class="toc-number">1.8.1.</span> <span class="toc-text">http服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#smb服务"><span class="toc-number">1.8.2.</span> <span class="toc-text">smb服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ftp服务"><span class="toc-number">1.8.3.</span> <span class="toc-text">ftp服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arp服务"><span class="toc-number">1.8.4.</span> <span class="toc-text">arp服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#udp服务"><span class="toc-number">1.8.5.</span> <span class="toc-text">udp服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh服务"><span class="toc-number">1.8.6.</span> <span class="toc-text">ssh服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#telnet服务"><span class="toc-number">1.8.7.</span> <span class="toc-text">telnet服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dns服务"><span class="toc-number">1.8.8.</span> <span class="toc-text">dns服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql服务"><span class="toc-number">1.8.9.</span> <span class="toc-text">mysql服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#netbios服务"><span class="toc-number">1.8.10.</span> <span class="toc-text">netbios服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#db2服务"><span class="toc-number">1.8.11.</span> <span class="toc-text">db2服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#端口发现"><span class="toc-number">1.8.12.</span> <span class="toc-text">端口发现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rdp服务"><span class="toc-number">1.8.13.</span> <span class="toc-text">rdp服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#smtp服务"><span class="toc-number">1.8.14.</span> <span class="toc-text">smtp服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pop3服务"><span class="toc-number">1.8.15.</span> <span class="toc-text">pop3服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#posgres服务"><span class="toc-number">1.8.16.</span> <span class="toc-text">posgres服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调用nmap"><span class="toc-number">1.8.17.</span> <span class="toc-text">调用nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#post组件"><span class="toc-number">1.8.18.</span> <span class="toc-text">post组件</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><p>[toc]</p>
<h2 id="0x01-发现内网存活主机"><a href="#0x01-发现内网存活主机" class="headerlink" title="0x01 发现内网存活主机"></a>0x01 发现内网存活主机</h2><h3 id="1-1-基于ARP发现内网主机"><a href="#1-1-基于ARP发现内网主机" class="headerlink" title="1.1 基于ARP发现内网主机"></a>1.1 基于ARP发现内网主机</h3><h4 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sn -PR 10.253.6.0/24</span><br></pre></td></tr></table></figure>
<h4 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Patrilic\Desktop&gt;powershell -exec bypass -Command &quot;Import-Module ./Invoke-ARPScan.ps1;Invoke-ARPScan -CIDR 192.168.121.1/24&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/F4D8B735-47A4-47AE-8C52-6EC48D0A494D.png" alt="b535427cfa8bff645f941c761de208ee"></p>
<p>Invoke-ARPScan 是Empire中的模块</p>
<h4 id="arp-scan-exe"><a href="#arp-scan-exe" class="headerlink" title="arp-scan.exe"></a>arp-scan.exe</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">Patrilic</span>\<span class="title">Desktop</span>&gt;<span class="title">arp</span>-<span class="title">scan.exe</span> -<span class="title">t</span> 192.168.121.0/24</span></span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/B32AA3E3-6152-4659-A9B3-9D90AF18DB15.png" alt="1f8e2f46692be0db78c4aa872061312c"></p>
<h4 id="arp-ping-exe"><a href="#arp-ping-exe" class="headerlink" title="arp-ping.exe"></a>arp-ping.exe</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">Patrilic</span>\<span class="title">Desktop</span>&gt;<span class="title">arp</span>-<span class="title">ping.exe</span> 192.168.121.1</span></span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/F9D157F9-667C-4A56-A2E1-84A0B9E89B14.png" alt="017bf04412ca847df46101caadf1c928"></p>
<h4 id="Empire"><a href="#Empire" class="headerlink" title="Empire"></a>Empire</h4><h4 id="netdiscover"><a href="#netdiscover" class="headerlink" title="netdiscover"></a>netdiscover</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -r 192.168.3.0/24 -i eth0</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/505FE0B8-6242-4894-ACEA-F131AFC3DFC9.png" alt="f40948147bbe5919da12d82a559b56d9"></p>
<h4 id="meterpreter"><a href="#meterpreter" class="headerlink" title="meterpreter"></a>meterpreter</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getsystem</span><br><span class="line">meterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=10.253.6.1/24</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/012C3ADD-CD53-42DE-B40E-8459DB9382CC.png" alt="6189badfb2a72fed6459edba892064ba"></p>
<h4 id="Cain等"><a href="#Cain等" class="headerlink" title="Cain等"></a>Cain等</h4><h3 id="1-2-基于icmp发现主机"><a href="#1-2-基于icmp发现主机" class="headerlink" title="1.2 基于icmp发现主机"></a>1.2 基于icmp发现主机</h3><h4 id="cmd"><a href="#cmd" class="headerlink" title="cmd"></a>cmd</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">Patrilic</span>\<span class="title">Desktop</span>&gt;<span class="title">for</span> /<span class="title">L</span> %<span class="title">I</span> <span class="title">in</span> (1,1,254) <span class="title">DO</span> @<span class="title">ping</span> -<span class="title">w</span> 1 -<span class="title">n</span> 1 192.168.121.%<span class="title">I</span> | <span class="title">findstr</span> "<span class="title">TTL</span>="</span></span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/11FE87F8-DFC5-4F24-A6AE-59B567853401.png" alt="96cb8bb61bf9e88c2a3a7bda7547807d"></p>
<h4 id="nmap-1"><a href="#nmap-1" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sn -PE 192.168.3.0/24</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/193C3160-17B2-4BB2-A178-0115E0326584.jpg" alt="89c3bc440d2446f15121c4bcce576ca9"></p>
<h4 id="powershell-1"><a href="#powershell-1" class="headerlink" title="powershell"></a>powershell</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -exec bypass -Command <span class="string">"Import-Module C:\Invoke-TSPingSweep.ps1;Invoke-TSPingSweep -StartAddress 192.168.3.1 -EndAddress 192.168.3.254 -ResolveHost -ScanPort -Port 21,22,23,25,53,80,81,82,83,84,85,86,87,88,89,110,111,143,389,443,445,873,1025,1433,1521,2601,3306,3389,3690,5432,5900,7001,8000,8080,8081,8082,8083,8084,8085,8086,8087,8089,9090,10000"</span></span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/F9F443E0-8516-4F3A-9036-369D557F9743.png" alt="cf17177493ff1f7678825dca8a46b76c"></p>
<h4 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> 10.131.36.&#123;1..254&#125; </span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">   ping <span class="variable">$ip</span> -c 1 &amp;&gt; /dev/null </span><br><span class="line">   <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span> </span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$ip</span> is alive .... </span><br><span class="line">   <span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/AD2CCDBE-6B28-4064-8129-BD3DE928C01C.png" alt="573f9b41753a8eb36b56b062c2aa1fab"></p>
<h3 id="1-3-基于netbios协议发现主机"><a href="#1-3-基于netbios协议发现主机" class="headerlink" title="1.3 基于netbios协议发现主机"></a>1.3 基于netbios协议发现主机</h3><h4 id="cmd-1"><a href="#cmd-1" class="headerlink" title="cmd"></a>cmd</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nbtstat -n</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/9F50A42F-3516-4BA2-9C40-BA246B49B226.png" alt="ae9d6dd415b464302a342a0e9b30c5c4"></p>
<h4 id="nbtscan"><a href="#nbtscan" class="headerlink" title="nbtscan"></a>nbtscan</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nbtscan-1.0.35.exe -m 192.168.121.0/24</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/D0C9CDA1-7F52-4888-BAF3-A3CAC81214BC.png" alt="6a39cc10cd8c0f7b2a96d570c03d811a"></p>
<h4 id="nmap-2"><a href="#nmap-2" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sU --script nbstat.nse -p137 192.168.1.0/24 -T4</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/31F8DB2A-6859-444C-B91B-E1FDA3090859.png" alt="b7d36bfa324e4c6fecc134c750ec6f82"></p>
<h3 id="1-4-基于smb协议发现主机"><a href="#1-4-基于smb协议发现主机" class="headerlink" title="1.4 基于smb协议发现主机"></a>1.4 基于smb协议发现主机</h3><h4 id="nmap-3"><a href="#nmap-3" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap ‐sU ‐sS ‐‐script smb‐enum‐shares.nse ‐p445 192.168.1.119/24</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/795DA407-659D-418D-A180-B10BB210C477.png" alt="856a0cc32348f1b49cb80a4a98303498"></p>
<h4 id="cmd-2"><a href="#cmd-2" class="headerlink" title="cmd"></a>cmd</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /l %a <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">254</span>) <span class="keyword">do</span> <span class="built_in">start</span> /min /low telnet <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.%a <span class="number">445</span></span><br></pre></td></tr></table></figure>
<h4 id="powershell-2"><a href="#powershell-2" class="headerlink" title="powershell"></a>powershell</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">445</span>|%&#123;echo((new‐objectNet.Sockets.TcpClient).Connect(<span class="string">"10.253.6"</span>,<span class="variable">$_</span>)) <span class="string">"<span class="variable">$_</span> is open"</span>&#125; <span class="number">2</span>&gt;<span class="literal">$null</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>..<span class="number">5</span>|%&#123;<span class="variable">$a</span>=<span class="variable">$_</span>;<span class="number">445</span>|%&#123;echo((new‐object Net.Sockets.TcpClient).Connect(<span class="string">"192.168.1.<span class="variable">$a</span>"</span>,<span class="variable">$_</span>)) <span class="string">"Port <span class="variable">$_</span> is open"</span>&#125; <span class="number">2</span>&gt;<span class="literal">$null</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">118</span>..<span class="number">119</span>|%&#123;<span class="variable">$a</span>=<span class="variable">$_</span>;write‐host<span class="string">"‐‐‐‐‐‐"</span>;write‐host <span class="string">"192.168.1.<span class="variable">$a</span>"</span>; <span class="number">80</span>,<span class="number">445</span> | % &#123;echo ((new‐object Net.Sockets.TcpClient).Con ect(<span class="string">"192.168.1.<span class="variable">$a</span>"</span>,<span class="variable">$_</span>)) <span class="string">"Port <span class="variable">$_</span> is open"</span>&#125; <span class="number">2</span>&gt;<span class="literal">$null</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5-基于snmp发现主机"><a href="#1-5-基于snmp发现主机" class="headerlink" title="1.5 基于snmp发现主机"></a>1.5 基于snmp发现主机</h3><h4 id="nmap-4"><a href="#nmap-4" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sU --script snmp-brute 192.168.1.0/24 -T4</span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/62BB742B-9540-49B3-AEDB-1490A53D6143.png" alt="54f953ba0bf35bbe34623e0138e3f017"></p>
<h4 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h4><p><a href="https://github.com/dheiland-r7/snmp" target="_blank" rel="noopener">https://github.com/dheiland-r7/snmp</a><br><img src="/内网主机发现.resources/BE732D1F-6E9E-4B2A-8015-395F33CCE0A2.png" alt="7f535a08c8897275f57fb979975b1b8c"></p>
<h3 id="1-6-基于udp发现主机"><a href="#1-6-基于udp发现主机" class="headerlink" title="1.6 基于udp发现主机"></a>1.6 基于udp发现主机</h3><h4 id="nmap-5"><a href="#nmap-5" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sU -T5 -sV --max-retries 1 192.168.1.100 -p 500</span><br></pre></td></tr></table></figure>
<h4 id="unicornscan"><a href="#unicornscan" class="headerlink" title="unicornscan"></a>unicornscan</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unicornscan -mU 192.168.1.100</span><br></pre></td></tr></table></figure>
<h3 id="1-7-基于SqlDataSourceEnumerator"><a href="#1-7-基于SqlDataSourceEnumerator" class="headerlink" title="1.7 基于SqlDataSourceEnumerator"></a>1.7 基于SqlDataSourceEnumerator</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell -Command <span class="string">"[System.Data.Sql.SqlDataSourceEnumerator]::Instance.GetDataSources()"</span></span><br></pre></td></tr></table></figure>
<p><img src="/内网主机发现.resources/F69B4159-B3B4-4DDE-B4A3-BD483E8C1431.png" alt="db8c4d18ffad131d9641044e575fc820"></p>
<h3 id="1-8-基于msf发现主机"><a href="#1-8-基于msf发现主机" class="headerlink" title="1.8 基于msf发现主机"></a>1.8 基于msf发现主机</h3><h4 id="http服务"><a href="#http服务" class="headerlink" title="http服务"></a>http服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/http/http_version</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/http/title</span><br></pre></td></tr></table></figure>
<h4 id="smb服务"><a href="#smb服务" class="headerlink" title="smb服务"></a>smb服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/smb/smb_version</span><br></pre></td></tr></table></figure>
<h4 id="ftp服务"><a href="#ftp服务" class="headerlink" title="ftp服务"></a>ftp服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/ftp/ftp_version</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/ftp/anonymous</span><br></pre></td></tr></table></figure>
<h4 id="arp服务"><a href="#arp服务" class="headerlink" title="arp服务"></a>arp服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/discovery/arp_sweep</span><br></pre></td></tr></table></figure>
<h4 id="udp服务"><a href="#udp服务" class="headerlink" title="udp服务"></a>udp服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/discovery/udp_sweep</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/discovery/udp_probe</span><br></pre></td></tr></table></figure>
<h4 id="ssh服务"><a href="#ssh服务" class="headerlink" title="ssh服务"></a>ssh服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/ssh/ssh_version</span><br></pre></td></tr></table></figure>
<h4 id="telnet服务"><a href="#telnet服务" class="headerlink" title="telnet服务"></a>telnet服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/telnet/telnet_version</span><br></pre></td></tr></table></figure>
<h4 id="dns服务"><a href="#dns服务" class="headerlink" title="dns服务"></a>dns服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/dns/dns_amp</span><br></pre></td></tr></table></figure>
<h4 id="mysql服务"><a href="#mysql服务" class="headerlink" title="mysql服务"></a>mysql服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/mysql/mysql_version</span><br></pre></td></tr></table></figure>
<h4 id="netbios服务"><a href="#netbios服务" class="headerlink" title="netbios服务"></a>netbios服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/netbios/nbname</span><br></pre></td></tr></table></figure>
<h4 id="db2服务"><a href="#db2服务" class="headerlink" title="db2服务"></a>db2服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/db2/db2_version</span><br></pre></td></tr></table></figure>
<h4 id="端口发现"><a href="#端口发现" class="headerlink" title="端口发现"></a>端口发现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/portscan/ack</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/portscan/tcp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/portscan/syn</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/portscan/syn</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/portscan/ftpbounce</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/portscan/xmas</span><br></pre></td></tr></table></figure>
<h4 id="rdp服务"><a href="#rdp服务" class="headerlink" title="rdp服务"></a>rdp服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/rdp/rdp_scanner</span><br></pre></td></tr></table></figure>
<h4 id="smtp服务"><a href="#smtp服务" class="headerlink" title="smtp服务"></a>smtp服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/smtp/smtp_version</span><br></pre></td></tr></table></figure>
<h4 id="pop3服务"><a href="#pop3服务" class="headerlink" title="pop3服务"></a>pop3服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/pop3/pop3_version</span><br></pre></td></tr></table></figure>
<h4 id="posgres服务"><a href="#posgres服务" class="headerlink" title="posgres服务"></a>posgres服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/postgres/postgres_version</span><br></pre></td></tr></table></figure>
<h4 id="调用nmap"><a href="#调用nmap" class="headerlink" title="调用nmap"></a>调用nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db_nmap</span><br></pre></td></tr></table></figure>
<h4 id="post组件"><a href="#post组件" class="headerlink" title="post组件"></a>post组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">windows/gather/arp_scanner </span><br><span class="line">windows/gather/enum_ad_computers </span><br><span class="line">windows/gather/enum_computers </span><br><span class="line">windows/gather/enum_domain </span><br><span class="line">windows/gather/enum_domains </span><br><span class="line">windows/gather/enum_ad_user_comments</span><br><span class="line">linux/gather/enum_network </span><br><span class="line">linux/busybox/enum_hosts </span><br><span class="line">windows/gather/enum_ad_users </span><br><span class="line">windows/gather/enum_domain_tokens </span><br><span class="line">windows/gather/enum_snmp</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/内网渗透/">内网渗透</a></div><div class="post-nav"><a class="pre" href="/2019/04/03/bypassUAC_via_comhijacking/">bypassUAC_via_comhijacking</a><a class="next" href="/2019/04/03/JS + CHM 捆绑后门/">JS+CHM捆绑后门</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://patrilic.top/2019/04/03/内网主机发现/';
    this.page.identifier = '2019/04/03/内网主机发现/';
    this.page.title = '内网主机发现';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//Patrilic.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//Patrilic.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://Patrilic.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://patrilic.top"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Backdoor/" style="font-size: 15px;">Backdoor</a> <a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/代码审计/" style="font-size: 15px;">代码审计</a> <a href="/tags/内网渗透/" style="font-size: 15px;">内网渗透</a> <a href="/tags/SQL注入/" style="font-size: 15px;">SQL注入</a> <a href="/tags/Struts2/" style="font-size: 15px;">Struts2</a> <a href="/tags/文件上传/" style="font-size: 15px;">文件上传</a> <a href="/tags/威胁情报/" style="font-size: 15px;">威胁情报</a> <a href="/tags/命令执行/" style="font-size: 15px;">命令执行</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/08/15/S2-001 调试日记/">S2-001 调试日记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/14/初识威胁情报/">初识威胁情报</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/28/CISCN 2019 Final Web11/">CISCN 2019 Final Web11 赛后复盘</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/18/Phishing Attack - 文件落地/">Phishing Attack - 文件落地</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/10/CISCN2019-西南赛区部分Web题解/">CISCN2019-西南赛区部分Web题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/05/QWB2019 Web -随便注（题解）/">QWB2019 Web -随便注（题解）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/08/Command Execute By mshta/">Command Execute By mshta</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/05/Windows 抓取Hash/">常用 Windows 抓取Hash</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/23/第十二届全国大学生信息安全竞赛初赛Write up/">第十二届全国大学生信息安全竞赛初赛部分Web Write up</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/18/ADS 隐藏后门/">ADS隐藏后门</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Letzte Kommentare</i></div><script type="text/javascript" src="//Patrilic.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://hpdoger.cn" title="Hpdoger" target="_blank">Hpdoger</a><ul></ul><a href="http://0day.design/" title="Passer6y" target="_blank">Passer6y</a><ul></ul><a href="http://adm1n.design" title="Hu3sky" target="_blank">Hu3sky</a><ul></ul><a href="https://0xa1paca.github.io/" title="0xa1paca" target="_blank">0xa1paca</a><ul></ul><a href="http://noel.xin/" title="Noel" target="_blank">Noel</a><ul></ul><a href="https://www.0akarma.com/" title="0aKarmA" target="_blank">0aKarmA</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Patrilic's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"tagMode":false});</script></body></html>